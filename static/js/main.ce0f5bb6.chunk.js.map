{"version":3,"sources":["common/BLOSUM.ts","common/AlignmentSorter.ts","common/Utils.ts","common/ScrollSync.ts","common/SequenceLogoGlyphs.tsx","common/MolecularStyles.ts","common/Residues.ts","components/SequenceLogoComponent.tsx","components/SequenceBarplotComponent.tsx","components/CanvasAlignmentViewportComponent.tsx","components/CanvasAlignmentHighlighterComponent.tsx","components/CanvasAlignmentTiledComponent.tsx","components/CanvasAlignmentComponent.tsx","components/MiniMapComponent.tsx","components/AceEditorComponent.tsx","components/AceMultipleSequenceAlignmentComponent.tsx","components/AceConsensusSequenceComponent.tsx","components/AlignmentViewerComponent.tsx","components/AceQuerySequenceComponent.tsx","components/AceTextualRulerComponent.tsx","common/Alignment.ts","common/AceAlignmentMode.ts","common/FastaAlignment.ts","common/StockholmAlignment.ts","common/AlignmentLoader.ts","components/AlignmentFileLoaderComponent.tsx","App.tsx","serviceWorker.js","index.js","common/MolecularStyles.module.scss"],"names":["BLOSUM62","letterA","letterB","score","reduce","acc","matInput","has","set","Map","get","SequenceSorter","key","description","isQuerySequenceDependent","targetAlignmentType","sortFn","seq1","seq2","minLength","sequence","length","distance","Math","abs","i","list","find","at","INPUT","sequencesAsInput","alignment","HAMMING_DIST_QUERY","sequences","querySeq","getQuerySequence","map","s","sort","hammingDistance","HAMMING_DIST_CONSENSUS","consensusSeq","getConsensus","BLOSUM62_SCORE_CONSENSUS","dist1","blosumScore","BLOSUM62_SCORE_QUERY","aminoAcidSorters","seqSort","push","nucleotideSorters","stringToColor","str","ctx","document","createElement","getContext","fillStyle","hex","replace","m","r","g","b","rgbaResult","exec","rgb","red","parseInt","green","blue","generateUUIDv4","c","window","crypto","getRandomValues","Uint8Array","toString","mapGroupBy","items","fn","item","existing","getParseError","parserName","errorMessage","toReturn","Error","name","ScrollType","ScrollSync","scrollDirection","aceEditorDirection","scrollers","scrollFnHandles","handleScroll","scroller","event","filter","possibleSib","forEach","siblingScroller","syncScrollPosition","this","horizontal","includes","addEventListener","addScrollEvents","removeScrollEvents","parentElem","x","newScrollLeft","isAceEditor","session","getScrollLeft","scrollLeft","setScrollLeft","newScrollTop","getScrollTop","scrollTop","setScrollTop","bind","scrollFn","on","off","removeEventListener","console","log","GlyphFactory","letterToGlyphHM","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","letter","singleton","props","d","transform","fill","cx","cy","stroke","strokeOpacity","fillOpacity","strokeWidth","ALL_AMINOACID_COLORSCHEMES","assembleColorSchemes","ALL_NUCLEOTIDE_COLORSCHEMES","moleculeType","Object","keys","styles","styleName","indexOf","colorSchemeName","split","colorOrder","hexValues","commonName","className","backgroundAlpha","parseFloat","colors","fromEntries","_","AlignmentTypes","allColorSchemes","AMINOACID","aaAlignTypeClass","NUCLEOTIDE","ntAlignTypeClass","PositionsToStyle","ALL","styPosAllClass","QUERY","styPosQueryClass","QUERY_DIFF","styPosQueryDiffClass","CONSENSUS","styPosConsensusClass","CONSENSUS_DIFF","styPosConsensusDiffClass","ResidueStyle","LIGHT","lightHueClass","DARK","darkHueClass","NO_BACKGROUND","lettersOnlyHueClass","AlignmentStyle","alignmentType","colorScheme","positionsToStyle","residueDetail","AminoAcidAlignmentStyle","NucleotideAlignmentStyle","aceResidueParentClass","generateFastClassLookup","isForAceItself","ALL_POSSIBLE_CHARS","String","fromCharCode","letterInClass","prefix","acePrefix","preAceConsensusClass","preAceQueryClass","LETTER_CLASS_NAMES","LETTER_CLASS_NAMES_FOR_ACE","getLetterClassNames","isConsensus","isQuery","forAceItself","AminoAcid","singleLetterCode","threeLetterCode","fullName","glyph","glyphFromChar","cs","colorPair","entries","aa","colorString","colorInfo","hexString","bySingleLetterCode","UNKNOWN","byThreeLetterCode","canonicalAminoAcids","LOGO_TYPES","Nucleotide","toUpperCase","allNucleotides","SequenceLogoComponent","logoData","tooltipPlacement","id","effect","type","place","border","getContent","pos","position","glyphData","slice","reverse","letterFreq","myidx","classNames","residue","frequency","toFixed","count","positionalFrequencies","numGlyphStacks","logoType","dy","freq","idx","BARS","xscale","width","height","numberSequences","getSequences","lettersSorted","getAllUpperAlphaLettersInAlignmentSorted","moleculeClass","getPredictedType","letterObjects","arr","plc","getPositionalLetterCounts","Array","from","letterCounts","fromSingleLetterCode","a","nextProps","glyphWidth","ReactTooltip","rebuild","mungeLogoData","totalWidth","preserveAspectRatio","viewBox","style","defaultProps","xmlns","singlePositionData","positionIdx","renderSinglePositionStack","data-for","data-tip","data-class","renderTooltip","React","Component","LETTERS","SequenceBarplotComponent","cache","state","svgHovered","positionsSelected","hoverKey","handleSvgHover","handlePositionHover","handlePositionClicked","isHovered","setState","onPositionMouseEnter","onPositionMouseLeave","relatedTarget","getBars","barsGroupedByPosition","positionHovered","element","bars","undefined","onPositionSelectionChanged","newPositionsSelected","some","p","allValidHeights","bar","overallMinHeight","min","overallMaxHeight","max","minHeight","maxHeight","dataSeriesSet","plotOptions","fixYMax","normalizedHeight","POSITION_VIEWBOX_HEIGHT","dataSeriesSetChanged","ds","allBars","concat","groupBy","categoryBars","normalizeBarHeights","flat","barsGroupedByDataseries","barsObj","posInt","posPlusOne","barsAtPostion","cssClass","backgroundColor","color","tooltipValueText","positionWidth","maxSeqLength","getMaxSequenceLength","POSITION_VIEWBOX_WIDTH","onMouseEnter","onMouseLeave","allBarsHeightsAtPosition","maxBarHeight","numDataSeries","size","barWidth","firstBarOffset","onClick","dataseriesIdx","renderBarPlot","SHANNON_ENTROPY_BARPLOT","al","allLettersInAlignment","log2","singlePlc","values","CONSERVATION_BARPLOT","ymax","entropyBar","KULLBAC_LEIBLER_DIVERGENCE_BARPLOT","allLetters","pk","qk","getGlobalAlphaLetterCounts","positionsPk","GAPS_BARPLOT","gapCount","getGapCountAtColumn","CanvasAlignmentViewport","PixiComponent","create","app","numColumns","numRows","stageDimensions","renderer","vp","Viewport","screenWidth","worldWidth","worldHeight","interaction","plugins","decelerate","clamp","direction","bounce","friction","time","underflow","drag","pinch","wheel","applyProps","oldProps","newProps","onMouseClick","e","world","y","resizedStage","newAlignment","clampWidthMax","clampHeightMax","resize","clampMinWidth","ensureVisible","clampZoom","maxWidth","fitWorld","setZoom","scale","newZoomLevel","CanvasAlignmentHighlighter","Graphics","interactive","instance","fillColor","fillAlpha","clear","beginFill","drawRect","endFill","dragFunctions","removeAllListeners","addListener","stopPropagation","dragStart","onDragStart","parent","dragEnd","onDragEnd","dragMove","onDragMove","CanvasAlignmentTiled","sortBy","fullWidth","fullHeight","sizes","targetTileWidth","targetTileHeight","tiledImages","initializeTiledImages","tileYNumber","numYTiles","tileXNumber","numXTiles","tiledImage","generateCanvasForTile","tiles","tile","source","image","pixelX","pixelY","tileX","tileY","getName","tileImageData","tileCanvasContext","tileCanvas","offsets","imageDataIdx","seqIdx","seq","seqY","letterIdx","letterX","getCurrentMoleculeColors","data","putImageData","lastTileHeight","lastTileWidth","fillRect","getImageData","colorCanvasWithSequence","consensusSequence","querySequence","molecule","floor","CanvasAlignmentComponent","divElement","body","overflow","onWheel","dragging","createRef","newMousePosition","onIndicatorDrag","dragPositions","round","startOffset","top","rowHighlightStart","rowHighlighterHeight","highlightRows","viewportProps","numSequences","PIXI","skipHello","SCALE_MODE","NEAREST","rowEnd","rowStart","current","stageHeight","stageWidth","ref","options","transparent","Consumer","startPosition","getLocalPosition","left","informParentOfIndicatorDragged","newPosition","MiniMapComponent","resizeSensor","renderCanvasComponent","alignmentStyle","getSizing","frameWidth","frameHeight","innerHeight","setupResizeSensor","startingWidth","resizedWidth","adjustForBorderAndMargin","borderWidth","margin","ResizeSensor","clientWidth","clientHeight","setTimeout","alignHorizontal","resizable","verticalHeight","right","AceEditorComponent","editor","lastText","lastMode","lastElementWidth","lastElementHeight","text","editorMode","el","ace","edit","setShowPrintMargin","setReadOnly","setHighlightActiveLine","setHighlightGutterLine","setFontSize","fontSize","setShowGutter","setPadding","$cursorLayer","display","characterSizeChanged","mouseDown","mouseMove","getMousePosition","getDocumentPosition","screenCoordinates","textToScreenCoordinates","row","column","mouseRow","mouseColumn","mousePageX","pageX","mousePageY","pageY","getFontSize","getEditorMode","newMode","setMode","getText","selectAll","removeLines","newText","insert","setupEditor","addEventListeners","setText","editorLoaded","mouseEnter","mouseLeave","initialLoad","AceMultipleSequenceAlignmentComponent","join","getAceEditorMode","ACE_EDITOR_IDS","AceConsensusSequenceComponent","AceQuerySequenceComponent","AceTextualRulerComponent","generateTextualRuler","maxLength","sn","np","substr","zoomLevel","showAnnotations","showConsensus","showLogo","showMinimap","showQuery","showRuler","logoOptions","minimapOptions","barplots","AlignmentViewer","verticalScrollSync","horizontalScrollSync","renderSequenceLogo","logoOpts","aceCharacterWidth","renderBarplot","barplotProps","renderConsensusQueryBox","aceEditorLoaded","renderQuerySeqBox","renderPositionBox","POSITIONAL_RULER","renderAlignmentBox","handleCharacterSizeChanged","MSA_SEQUENCES","both","renderAlignmentAnnotationBox","MSA_IDS","vertical","aceEditors","windowWidth","innerWidth","minimapClicked","minimapRectHighlightMoved","windowDimensionsUpdated","newCharSize","scrollSyncDirection","registerAceScroller","startState","newAceEditors","characterWidth","msaEditorVewport","numberVisibleRows","getLastFullyVisibleRow","getFirstFullyVisibleRow","firstFullyVisibleRow","lastFullyVisibleRow","mousePosition","numRowsVisibleInAceEditor","newY","scrollToRow","rectBounds","annotation","content","addAsElementToScrollSync","registerElementScroller","mmOptions","classes","renderMiniMap","barplot","renderWidget","series","dataseries","Alignment","uuid","aceEditorMode","predictedNT","positionalLetterCounts","globalAlphaLetterCounts","allUpperAlphaLettersInAlignmentSorted","consensus","start","Date","allUniqueCharCodes","sequenceLengths","seqStr","len","charCode","charCodeAt","seqLength","positionalCharCodeCounts","globalCharCodeCounts","acc2","charCodeStr","aIsLowerAlpha","match","aIsUpperAlpha","bIsLowerAlpha","bIsUpperAlpha","getTime","validLetters","totalCounts","mode","modeSplit","modeName","define","require","exports","module","oop","TextHighlightRules","AlignmentHighlightRules","rules","re","stateName","nextStateName","token","regex","next","$rules","inherits","TextMode","Mode","Tokenizer","$tokenizer","getRules","call","prototype","defineNewAlignmentMode","isNaN","normalize","normalizeLetterCounts","forceReSort","FastaAlignment","fileName","fileContents","trimmedFile","trim","fastaSplitCaret","seqArr","seqObj","message","StockholmAlignment","metadata","trimmedAndSplit","startsWith","GF","GS","GR","GC","line","warn","metadataGroup","keyVal","seqId","featureVal","AlignmentLoadError","errors","possibleResolution","AlignmentLoader","url","callback","errorCallback","alignmentName","File","fetch","blob","substring","lastIndexOf","f","error","err","loadAlignmentFromFile","file","reader","FileReader","onload","loadAlignmentFromText","result","readAsText","AlignmentFileTypes","fromFileContents","AlignmentFileLoaderComponent","fileInput","handleFileUploadInputChange","handleClick","alignmentLoaded","preventDefault","click","onAlignmentLoaded","value","onFileLoadStart","onAlignmenLoadError","files","fileSelectorLabelText","onChange","exampleFiles","ef","fileURL","loadAlignmentFromURL","labelText","renderFileUpload","renderExampleFiles","URL_PARAM_NAMES","App","renderSettingsBox","loading","loadError","showSettings","alignmentDescription","href","target","rel","alt","src","process","padding","renderAlignmentTypeLabel","renderSortControl","renderColorScheme","renderResidueDetail","renderPositionStyling","renderZoomButtons","renderMiniMapToggle","renderConservationBarplotToggle","renderEntropyGapBarplotToggle","renderKLDivergenceBarplot","renderAnnotationToggle","sorters","fromKey","sso","fromAlignmentType","index","rd","pts","logoPlotStyle","disabled","onAlignmentReceived","onAlignmentLoadError","checked","showConservationBarplot","showEntropyGapBarplot","showKLDivergenceBarplot","showMiniMap","params","location","search","v","decodeURIComponent","alignmentElement","getDefaultStyle","Boolean","hostname","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"qZA6BaA,G,MAAuC,CAClD,CAAEC,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,IACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,MAAO,GACrC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,IAAKC,OAAQ,GACtC,CAAEF,QAAS,IAAKC,QAAS,I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","file":"static/js/main.ce0f5bb6.chunk.js","sourcesContent":["/**\n * This class a bunch of blosum matricies. Taken from the biopython project:\n *\n */\n\n//export const blosum62 = new Map<string, Map<string, number>>([\n//  [\"W\", [[\"F\", 1]]]\n//]);\n\ninterface ISubstitutionMatrixInput {\n  letterA: string;\n  letterB: string;\n  score: number;\n}\n\nconst constructSubstitutionMatrix = (arr: ISubstitutionMatrixInput[]) => {\n  return arr.reduce((acc, matInput) => {\n    if (!acc.has(matInput.letterA)) {\n      acc.set(matInput.letterA, new Map<string, number>());\n    }\n    if (!acc.has(matInput.letterB)) {\n      acc.set(matInput.letterB, new Map<string, number>());\n    }\n    acc.get(matInput.letterA)!.set(matInput.letterB, matInput.score);\n    acc.get(matInput.letterB)!.set(matInput.letterA, matInput.score);\n    return acc;\n  }, new Map<string, Map<string, number>>());\n};\n\nexport const BLOSUM62 = constructSubstitutionMatrix([\n  { letterA: \"W\", letterB: \"F\", score: 1 },\n  { letterA: \"L\", letterB: \"R\", score: -2 },\n  { letterA: \"S\", letterB: \"P\", score: -1 },\n  { letterA: \"V\", letterB: \"T\", score: 0 },\n  { letterA: \"Q\", letterB: \"Q\", score: 5 },\n  { letterA: \"N\", letterB: \"A\", score: -2 },\n  { letterA: \"Z\", letterB: \"Y\", score: -2 },\n  { letterA: \"W\", letterB: \"R\", score: -3 },\n  { letterA: \"Q\", letterB: \"A\", score: -1 },\n  { letterA: \"S\", letterB: \"D\", score: 0 },\n  { letterA: \"H\", letterB: \"H\", score: 8 },\n  { letterA: \"S\", letterB: \"H\", score: -1 },\n  { letterA: \"H\", letterB: \"D\", score: -1 },\n  { letterA: \"L\", letterB: \"N\", score: -3 },\n  { letterA: \"W\", letterB: \"A\", score: -3 },\n  { letterA: \"Y\", letterB: \"M\", score: -1 },\n  { letterA: \"G\", letterB: \"R\", score: -2 },\n  { letterA: \"Y\", letterB: \"I\", score: -1 },\n  { letterA: \"Y\", letterB: \"E\", score: -2 },\n  { letterA: \"B\", letterB: \"Y\", score: -3 },\n  { letterA: \"Y\", letterB: \"A\", score: -2 },\n  { letterA: \"V\", letterB: \"D\", score: -3 },\n  { letterA: \"B\", letterB: \"S\", score: 0 },\n  { letterA: \"Y\", letterB: \"Y\", score: 7 },\n  { letterA: \"G\", letterB: \"N\", score: 0 },\n  { letterA: \"E\", letterB: \"C\", score: -4 },\n  { letterA: \"Y\", letterB: \"Q\", score: -1 },\n  { letterA: \"Z\", letterB: \"Z\", score: 4 },\n  { letterA: \"V\", letterB: \"A\", score: 0 },\n  { letterA: \"C\", letterB: \"C\", score: 9 },\n  { letterA: \"M\", letterB: \"R\", score: -1 },\n  { letterA: \"V\", letterB: \"E\", score: -2 },\n  { letterA: \"T\", letterB: \"N\", score: 0 },\n  { letterA: \"P\", letterB: \"P\", score: 7 },\n  { letterA: \"V\", letterB: \"I\", score: 3 },\n  { letterA: \"V\", letterB: \"S\", score: -2 },\n  { letterA: \"Z\", letterB: \"P\", score: -1 },\n  { letterA: \"V\", letterB: \"M\", score: 1 },\n  { letterA: \"T\", letterB: \"F\", score: -2 },\n  { letterA: \"V\", letterB: \"Q\", score: -2 },\n  { letterA: \"K\", letterB: \"K\", score: 5 },\n  { letterA: \"P\", letterB: \"D\", score: -1 },\n  { letterA: \"I\", letterB: \"H\", score: -3 },\n  { letterA: \"I\", letterB: \"D\", score: -3 },\n  { letterA: \"T\", letterB: \"R\", score: -1 },\n  { letterA: \"P\", letterB: \"L\", score: -3 },\n  { letterA: \"K\", letterB: \"G\", score: -2 },\n  { letterA: \"M\", letterB: \"N\", score: -2 },\n  { letterA: \"P\", letterB: \"H\", score: -2 },\n  { letterA: \"F\", letterB: \"Q\", score: -3 },\n  { letterA: \"Z\", letterB: \"G\", score: -2 },\n  { letterA: \"X\", letterB: \"L\", score: -1 },\n  { letterA: \"T\", letterB: \"M\", score: -1 },\n  { letterA: \"Z\", letterB: \"C\", score: -3 },\n  { letterA: \"X\", letterB: \"H\", score: -1 },\n  { letterA: \"D\", letterB: \"R\", score: -2 },\n  { letterA: \"B\", letterB: \"W\", score: -4 },\n  { letterA: \"X\", letterB: \"D\", score: -1 },\n  { letterA: \"Z\", letterB: \"K\", score: 1 },\n  { letterA: \"F\", letterB: \"A\", score: -2 },\n  { letterA: \"Z\", letterB: \"W\", score: -3 },\n  { letterA: \"F\", letterB: \"E\", score: -3 },\n  { letterA: \"D\", letterB: \"N\", score: 1 },\n  { letterA: \"B\", letterB: \"K\", score: 0 },\n  { letterA: \"X\", letterB: \"X\", score: -1 },\n  { letterA: \"F\", letterB: \"I\", score: 0 },\n  { letterA: \"B\", letterB: \"G\", score: -1 },\n  { letterA: \"X\", letterB: \"T\", score: 0 },\n  { letterA: \"F\", letterB: \"M\", score: 0 },\n  { letterA: \"B\", letterB: \"C\", score: -3 },\n  { letterA: \"Z\", letterB: \"I\", score: -3 },\n  { letterA: \"Z\", letterB: \"V\", score: -2 },\n  { letterA: \"S\", letterB: \"S\", score: 4 },\n  { letterA: \"L\", letterB: \"Q\", score: -2 },\n  { letterA: \"W\", letterB: \"E\", score: -3 },\n  { letterA: \"Q\", letterB: \"R\", score: 1 },\n  { letterA: \"N\", letterB: \"N\", score: 6 },\n  { letterA: \"W\", letterB: \"M\", score: -1 },\n  { letterA: \"Q\", letterB: \"C\", score: -3 },\n  { letterA: \"W\", letterB: \"I\", score: -3 },\n  { letterA: \"S\", letterB: \"C\", score: -1 },\n  { letterA: \"L\", letterB: \"A\", score: -1 },\n  { letterA: \"S\", letterB: \"G\", score: 0 },\n  { letterA: \"L\", letterB: \"E\", score: -3 },\n  { letterA: \"W\", letterB: \"Q\", score: -2 },\n  { letterA: \"H\", letterB: \"G\", score: -2 },\n  { letterA: \"S\", letterB: \"K\", score: 0 },\n  { letterA: \"Q\", letterB: \"N\", score: 0 },\n  { letterA: \"N\", letterB: \"R\", score: 0 },\n  { letterA: \"H\", letterB: \"C\", score: -3 },\n  { letterA: \"Y\", letterB: \"N\", score: -2 },\n  { letterA: \"G\", letterB: \"Q\", score: -2 },\n  { letterA: \"Y\", letterB: \"F\", score: 3 },\n  { letterA: \"C\", letterB: \"A\", score: 0 },\n  { letterA: \"V\", letterB: \"L\", score: 1 },\n  { letterA: \"G\", letterB: \"E\", score: -2 },\n  { letterA: \"G\", letterB: \"A\", score: 0 },\n  { letterA: \"K\", letterB: \"R\", score: 2 },\n  { letterA: \"E\", letterB: \"D\", score: 2 },\n  { letterA: \"Y\", letterB: \"R\", score: -2 },\n  { letterA: \"M\", letterB: \"Q\", score: 0 },\n  { letterA: \"T\", letterB: \"I\", score: -1 },\n  { letterA: \"C\", letterB: \"D\", score: -3 },\n  { letterA: \"V\", letterB: \"F\", score: -1 },\n  { letterA: \"T\", letterB: \"A\", score: 0 },\n  { letterA: \"T\", letterB: \"P\", score: -1 },\n  { letterA: \"B\", letterB: \"P\", score: -2 },\n  { letterA: \"T\", letterB: \"E\", score: -1 },\n  { letterA: \"V\", letterB: \"N\", score: -3 },\n  { letterA: \"P\", letterB: \"G\", score: -2 },\n  { letterA: \"M\", letterB: \"A\", score: -1 },\n  { letterA: \"K\", letterB: \"H\", score: -1 },\n  { letterA: \"V\", letterB: \"R\", score: -3 },\n  { letterA: \"P\", letterB: \"C\", score: -3 },\n  { letterA: \"M\", letterB: \"E\", score: -2 },\n  { letterA: \"K\", letterB: \"L\", score: -2 },\n  { letterA: \"V\", letterB: \"V\", score: 4 },\n  { letterA: \"M\", letterB: \"I\", score: 1 },\n  { letterA: \"T\", letterB: \"Q\", score: -1 },\n  { letterA: \"I\", letterB: \"G\", score: -4 },\n  { letterA: \"P\", letterB: \"K\", score: -1 },\n  { letterA: \"M\", letterB: \"M\", score: 5 },\n  { letterA: \"K\", letterB: \"D\", score: -1 },\n  { letterA: \"I\", letterB: \"C\", score: -1 },\n  { letterA: \"Z\", letterB: \"D\", score: 1 },\n  { letterA: \"F\", letterB: \"R\", score: -3 },\n  { letterA: \"X\", letterB: \"K\", score: -1 },\n  { letterA: \"Q\", letterB: \"D\", score: 0 },\n  { letterA: \"X\", letterB: \"G\", score: -1 },\n  { letterA: \"Z\", letterB: \"L\", score: -3 },\n  { letterA: \"X\", letterB: \"C\", score: -2 },\n  { letterA: \"Z\", letterB: \"H\", score: 0 },\n  { letterA: \"B\", letterB: \"L\", score: -4 },\n  { letterA: \"B\", letterB: \"H\", score: 0 },\n  { letterA: \"F\", letterB: \"F\", score: 6 },\n  { letterA: \"X\", letterB: \"W\", score: -2 },\n  { letterA: \"B\", letterB: \"D\", score: 4 },\n  { letterA: \"D\", letterB: \"A\", score: -2 },\n  { letterA: \"S\", letterB: \"L\", score: -2 },\n  { letterA: \"X\", letterB: \"S\", score: 0 },\n  { letterA: \"F\", letterB: \"N\", score: -3 },\n  { letterA: \"S\", letterB: \"R\", score: -1 },\n  { letterA: \"W\", letterB: \"D\", score: -4 },\n  { letterA: \"V\", letterB: \"Y\", score: -1 },\n  { letterA: \"W\", letterB: \"L\", score: -2 },\n  { letterA: \"H\", letterB: \"R\", score: 0 },\n  { letterA: \"W\", letterB: \"H\", score: -2 },\n  { letterA: \"H\", letterB: \"N\", score: 1 },\n  { letterA: \"W\", letterB: \"T\", score: -2 },\n  { letterA: \"T\", letterB: \"T\", score: 5 },\n  { letterA: \"S\", letterB: \"F\", score: -2 },\n  { letterA: \"W\", letterB: \"P\", score: -4 },\n  { letterA: \"L\", letterB: \"D\", score: -4 },\n  { letterA: \"B\", letterB: \"I\", score: -3 },\n  { letterA: \"L\", letterB: \"H\", score: -3 },\n  { letterA: \"S\", letterB: \"N\", score: 1 },\n  { letterA: \"B\", letterB: \"T\", score: -1 },\n  { letterA: \"L\", letterB: \"L\", score: 4 },\n  { letterA: \"Y\", letterB: \"K\", score: -2 },\n  { letterA: \"E\", letterB: \"Q\", score: 2 },\n  { letterA: \"Y\", letterB: \"G\", score: -3 },\n  { letterA: \"Z\", letterB: \"S\", score: 0 },\n  { letterA: \"Y\", letterB: \"C\", score: -2 },\n  { letterA: \"G\", letterB: \"D\", score: -1 },\n  { letterA: \"B\", letterB: \"V\", score: -3 },\n  { letterA: \"E\", letterB: \"A\", score: -1 },\n  { letterA: \"Y\", letterB: \"W\", score: 2 },\n  { letterA: \"E\", letterB: \"E\", score: 5 },\n  { letterA: \"Y\", letterB: \"S\", score: -2 },\n  { letterA: \"C\", letterB: \"N\", score: -3 },\n  { letterA: \"V\", letterB: \"C\", score: -1 },\n  { letterA: \"T\", letterB: \"H\", score: -2 },\n  { letterA: \"P\", letterB: \"R\", score: -2 },\n  { letterA: \"V\", letterB: \"G\", score: -3 },\n  { letterA: \"T\", letterB: \"L\", score: -1 },\n  { letterA: \"V\", letterB: \"K\", score: -2 },\n  { letterA: \"K\", letterB: \"Q\", score: 1 },\n  { letterA: \"R\", letterB: \"A\", score: -1 },\n  { letterA: \"I\", letterB: \"R\", score: -3 },\n  { letterA: \"T\", letterB: \"D\", score: -1 },\n  { letterA: \"P\", letterB: \"F\", score: -4 },\n  { letterA: \"I\", letterB: \"N\", score: -3 },\n  { letterA: \"K\", letterB: \"I\", score: -3 },\n  { letterA: \"M\", letterB: \"D\", score: -3 },\n  { letterA: \"V\", letterB: \"W\", score: -3 },\n  { letterA: \"W\", letterB: \"W\", score: 11 },\n  { letterA: \"M\", letterB: \"H\", score: -2 },\n  { letterA: \"P\", letterB: \"N\", score: -2 },\n  { letterA: \"K\", letterB: \"A\", score: -1 },\n  { letterA: \"M\", letterB: \"L\", score: 2 },\n  { letterA: \"K\", letterB: \"E\", score: 1 },\n  { letterA: \"Z\", letterB: \"E\", score: 4 },\n  { letterA: \"X\", letterB: \"N\", score: -1 },\n  { letterA: \"Z\", letterB: \"A\", score: -1 },\n  { letterA: \"Z\", letterB: \"M\", score: -1 },\n  { letterA: \"X\", letterB: \"F\", score: -1 },\n  { letterA: \"K\", letterB: \"C\", score: -3 },\n  { letterA: \"B\", letterB: \"Q\", score: 0 },\n  { letterA: \"X\", letterB: \"B\", score: -1 },\n  { letterA: \"B\", letterB: \"M\", score: -3 },\n  { letterA: \"F\", letterB: \"C\", score: -2 },\n  { letterA: \"Z\", letterB: \"Q\", score: 3 },\n  { letterA: \"X\", letterB: \"Z\", score: -1 },\n  { letterA: \"F\", letterB: \"G\", score: -3 },\n  { letterA: \"B\", letterB: \"E\", score: 1 },\n  { letterA: \"X\", letterB: \"V\", score: -1 },\n  { letterA: \"F\", letterB: \"K\", score: -3 },\n  { letterA: \"B\", letterB: \"A\", score: -2 },\n  { letterA: \"X\", letterB: \"R\", score: -1 },\n  { letterA: \"D\", letterB: \"D\", score: 6 },\n  { letterA: \"W\", letterB: \"G\", score: -2 },\n  { letterA: \"Z\", letterB: \"F\", score: -3 },\n  { letterA: \"S\", letterB: \"Q\", score: 0 },\n  { letterA: \"W\", letterB: \"C\", score: -2 },\n  { letterA: \"W\", letterB: \"K\", score: -3 },\n  { letterA: \"H\", letterB: \"Q\", score: 0 },\n  { letterA: \"L\", letterB: \"C\", score: -1 },\n  { letterA: \"W\", letterB: \"N\", score: -4 },\n  { letterA: \"S\", letterB: \"A\", score: 1 },\n  { letterA: \"L\", letterB: \"G\", score: -4 },\n  { letterA: \"W\", letterB: \"S\", score: -3 },\n  { letterA: \"S\", letterB: \"E\", score: 0 },\n  { letterA: \"H\", letterB: \"E\", score: 0 },\n  { letterA: \"S\", letterB: \"I\", score: -2 },\n  { letterA: \"H\", letterB: \"A\", score: -2 },\n  { letterA: \"S\", letterB: \"M\", score: -1 },\n  { letterA: \"Y\", letterB: \"L\", score: -1 },\n  { letterA: \"Y\", letterB: \"H\", score: 2 },\n  { letterA: \"Y\", letterB: \"D\", score: -3 },\n  { letterA: \"E\", letterB: \"R\", score: 0 },\n  { letterA: \"X\", letterB: \"P\", score: -2 },\n  { letterA: \"G\", letterB: \"G\", score: 6 },\n  { letterA: \"G\", letterB: \"C\", score: -3 },\n  { letterA: \"E\", letterB: \"N\", score: 0 },\n  { letterA: \"Y\", letterB: \"T\", score: -2 },\n  { letterA: \"Y\", letterB: \"P\", score: -3 },\n  { letterA: \"T\", letterB: \"K\", score: -1 },\n  { letterA: \"A\", letterB: \"A\", score: 4 },\n  { letterA: \"P\", letterB: \"Q\", score: -1 },\n  { letterA: \"T\", letterB: \"C\", score: -1 },\n  { letterA: \"V\", letterB: \"H\", score: -3 },\n  { letterA: \"T\", letterB: \"G\", score: -2 },\n  { letterA: \"I\", letterB: \"Q\", score: -3 },\n  { letterA: \"Z\", letterB: \"T\", score: -1 },\n  { letterA: \"C\", letterB: \"R\", score: -3 },\n  { letterA: \"V\", letterB: \"P\", score: -2 },\n  { letterA: \"P\", letterB: \"E\", score: -1 },\n  { letterA: \"M\", letterB: \"C\", score: -1 },\n  { letterA: \"K\", letterB: \"N\", score: 0 },\n  { letterA: \"I\", letterB: \"I\", score: 4 },\n  { letterA: \"P\", letterB: \"A\", score: -1 },\n  { letterA: \"M\", letterB: \"G\", score: -3 },\n  { letterA: \"T\", letterB: \"S\", score: 1 },\n  { letterA: \"I\", letterB: \"E\", score: -3 },\n  { letterA: \"P\", letterB: \"M\", score: -2 },\n  { letterA: \"M\", letterB: \"K\", score: -1 },\n  { letterA: \"I\", letterB: \"A\", score: -1 },\n  { letterA: \"P\", letterB: \"I\", score: -3 },\n  { letterA: \"R\", letterB: \"R\", score: 5 },\n  { letterA: \"X\", letterB: \"M\", score: -1 },\n  { letterA: \"L\", letterB: \"I\", score: 2 },\n  { letterA: \"X\", letterB: \"I\", score: -1 },\n  { letterA: \"Z\", letterB: \"B\", score: 1 },\n  { letterA: \"X\", letterB: \"E\", score: -1 },\n  { letterA: \"Z\", letterB: \"N\", score: 0 },\n  { letterA: \"X\", letterB: \"A\", score: 0 },\n  { letterA: \"B\", letterB: \"R\", score: -1 },\n  { letterA: \"B\", letterB: \"N\", score: 3 },\n  { letterA: \"F\", letterB: \"D\", score: -3 },\n  { letterA: \"X\", letterB: \"Y\", score: -1 },\n  { letterA: \"Z\", letterB: \"R\", score: 0 },\n  { letterA: \"F\", letterB: \"H\", score: -1 },\n  { letterA: \"B\", letterB: \"F\", score: -3 },\n  { letterA: \"F\", letterB: \"L\", score: 0 },\n  { letterA: \"X\", letterB: \"Q\", score: -1 },\n  { letterA: \"B\", letterB: \"B\", score: 4 },\n]);\n","/**\n * This class conatins methods for sorting sequences\n */\nimport { Alignment, ISequence } from \"./Alignment\";\nimport { BLOSUM62 } from \"./BLOSUM\";\n\nexport class SequenceSorter {\n  /*\n   *\n   *\n   * HELPER\n   *\n   *\n   */\n  private static hammingDistance(seq1: ISequence, seq2: ISequence) {\n    const minLength =\n      seq1.sequence.length < seq2.sequence.length\n        ? seq1.sequence.length\n        : seq2.sequence.length;\n    //if they are not the same length, those extra positions in one\n    //sequence count as differences to the other sequence\n    let distance = Math.abs(seq1.sequence.length - seq2.sequence.length);\n    for (var i = 0; i < minLength; i++) {\n      if (seq1.sequence[i] !== seq2.sequence[i]) {\n        distance += 1;\n      }\n    }\n    return distance;\n  }\n\n  private static blosumScore(seq1: ISequence, seq2: ISequence) {\n    const minLength =\n      seq1.sequence.length < seq2.sequence.length\n        ? seq1.sequence.length\n        : seq2.sequence.length;\n    let score = 0;\n    for (var i = 0; i < minLength; i++) {\n      if (\n        BLOSUM62.has(seq1.sequence[i]) &&\n        BLOSUM62.get(seq1.sequence[i])!.has(seq2.sequence[i])\n      ) {\n        score += BLOSUM62.get(seq1.sequence[i])!.get(seq2.sequence[i])!;\n      } else {\n        //one or both letters are not in the blosum alignment. Occurs when\n        //there are lower case letters or gaps.\n        //TODO: is counting as zero the correct way to handle this?\n      }\n    }\n    return score;\n  }\n\n  /*\n   *\n   *\n   * AVAILBLE SORT TYPES WITH FUNCTIONS\n   *\n   *\n   */\n  static readonly INPUT = new SequenceSorter(\n    \"as-input\",\n    \"As input\",\n    false,\n    \"both\",\n    (sequencesAsInput, alignment) => sequencesAsInput\n  );\n\n  static readonly HAMMING_DIST_QUERY = new SequenceSorter(\n    \"hamming-dist-to-query\",\n    \"Hamming distance to query sequence\",\n    true,\n    \"both\",\n    (sequences, alignment) => {\n      const querySeq = alignment.getQuerySequence();\n      return sequences\n        .map((s) => s)\n        .sort((seq1, seq2) => {\n          const dist1 = SequenceSorter.hammingDistance(querySeq, seq1);\n          const dist2 = SequenceSorter.hammingDistance(querySeq, seq2);\n          return dist1 - dist2;\n        });\n    }\n  );\n\n  static readonly HAMMING_DIST_CONSENSUS = new SequenceSorter(\n    \"hamming-dist-to-consensus\",\n    \"Hamming distance to consensus sequence\",\n    true,\n    \"both\",\n    (sequences, alignment) => {\n      const consensusSeq = alignment.getConsensus();\n      return sequences\n        .map((s) => s)\n        .sort((seq1, seq2) => {\n          const dist1 = SequenceSorter.hammingDistance(consensusSeq, seq1);\n          const dist2 = SequenceSorter.hammingDistance(consensusSeq, seq2);\n          return dist1 - dist2;\n        });\n    }\n  );\n\n  static readonly BLOSUM62_SCORE_CONSENSUS = new SequenceSorter(\n    \"blosum-score-to-consensus\",\n    \"BLOSUM62 score to consensus sequence\",\n    true,\n    \"aminoacid\",\n    (sequences, alignment) => {\n      const consensusSeq = alignment.getConsensus();\n      return sequences\n        .map((s) => s)\n        .sort((seq1, seq2) => {\n          const dist1 = SequenceSorter.blosumScore(consensusSeq, seq1);\n          const dist2 = SequenceSorter.blosumScore(consensusSeq, seq2);\n          return dist2 - dist1; //reverse from distance\n        });\n    }\n  );\n\n  static readonly BLOSUM62_SCORE_QUERY = new SequenceSorter(\n    \"blosum-score-to-query\",\n    \"BLOSUM62 score to query sequence\",\n    true,\n    \"aminoacid\",\n    (sequences, alignment) => {\n      const querySeq = alignment.getQuerySequence();\n      return sequences\n        .map((s) => s)\n        .sort((seq1, seq2) => {\n          const dist1 = SequenceSorter.blosumScore(querySeq, seq1);\n          const dist2 = SequenceSorter.blosumScore(querySeq, seq2);\n          return dist2 - dist1; //reverse from distance\n        });\n    }\n  );\n\n  /*\n   *\n   *\n   * LIST OF ALL AVAILABLE OPTIONS\n   *\n   *\n   */\n  private static list = [\n    SequenceSorter.INPUT,\n    SequenceSorter.HAMMING_DIST_QUERY,\n    SequenceSorter.HAMMING_DIST_CONSENSUS,\n    SequenceSorter.BLOSUM62_SCORE_QUERY,\n    SequenceSorter.BLOSUM62_SCORE_CONSENSUS,\n  ];\n\n  static aminoAcidSorters = SequenceSorter.list.reduce((acc, seqSort) => {\n    if (\n      seqSort.targetAlignmentType === \"aminoacid\" ||\n      seqSort.targetAlignmentType === \"both\"\n    ) {\n      acc.push(seqSort);\n    }\n    return acc;\n  }, [] as SequenceSorter[]);\n\n  static nucleotideSorters = SequenceSorter.list.reduce((acc, seqSort) => {\n    if (\n      seqSort.targetAlignmentType === \"nucleotide\" ||\n      seqSort.targetAlignmentType === \"both\"\n    ) {\n      acc.push(seqSort);\n    }\n    return acc;\n  }, [] as SequenceSorter[]);\n\n  static fromKey(key: string) {\n    return SequenceSorter.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly isQuerySequenceDependent: boolean,\n    public readonly targetAlignmentType: \"aminoacid\" | \"nucleotide\" | \"both\",\n    public readonly sortFn: (\n      sequencesAsInput: ISequence[],\n      alignment: Alignment\n    ) => ISequence[]\n  ) {}\n}\n","/**\n * Convert any valid color string into a hex code and RGB\n * value using the built in browser converter.\n * taken from\n * https://stackoverflow.com/questions/1573053/\n * and\n * https://stackoverflow.com/questions/5623838/\n * @param str The string to convert\n * @returns An object that contains the hex and rgb values for that string\n *          Default to black (#000000) if the string is not recognized.\n */\nexport function stringToColor(\n  str: string\n): {\n  hex: string;\n  rgb: { red: number; green: number; blue: number };\n} {\n  const ctx = document.createElement(\"canvas\").getContext(\"2d\");\n  ctx!.fillStyle = str;\n  let hex = ctx!.fillStyle!;\n\n  // Expand shorthand form (e.g. \"03F\") to full form (e.g. \"0033FF\")\n  // https://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb\n  // (I think only necessary in testing, but might catch odd browser behavior)\n  var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n  hex = hex.replace(shorthandRegex, function (m, r, g, b) {\n    return \"#\" + r + r + g + g + b + b;\n  });\n\n  var rgbaResult = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)!;\n  return {\n    hex: hex,\n    rgb: {\n      red: parseInt(rgbaResult[1], 16),\n      green: parseInt(rgbaResult[2], 16),\n      blue: parseInt(rgbaResult[3], 16),\n    },\n  };\n}\n\n/**\n * Generate a UUID. Modified from:\n * https://stackoverflow.com/questions/105034\n */\nexport function generateUUIDv4() {\n  const x = (([1e7] as any) + -1e3 + -4e3 + -8e3 + -1e11) as string;\n  return x.replace(/[018]/g, function (c: string) {\n    return (\n      parseInt(c) ^\n      (window.crypto.getRandomValues(new Uint8Array(1))[0] &\n        (15 >> (parseInt(c) / 4)))\n    ).toString(16);\n  });\n}\n\n/**\n * Creates an object composed of keys generated from the results of\n * running each element of collection through fn. The corresponding\n * value of each key is an array of the elements responsible for\n * generating the key. (description taken from lodash documentation)\n *\n * The difference between this function and the lodash \"groupBy\",\n * function is that this returns a Map object, allowing for more complex\n * keys.\n *\n * @param items\n * @param fn\n */\nexport function mapGroupBy<T1, T2>(\n  items: T1[],\n  fn: (item: T1) => T2\n): Map<T2, T1[]> {\n  //{ [key: string]: T[] } {\n  return items.reduce((acc, item) => {\n    const key = fn(item);\n    const existing = acc.get(key) ? acc.get(key)! : [];\n    acc.set(key, [...existing, item]);\n    return acc;\n  }, new Map<T2, T1[]>());\n}\n\n/**\n * Array type that requires at least one array element.\n * https://stackoverflow.com/questions/49910889\n */\nexport type ArrayOneOrMore<T> = {\n  0: T;\n} & Array<T>;\n\n/**\n * Get all the parameters in the URL. Taken from:\n * https://stackoverflow.com/questions/979975\n */\nexport function getURLParameters() {\n  return window.location.search\n    .substring(1)\n    .split(\"&\")\n    .map((v) => v.split(\"=\"))\n    .reduce(\n      (map, [key, value]) => map.set(key, decodeURIComponent(value)),\n      new Map<string, string>()\n    );\n}\n\n/**\n * Get an Error that represents a parser problem\n */\nexport function getParseError(parserName: string, errorMessage: string) {\n  const toReturn = new Error(errorMessage);\n  toReturn.name = parserName + \" Parse Error\";\n  return toReturn;\n}\n","import { Ace } from \"ace-builds\";\n\n/**\n * ScrollSync.ts\n * This helper is used to synchronize the different ace and div scrolling\n * scrolling.\n *\n * Example usage:\n *     import ScrollSync from './ScrollSync';\n *     let scrollSyncV = new ScrollSync(ScrollType.vertical);\n *     scrollSyncV.registerScroller(domElement);\n *     scrollSyncV.registerScroller(aceEditor);\n *\n * Ideas adapted to work with both dom elements and ace from 2 projects\n * (each of which are aimed at dom elements):\n *   https://github.com/okonet/react-scroll-sync\n *   https://github.com/AhmadMHawwash/scroll-sync-react\n */\nexport enum ScrollType {\n  vertical,\n  horizontal,\n  both,\n}\n\nexport class ScrollSync {\n  private scrollDirection: ScrollType.vertical | ScrollType.horizontal;\n  private aceEditorDirection: \"changeScrollLeft\" | \"changeScrollTop\";\n  private scrollers: (Ace.Editor | HTMLElement)[];\n\n  //reuse the same scroll functions for each element / ace editor\n  private scrollFnHandles: Map<\n    Ace.Editor | HTMLElement,\n    (this: HTMLElement) => any\n  >;\n\n  /*\n   *\n   *\n   * PUBLIC METHODS\n   *\n   *\n   */\n  constructor(scrollDirection: ScrollType.vertical | ScrollType.horizontal) {\n    this.scrollDirection = scrollDirection;\n    this.aceEditorDirection =\n      scrollDirection === ScrollType.horizontal\n        ? \"changeScrollLeft\"\n        : \"changeScrollTop\";\n    this.scrollers = [];\n    this.scrollFnHandles = new Map<\n      Ace.Editor | HTMLElement,\n      (this: HTMLElement) => any\n    >();\n  }\n\n  /**\n   * Register a scroller with this scroll sync. By attaching\n   * the scroll events only when a scroll is possible, we avoid\n   * ths jerky-ness and potential forever loop of one scroll\n   * updating another back and forth.\n   * @param scroller\n   */\n  registerElementScroller(scroller: HTMLElement) {\n    if (!this.scrollers.includes(scroller)) {\n      this.scrollers.push(scroller);\n      scroller.addEventListener(\"mouseenter\", () => {\n        this.addScrollEvents(scroller);\n      });\n      scroller.addEventListener(\"mouseleave\", () => {\n        this.removeScrollEvents(scroller);\n      });\n    }\n  }\n\n  /**\n   * Register a scroller with this scroll sync. By attaching\n   * the scroll events only when a scroll is possible, we avoid\n   * ths jerky-ness and potential forever loop of one scroll\n   * updating another back and forth.\n   * Note - the ace editor doesn't have a native mouseenter/leave\n   * so we need to use the parent element's event listeners.\n   * @param scroller\n   */\n  registerAceScroller(scroller: Ace.Editor, parentElem: HTMLElement) {\n    if (!this.scrollers.includes(scroller)) {\n      this.scrollers.push(scroller);\n\n      parentElem.addEventListener(\"mouseenter\", () => {\n        this.addScrollEvents(scroller);\n      });\n      parentElem.addEventListener(\"mouseleave\", () => {\n        this.removeScrollEvents(scroller);\n      });\n    }\n  }\n\n  /**\n   * Deregister a scroller with this scroll sync\n   * Requires removal of mouse events also ..\n   * @param scroller\n   */\n  //unRegisterScroller(scroller: HTMLElement | Ace.Editor) {\n  //  this.scrollers = this.scrollers.filter((s) => s !== scroller);\n  //  this.removeScrollEvents(scroller);\n  //}\n\n  /*\n   *\n   *\n   * PRIVATE METHODS\n   *\n   *\n   */\n  private isAceEditor(x: Ace.Editor | HTMLElement): x is Ace.Editor {\n    return \"renderer\" in x;\n  }\n\n  /**\n   * Execute the scroll changes to all group scrollers.\n   *\n   * Note: the reason for jumpy scrolling I think is due\n   * to easing from the scroller, that doesn't happen with the\n   * scrollSibling. I'm not sure how to fix (one thought was\n   * to cancel the scroll event and set the position myself,\n   * but one can't cancel a scroll event).\n   */\n  private handleScroll = (\n    scroller: Ace.Editor | HTMLElement,\n    event?: Event\n  ) => {\n    const siblingScrollers = this.scrollers.filter(\n      (possibleSib) => possibleSib !== scroller\n    );\n    siblingScrollers.forEach((siblingScroller) => {\n      this.syncScrollPosition(scroller, siblingScroller);\n    });\n  };\n\n  /**\n   * This function executes the actual position sync\n   * @param scroller\n   * @param siblingScroller\n   */\n  private syncScrollPosition(\n    scroller: Ace.Editor | HTMLElement,\n    siblingScroller: Ace.Editor | HTMLElement\n  ) {\n    if (this.scrollDirection === ScrollType.horizontal) {\n      const newScrollLeft = this.isAceEditor(scroller)\n        ? scroller.session.getScrollLeft()\n        : scroller.scrollLeft;\n\n      if (this.isAceEditor(siblingScroller)) {\n        if (siblingScroller.session.getScrollLeft() !== newScrollLeft) {\n          siblingScroller.session.setScrollLeft(newScrollLeft);\n        }\n      } else if (siblingScroller.scrollLeft !== newScrollLeft) {\n        siblingScroller.scrollLeft = newScrollLeft;\n      }\n    } else {\n      const newScrollTop = this.isAceEditor(scroller)\n        ? scroller.session.getScrollTop()\n        : scroller.scrollTop;\n\n      if (this.isAceEditor(siblingScroller)) {\n        if (siblingScroller.session.getScrollTop() !== newScrollTop) {\n          siblingScroller.session.setScrollTop(newScrollTop);\n        }\n      } else if (siblingScroller.scrollTop !== newScrollTop) {\n        siblingScroller.scrollTop = newScrollTop;\n      }\n    }\n  }\n\n  /**\n   * Add event listeners and functions from a particular scroller\n   * @param scroller\n   */\n  private addScrollEvents(scroller: Ace.Editor | HTMLElement) {\n    if (!this.scrollFnHandles.has(scroller)) {\n      this.scrollFnHandles.set(\n        scroller,\n        this.handleScroll.bind(this, scroller)\n      );\n    }\n\n    const scrollFn = this.scrollFnHandles.get(scroller)!;\n    if (this.isAceEditor(scroller)) {\n      scroller.session.on(this.aceEditorDirection, scrollFn);\n    } else {\n      scroller.addEventListener(\"scroll\", scrollFn);\n    }\n  }\n\n  /**\n   * Remove event listeners and functions from a particular scroller\n   * @param scroller\n   */\n  private removeScrollEvents(scroller: Ace.Editor | HTMLElement) {\n    const scrollFn = this.scrollFnHandles.get(scroller);\n    if (scrollFn) {\n      if (this.isAceEditor(scroller)) {\n        scroller.session.off(this.aceEditorDirection, scrollFn);\n      } else {\n        scroller.removeEventListener(\"scroll\", scrollFn);\n      }\n    } else {\n      console.log(\"failed to remove scrollFn\");\n    }\n  }\n}\n","/**\n *\n * Glyph definitions for the logo component.\n * Inspired / derived from https://github.com/weng-lab/logojs-package\n *\n */\nimport React from \"react\";\n\nexport class GlyphFactory {\n  private static singleton: undefined | GlyphFactory;\n\n  private letterToGlyphHM: {\n    [key: string]: (props: { [key: string]: string }) => JSX.Element;\n  } = {\n    A: GlyphFactory.A,\n    B: GlyphFactory.B,\n    C: GlyphFactory.C,\n    D: GlyphFactory.D,\n    E: GlyphFactory.E,\n    F: GlyphFactory.F,\n    G: GlyphFactory.G,\n    H: GlyphFactory.H,\n    I: GlyphFactory.I,\n    J: GlyphFactory.J,\n    K: GlyphFactory.K,\n    L: GlyphFactory.L,\n    M: GlyphFactory.M,\n    N: GlyphFactory.N,\n    O: GlyphFactory.O,\n    P: GlyphFactory.P,\n    Q: GlyphFactory.Q,\n    R: GlyphFactory.R,\n    S: GlyphFactory.S,\n    T: GlyphFactory.T,\n    U: GlyphFactory.U,\n    V: GlyphFactory.V,\n    W: GlyphFactory.W,\n    X: GlyphFactory.X,\n    Y: GlyphFactory.Y,\n    Z: GlyphFactory.Z\n  };\n\n  static glyphFromChar(letter: string) {\n    if (!GlyphFactory.singleton) {\n      GlyphFactory.singleton = new GlyphFactory();\n    }\n    return GlyphFactory.singleton.letterToGlyphHM[letter];\n  }\n\n  private static A = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 100 L 33 0 L 66 0 L 100 100 L 75 100 L 66 75 L 33 75 L 25 100 L 0 100\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 41 55 L 50 25 L 58 55 L 41 55\"\n      />\n    </g>\n  );\n\n  private static B = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 C 105 50 105 100 80 100 L 00 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n        fill=\"#ffffff\"\n      />\n      <path\n        key={props.key + \"_p3\"}\n        transform={props.transform}\n        d=\"M 20 65 L 70 65 C 80 65 80 85 70 85 L 20 85 L 20 65\"\n        fill=\"#ffffff\"\n      />\n    </g>\n  );\n\n  private static C = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 100 28 C 100 -13 0 -13 0 50\n      C 0 113 100 113 100 72 L 75 72\n      C 75 90 30 90 30 50 C 30 10 75 10 75 28\n      L 100 28\"\n    />\n  );\n\n  private static D = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path {...props} d=\"M 0 0 L 60 0 C 110 0 110 100 60 100 L 0 100 L 0 0\" />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 40 15 C 85 15 85 85 40 85 L 20 85 L 20 15\"\n      />\n    </g>\n  );\n\n  private static E = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 90 40 L 90 60 L 20 60 L 20 80 L 100 80 L 100 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static F = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 20 20 L 20 40 L 80 40 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static G = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 100 28 C 100 -13 0 -13 0 50 C 0 113 100 113 100 72 L 100 48 L 55 48 L 55 72 L 75 72 C 75 90 30 90 30 50 C 30 10 75 5 75 28 L 100 28\"\n    />\n  );\n\n  private static H = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 20 40 L 80 40 L 80 0 L 100 0 L 100 100 L 80 100 L 80 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static I = (props: { [key: string]: string }) => (\n    <path {...props} d=\"M 40 0 L 60 0 L 60 100 L 40 100 L 40 0\" />\n  );\n\n  private static J = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 60 C 0 111 100 111 100 60 L 100 0 L 75 0 L 75 60 C 80 90 20 90 25 60\"\n    />\n  );\n\n  private static K = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 20 40 L 75 0 L 100 0 L 50 50 L 100 100 L 75 100 L 30 65 L 20 75 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static L = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 100 L 100 100 L 100 80 L 20 80 L 20 0 L 0 0\"\n    />\n  );\n\n  private static M = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 35 L 80 0 L 100 0 L 100 100 L 80 100 L 80 30 L 50 65 L 20 30 L 20 100 L 0 100 L 0 0\"\n    />\n  );\n\n  private static N = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 100 L 0 0 L 20 0 L 80 75 L 80 0 L 100 0 L 100 100 L 80 100 L 20 25 L 20 100 L 0 100\"\n    />\n  );\n\n  private static O = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <circle cx=\"50\" cy=\"50\" r=\"50\" {...props} />\n      <circle\n        key={props.key + \"_c2\"}\n        transform={props.transform}\n        cx=\"50\"\n        cy=\"50\"\n        r=\"32\"\n        fill=\"#ffffff\"\n      />\n    </g>\n  );\n\n  private static P = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 L 20 50 L 20 100 L 0 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n      />\n    </g>\n  );\n\n  private static Q = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <circle\n        cx=\"50\"\n        cy=\"50\"\n        r=\"50\"\n        {...{ ...props, key: props.key + \"_c1\" }}\n      />\n      <circle\n        key={props.key + \"_c2\"}\n        transform={props.transform}\n        cx=\"50\"\n        cy=\"50\"\n        r=\"32\"\n        fill=\"#ffffff\"\n      />\n      <path d=\"M 85 100 L 55 70 L 70 55 L 100 85 L 85 100\" {...props} />\n    </g>\n  );\n\n  private static R = (props: { [key: string]: string }) => (\n    <g key={props.key + \"_g\"}>\n      <path\n        {...props}\n        d=\"M 0 0 L 80 0 C 105 0 105 50 80 50 C 100 50 100 70 100 70 L 100 100 L 80 100 L 80 80 C 80 80 80 60 50 60 L 20 60 L 20 100 L 0 100 L 0 0\"\n      />\n      <path\n        key={props.key + \"_p2\"}\n        transform={props.transform}\n        fill=\"#ffffff\"\n        d=\"M 20 15 L 70 15 C 80 15 80 35 70 35 L 20 35 L 20 15\"\n      />\n    </g>\n  );\n\n  /**\n   *NOTE: Requires \"stroke\" and \"strokeOpacity\" instead of just the fill prop.\n   */\n  private static S = (props: { [key: string]: string }) => {\n    if (!props.stroke) {\n      props.stroke = props.fill;\n    }\n    if (!props.strokeOpacity) {\n      props.strokeOpacity = props.fillOpacity;\n    }\n\n    return (\n      <path\n        fill=\"#ffffff\"\n        {...props}\n        strokeWidth=\"18\"\n        d=\"M92 26 A43 20 0 1 0 43 46 A42 23 0 1 1 9 68\"\n      />\n    );\n  };\n\n  private static T = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 20 L 35 20 L 35 100 L 65 100 L 65 20 L 100 20 L 100 0 L 0 0\"\n    />\n  );\n\n  private static U = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 0 60 C 0 111 100 111 100 60 L 100 0 L 75 0 L 75 60 C 80 90 20 90 25 60 L 25 0 L 0 0\"\n    />\n  );\n\n  private static V = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 80 L 80 0 L 100 0 L 60 100 L 40 100 L 0 0\"\n    />\n  );\n\n  private static W = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 30 70 L 50 30 L 70 70 L 80 0 L 100 0 L 90 100 L 70 100 L 50 65 L 30 100 L 10 100 L 0 0\"\n    />\n  );\n\n  private static X = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 40 L 80 0 L 100 0 L 70 50 L 100 100 L 80 100 L 50 60 L 20 100 L 0 100 L 30 50 L 0 0\"\n    />\n  );\n\n  private static Y = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 20 0 L 50 45 L 80 0 L 100 0 L 60 60 L 60 100 L 40 100 L 40 60 L 0 0\"\n    />\n  );\n\n  private static Z = (props: { [key: string]: string }) => (\n    <path\n      {...props}\n      d=\"M 0 0 L 100 0 L 100 20 L 35 80 L 100 80 L 100 100 L 0 100 L 0 80 L 65 20 L 0 20 L 0 0\"\n    />\n  );\n}\n","/**\n * This file centralizes the location of javascript style definitions\n * for nucleotide and amino acid styles.\n */\nimport styles from \"./MolecularStyles.module.scss\";\n//console.log(\"STYLES AS INPUT ::::: \", styles);\n\n/**\n * Defines a single color scheme interface which consists of\n * a name, className, background alpha, and set of colors for\n * all residues (hex string format).\n *\n * @export\n * @interface IColorScheme\n */\nexport interface IColorScheme {\n  commonName: string;\n  description: string;\n  backgroundAlpha: number;\n  className: string;\n  colors: {\n    [residueCode: string]: string;\n  };\n}\n\nexport const ALL_AMINOACID_COLORSCHEMES = assembleColorSchemes(\"aa\");\nexport const ALL_NUCLEOTIDE_COLORSCHEMES = assembleColorSchemes(\"nt\");\n\n/**\n * Read in class names and colors for amino acid or nucleotide\n * color schemes from the scss file.\n *\n * @param {(\"aa\" | \"nt\")} moleculeType\n * @returns\n */\nfunction assembleColorSchemes(moleculeType: \"aa\" | \"nt\") {\n  return Object.keys(styles).reduce((acc, styleName) => {\n    if (styleName.indexOf(moleculeType + \"StyClass_\") !== -1) {\n      const colorSchemeName = styleName.split(moleculeType + \"StyClass_\")[1];\n      const colorOrder = styles[\n        moleculeType + \"StyColorOrder_\" + colorSchemeName\n      ]\n        .replace(/ /g, \"\")\n        .split(\",\"); // \"build\" removes spaces, but local \"run\" does not\n      const hexValues = styles[moleculeType + \"StyColors_\" + colorSchemeName]\n        .replace(/ /g, \"\")\n        .split(\",\"); // \"build\" removes spaces, but local \"run\" does not\n      const description = styles[moleculeType + \"StyDesc_\" + colorSchemeName];\n      acc.push({\n        commonName: colorSchemeName,\n        description: description,\n        className: styles[styleName],\n        backgroundAlpha: parseFloat(\n          styles[moleculeType + \"StyBGAlpha_\" + colorSchemeName]\n        ),\n        colors: Object.fromEntries(\n          colorOrder.map((_, i) => [colorOrder[i], hexValues[i]])\n        ),\n      });\n    }\n    return acc;\n  }, [] as IColorScheme[]);\n}\n\n/**\n * Top level alignment type descriptions. There are two supported\n * alignment types: AMINOACID and NUCLEOTIDE.\n *\n * @export\n * @class AlignmentTypes\n */\nexport class AlignmentTypes {\n  static readonly AMINOACID = new AlignmentTypes(\n    \"aminoacid-alignment\",\n    \"Amino Acid Sequences\",\n    styles.aaAlignTypeClass,\n    ALL_AMINOACID_COLORSCHEMES\n  );\n  static readonly NUCLEOTIDE = new AlignmentTypes(\n    \"nucleotide-alignment\",\n    \"Nucleotide Sequences\",\n    styles.ntAlignTypeClass,\n    ALL_NUCLEOTIDE_COLORSCHEMES\n  );\n\n  static list = [AlignmentTypes.AMINOACID, AlignmentTypes.NUCLEOTIDE];\n\n  static fromKey(key: string) {\n    return AlignmentTypes.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string,\n    public readonly allColorSchemes: IColorScheme[]\n  ) {}\n}\n\n/**\n * This class represents different position styling modes.\n *\n * @export\n * @class PositionsToStyle\n */\nexport class PositionsToStyle {\n  static readonly ALL = new PositionsToStyle(\n    \"all\",\n    \"All\",\n    styles.styPosAllClass\n  );\n  static readonly QUERY = new PositionsToStyle(\n    \"query\",\n    \"Same as Query\",\n    styles.styPosQueryClass\n  );\n  static readonly QUERY_DIFF = new PositionsToStyle(\n    \"query-diff\",\n    \"Different from Query\",\n    styles.styPosQueryDiffClass\n  );\n  static readonly CONSENSUS = new PositionsToStyle(\n    \"consensus\",\n    \"Same as Consensus\",\n    styles.styPosConsensusClass\n  );\n  static readonly CONSENSUS_DIFF = new PositionsToStyle(\n    \"consensus-diff\",\n    \"Different from Consensus\",\n    styles.styPosConsensusDiffClass\n  );\n\n  static list = [\n    PositionsToStyle.ALL,\n    PositionsToStyle.QUERY,\n    PositionsToStyle.QUERY_DIFF,\n    PositionsToStyle.CONSENSUS,\n    PositionsToStyle.CONSENSUS_DIFF,\n  ];\n\n  static fromKey(key: string) {\n    return PositionsToStyle.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  // private to disallow creating other instances of this type\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string\n  ) {}\n}\n\nexport class ResidueStyle {\n  static readonly LIGHT = new ResidueStyle(\n    \"light\",\n    \"Light\",\n    styles.lightHueClass\n  );\n  static readonly DARK = new ResidueStyle(\"dark\", \"Dark\", styles.darkHueClass);\n  static readonly NO_BACKGROUND = new ResidueStyle(\n    \"lettersonly\",\n    \"Letters Only\",\n    styles.lettersOnlyHueClass\n  );\n\n  static list = [\n    ResidueStyle.DARK,\n    ResidueStyle.LIGHT,\n    ResidueStyle.NO_BACKGROUND,\n  ];\n\n  static fromKey(key: string) {\n    return ResidueStyle.list.find((at) => {\n      return at.key === key;\n    });\n  }\n\n  private constructor(\n    public readonly key: string,\n    public readonly description: string,\n    public readonly className: string\n  ) {}\n}\n\n/**\n * Object to describe the style of a set of sequences (MSA, logo, etc).\n * Contains 2 key parameters:\n *     \"alignmentType\": should be set by implementing classes\n *     \"colorScheme\": describes the color scheme to apply to the alignment.\n *                    defaults to the first available from the scss file\n *     \"positionsToStyle\": description of which positions should be styled.\n *                         defaults to all positions.\n *\n * @interface AlignmentStyle\n */\nexport abstract class AlignmentStyle {\n  abstract readonly alignmentType: AlignmentTypes;\n  abstract colorScheme: IColorScheme;\n  abstract positionsToStyle: PositionsToStyle;\n  abstract residueDetail: ResidueStyle;\n\n  static fromAlignmentType(alignmentType: AlignmentTypes) {\n    if (alignmentType === AlignmentTypes.AMINOACID)\n      return new AminoAcidAlignmentStyle();\n    return new NucleotideAlignmentStyle();\n  }\n}\n\n/**\n * Object to describe an amino acid alignment style\n * @class AminoAcidAlignmentStyle\n * @implements {AlignmentStyle}\n */\nexport class AminoAcidAlignmentStyle implements AlignmentStyle {\n  readonly allColorSchemes = ALL_AMINOACID_COLORSCHEMES;\n  readonly alignmentType = AlignmentTypes.AMINOACID;\n\n  constructor(\n    public colorScheme: IColorScheme = ALL_AMINOACID_COLORSCHEMES[0],\n    public positionsToStyle: PositionsToStyle = PositionsToStyle.ALL,\n    public residueDetail: ResidueStyle = ResidueStyle.LIGHT\n  ) {}\n}\n\n/**\n * Object to describe an nucleotide alignment style\n *\n * @export\n * @class NucleotideAlignmentStyle\n * @implements {AlignmentStyle}\n */\nexport class NucleotideAlignmentStyle implements AlignmentStyle {\n  readonly allColorSchemes = ALL_NUCLEOTIDE_COLORSCHEMES;\n  readonly alignmentType = AlignmentTypes.NUCLEOTIDE;\n\n  constructor(\n    public colorScheme: IColorScheme = ALL_NUCLEOTIDE_COLORSCHEMES[0],\n    public positionsToStyle: PositionsToStyle = PositionsToStyle.ALL,\n    public residueDetail: ResidueStyle = ResidueStyle.LIGHT\n  ) {}\n}\n\n/**\n * Export globals\n */\nconst darkHueClass = styles.darkHueClass;\nconst lightHueClass = styles.lightHueClass;\nconst aceResidueParentClass = styles.aceResidueParentClass;\nexport {\n  lightHueClass,\n  darkHueClass,\n  aceResidueParentClass, // place above any residue (e.g., ace_A) to get default coloring\n};\n\n/**\n * Export ace helper parameters and functions.\n */\n\n/**\n * fast lookup of the query, consensus classes\n * @param isForAceItself If it is for ace, do not include the ace_ prefix\n *                       as this is added automatically by ace itself.\n */\nfunction generateFastClassLookup(isForAceItself?: boolean) {\n  let ALL_POSSIBLE_CHARS = \"\";\n  for (var i = 32; i <= 126; i++) {\n    ALL_POSSIBLE_CHARS += String.fromCharCode(i);\n  }\n\n  return ALL_POSSIBLE_CHARS.split(\"\") //\".-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    .reduce((acc, letter) => {\n      const letterInClass = letter === \".\" ? \"dot\" : letter;\n      const prefix = isForAceItself\n        ? letterInClass\n        : styles.acePrefix + letterInClass;\n      acc.set(\n        letter,\n        new Map([\n          [\n            true,\n            new Map([\n              [\n                true,\n                prefix +\n                  \" \" +\n                  styles.preAceConsensusClass +\n                  \" \" +\n                  styles.preAceQueryClass,\n              ], //is consensus and query\n              [false, prefix + \" \" + styles.preAceConsensusClass], //is consensus, not query\n            ]),\n          ],\n          [\n            false,\n            new Map([\n              [true, prefix + \" \" + styles.preAceQueryClass], //is query, not consensus\n              [false, prefix], //not query and not consensus\n            ]),\n          ],\n        ])\n      );\n      return acc;\n    }, new Map<string, Map<boolean, Map<boolean, string>>>());\n}\n\nconst LETTER_CLASS_NAMES = generateFastClassLookup(false);\nconst LETTER_CLASS_NAMES_FOR_ACE = generateFastClassLookup(true);\n\n/**\n * Export a class name array that is used by the ace editor\n * mode to fill class names for each letter. The structure\n * of this string is just the list of class names, separated\n * by a period. Ace subsequently prepends ace_ to each value\n * when adding the classes to the editor.\n *\n * Update: I only use a single class name separated by a space.\n *         I think this helps with performance:(1) ace no\n *         longer needs to split the returned value by periods\n *         and apply any multi-class logic, and (2) the dom has\n *         shorter classnames. I did rough tests and this seems\n *         to help with performance, but admittedly they were not\n *         rigerous or scientific and it doesn't seem to make a\n *         large impact.\n *\n * @param letter\n * @param isConsensus\n * @param isQuery\n * @param forAceItself if set to true, the first returned class will\n *                     not have ace_ prepended as the ace editor will\n *                     do the prepending on its own.\n */\nexport function getLetterClassNames(\n  letter: string,\n  isConsensus: boolean,\n  isQuery: boolean,\n  forAceItself?: boolean\n) {\n  return forAceItself\n    ? LETTER_CLASS_NAMES_FOR_ACE.get(letter)!.get(isConsensus)!.get(isQuery)!\n    : LETTER_CLASS_NAMES.get(letter)!.get(isConsensus)!.get(isQuery)!;\n}\n","import { GlyphFactory } from \"./SequenceLogoGlyphs\";\nimport { stringToColor } from \"./Utils\";\nimport {\n  ALL_AMINOACID_COLORSCHEMES,\n  ALL_NUCLEOTIDE_COLORSCHEMES,\n} from \"./MolecularStyles\";\n\ninterface IResidueColor {\n  [colorScheme: string]: {\n    hexString: string;\n    rgb: {\n      red: number;\n      green: number;\n      blue: number;\n    };\n    backgroundAlpha: number;\n  };\n}\n\ninterface IAminoAcid {\n  singleLetterCode: string;\n  threeLetterCode: string;\n  fullName: string;\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n}\n\ninterface INucleotide {\n  singleLetterCode: string;\n  fullName: string;\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n}\n\nexport class AminoAcid implements IAminoAcid {\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n\n  public static readonly canonicalAminoAcids: AminoAcid[] = [\n    new AminoAcid(\"A\", \"ALA\", \"Alanine\"),\n    new AminoAcid(\"R\", \"ARG\", \"Arginine\"),\n    new AminoAcid(\"N\", \"ASN\", \"Asparagine\"),\n    new AminoAcid(\"D\", \"ASP\", \"Aspartic Acid\"),\n    new AminoAcid(\"C\", \"CYS\", \"Cysteine\"),\n    new AminoAcid(\"Q\", \"GLU\", \"Glutamine\"),\n    new AminoAcid(\"E\", \"GLN\", \"Glutamic Acid\"),\n    new AminoAcid(\"G\", \"GLY\", \"Glycine\"),\n    new AminoAcid(\"H\", \"HIS\", \"Histidine\"),\n    new AminoAcid(\"I\", \"ILE\", \"Isoleucine\"),\n    new AminoAcid(\"L\", \"LEU\", \"Leucine\"),\n    new AminoAcid(\"K\", \"LYS\", \"Lysine\"),\n    new AminoAcid(\"M\", \"MET\", \"Methionine\"),\n    new AminoAcid(\"F\", \"PHE\", \"Phenylalanine\"),\n    new AminoAcid(\"P\", \"PRO\", \"Proline\"),\n    new AminoAcid(\"S\", \"SER\", \"Serine\"),\n    new AminoAcid(\"T\", \"THR\", \"Threonine\"),\n    new AminoAcid(\"W\", \"TRP\", \"Tryptophan\"),\n    new AminoAcid(\"Y\", \"TYR\", \"Tyrosine\"),\n    new AminoAcid(\"V\", \"VAL\", \"Valine\"),\n\n    new AminoAcid(\"X\", \"UKN\", \"Unknown\"),\n  ];\n\n  private static bySingleLetterCode = AminoAcid.canonicalAminoAcids.reduce(\n    (acc, aa) => {\n      acc[aa.singleLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: AminoAcid }\n  );\n\n  private static byThreeLetterCode = AminoAcid.canonicalAminoAcids.reduce(\n    (acc, aa) => {\n      acc[aa.threeLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: AminoAcid }\n  );\n\n  public static readonly UNKNOWN = AminoAcid.bySingleLetterCode[\"X\"];\n\n  static fromSingleLetterCode(singleLetterCode: string): IAminoAcid {\n    if (singleLetterCode in this.bySingleLetterCode) {\n      return AminoAcid.bySingleLetterCode[singleLetterCode];\n    }\n    return AminoAcid.UNKNOWN;\n  }\n\n  static fromThreeLetterCode(threeLetterCode: string): IAminoAcid {\n    if (threeLetterCode in this.byThreeLetterCode) {\n      return AminoAcid.byThreeLetterCode[threeLetterCode];\n    }\n    return AminoAcid.UNKNOWN;\n  }\n\n  constructor(\n    public singleLetterCode: string,\n    public threeLetterCode: string,\n    public fullName: string\n  ) {\n    this.singleLetterCode = singleLetterCode;\n    this.threeLetterCode = threeLetterCode;\n    this.fullName = fullName;\n    this.glyph = GlyphFactory.glyphFromChar(singleLetterCode);\n    this.colors = ALL_AMINOACID_COLORSCHEMES.reduce((acc, cs) => {\n      const colorPair = Object.entries(cs.colors).find(([aa, color]) => {\n        if (aa === singleLetterCode) {\n          return true;\n        }\n        return false;\n      });\n\n      let colorString = \"#ffffff\";\n      if (colorPair) {\n        colorString = colorPair[1];\n      }\n      const colorInfo = stringToColor(colorString);\n      acc[cs.commonName] = {\n        hexString: colorInfo.hex,\n        rgb: colorInfo.rgb,\n        backgroundAlpha: cs.backgroundAlpha,\n      };\n      return acc;\n    }, {} as IResidueColor);\n  }\n}\n\nexport class Nucleotide implements INucleotide {\n  glyph: (props: { [key: string]: string }) => JSX.Element;\n  colors: IResidueColor;\n\n  static allNucleotides: Nucleotide[] = [\n    new Nucleotide(\"A\", \"Adenine\"),\n    new Nucleotide(\"C\", \"Cytosine\"),\n    new Nucleotide(\"G\", \"Guanine\"),\n    new Nucleotide(\"T\", \"Thymidine\"),\n    new Nucleotide(\"U\", \"Uracil\"),\n\n    new Nucleotide(\"R\", \"Purine\"),\n    new Nucleotide(\"Y\", \"Pyrimidine\"),\n\n    new Nucleotide(\"X\", \"Unknown\"),\n  ];\n\n  private static bySingleLetterCode = Nucleotide.allNucleotides.reduce(\n    (acc, aa) => {\n      acc[aa.singleLetterCode] = aa;\n      return acc;\n    },\n    {} as { [key: string]: Nucleotide }\n  );\n\n  public static UNKNOWN = Nucleotide.bySingleLetterCode[\"X\"];\n\n  static fromSingleLetterCode(singleLetterCode: string): Nucleotide {\n    singleLetterCode = singleLetterCode.toUpperCase();\n    if (this.bySingleLetterCode[singleLetterCode]) {\n      return Nucleotide.bySingleLetterCode[singleLetterCode];\n    }\n    return Nucleotide.UNKNOWN;\n  }\n\n  constructor(public singleLetterCode: string, public fullName: string) {\n    this.singleLetterCode = singleLetterCode;\n    this.fullName = fullName;\n    this.glyph = GlyphFactory.glyphFromChar(singleLetterCode);\n    this.colors = ALL_NUCLEOTIDE_COLORSCHEMES.reduce((acc, cs) => {\n      const colorPair = Object.entries(cs.colors).find(([aa, color]) => {\n        if (aa === singleLetterCode) {\n          return true;\n        }\n        return false;\n      });\n\n      let colorString = \"#ffffff\";\n      if (colorPair) {\n        colorString = colorPair[1];\n      }\n      const colorInfo = stringToColor(colorString);\n      acc[cs.commonName] = {\n        hexString: colorInfo.hex,\n        rgb: colorInfo.rgb,\n        backgroundAlpha: cs.backgroundAlpha,\n      };\n      return acc;\n    }, {} as IResidueColor);\n  }\n}\n","/**\n * Sequence logo component.\n * Inspired / derived from https://github.com/weng-lab/logojs-package\n *  (but simpler)\n */\n\nimport React from \"react\";\nimport \"./SequenceLogo.scss\";\nimport { Alignment } from \"../common/Alignment\";\nimport { GlyphFactory } from \"../common/SequenceLogoGlyphs\";\nimport {\n  aceResidueParentClass,\n  getLetterClassNames,\n  AlignmentTypes,\n} from \"../common/MolecularStyles\";\nimport ReactTooltip from \"react-tooltip\";\nimport { AminoAcid, Nucleotide } from \"../common/Residues\";\n\nexport enum LOGO_TYPES {\n  LETTERS = \"Letter Stack\",\n  BARS = \"Bar Plot\",\n}\n\ninterface ILetterWithClasses {\n  letter: string;\n  classNames: string;\n}\ninterface IGlyphFrequency {\n  count: number;\n  frequency: number;\n  letter: ILetterWithClasses;\n  residue: AminoAcid | Nucleotide;\n}\ninterface IGlyphStackData extends Array<IGlyphFrequency> {}\n\nexport interface ISequenceLogoProps {\n  //don't expose these props in the AlignmentViewer full component\n  alignment: Alignment;\n  glyphWidth: number;\n  alignmentType?: AlignmentTypes; //AlignmentViewer component does expose this through the style object\n\n  //props that should be exposed in AlignmentViewer full component:\n  logoType?: LOGO_TYPES;\n  tooltipPlacement?: \"top\" | \"right\" | \"bottom\" | \"left\"; //default to undefined => automatic\n  height?: string;\n}\n\ninterface ISequenceLogoState {\n  logoData?: IGlyphStackData;\n}\n\nexport class SequenceLogoComponent extends React.Component<\n  ISequenceLogoProps,\n  ISequenceLogoState\n> {\n  private logoData?: IGlyphStackData[];\n\n  static defaultProps = {\n    logoType: LOGO_TYPES.LETTERS,\n    height: \"100px\",\n  };\n\n  /*\n   *\n   *\n   * PRIVATE METHODS\n   *\n   *\n   */\n\n  private renderTooltip() {\n    const { tooltipPlacement } = this.props;\n\n    return (\n      <ReactTooltip\n        id=\"getLogoTooltip\"\n        effect=\"solid\"\n        type=\"light\"\n        place={tooltipPlacement} //isn't always respected?\n        border={true}\n        getContent={(pos: string) => {\n          if (!pos || !this.logoData || !this.logoData[parseInt(pos)]) {\n            return;\n          }\n\n          const position = parseInt(pos) + 1;\n          const glyphData = this.logoData[parseInt(pos)];\n          return glyphData.length === 0 ? null : (\n            <div className=\"logo-tooltip\">\n              <h1>Position: {position}</h1>\n              <div className=\"row\">\n                <div className=\"col legend-square\"></div>\n                <div className=\"col header name\">Residue</div>\n                <div className=\"col header frequency\">Frequency</div>\n                <div className=\"col header count\">Count</div>\n              </div>\n              {glyphData\n                .slice()\n                .reverse()\n                .map((letterFreq, myidx) => {\n                  return (\n                    <div key={myidx} className=\"row\">\n                      <div\n                        className={`col legend-square ${letterFreq.letter.classNames}`}\n                      ></div>\n                      <div className=\"col name\">\n                        {`${letterFreq.residue.fullName} [${letterFreq.letter.letter}]`}\n                      </div>\n                      <div className=\"col frequency\">\n                        {+(letterFreq.frequency * 100).toFixed(2)}%\n                      </div>\n                      <div className=\"col count\">{letterFreq.count}</div>\n                    </div>\n                  );\n                })}\n            </div>\n          );\n        }}\n      />\n    );\n  }\n\n  /**\n   * Generate the svg elements for a single position, i.e., column\n   */\n  private renderSinglePositionStack(\n    positionalFrequencies: IGlyphStackData,\n    numGlyphStacks: number\n  ) {\n    const { logoType } = this.props;\n    let dy = 100;\n\n    return positionalFrequencies.map((freq, idx) => {\n      dy = dy - freq.frequency * 100;\n\n      if (logoType === LOGO_TYPES.BARS) {\n        const xscale = 2 / numGlyphStacks; // not exact, but works.\n        return (\n          <rect\n            width=\"100\"\n            height=\"100\"\n            transform={`translate(0, ${dy}) scale(${xscale},${freq.frequency})`}\n            className={freq.letter.classNames}\n            key={`idxrect_${idx}`}\n          ></rect>\n        );\n      }\n\n      const xscale = 0.009; // invariant scaling\n      const selectedGlyph = GlyphFactory.glyphFromChar(freq.letter.letter)({\n        className: freq.letter.classNames,\n        transform: `translate(0, ${dy}) scale(${xscale},${freq.frequency})`,\n        key: `idxglyph_${idx}`,\n      });\n      return selectedGlyph;\n    });\n  }\n\n  /**\n   * Munge letter count data that was calculated during alignment creation\n   * into a form appropriate for the glyph generation\n   */\n  private mungeLogoData(): IGlyphStackData[] {\n    const { alignment } = this.props;\n\n    const numberSequences = alignment.getSequences().length;\n    const lettersSorted = alignment.getAllUpperAlphaLettersInAlignmentSorted();\n\n    const alignmentType = this.props.alignmentType\n      ? this.props.alignmentType\n      : this.props.alignment.getPredictedType();\n    const moleculeClass =\n      alignmentType === AlignmentTypes.AMINOACID ? AminoAcid : Nucleotide;\n\n    //load class names for each letter\n    const letterObjects = lettersSorted.reduce((arr, letter) => {\n      arr[letter] = {\n        letter: letter,\n        classNames: getLetterClassNames(letter, false, false, false),\n      };\n      return arr;\n    }, {} as { [letter: string]: ILetterWithClasses });\n\n    //note: removes invalid letters, but letterCount (value) isn't sorted\n    const plc = alignment.getPositionalLetterCounts(false, lettersSorted);\n    return Array.from(plc).map(\n      ([pos, letterCounts]): IGlyphStackData => {\n        return Object.entries(letterCounts)\n          .map(([letter, count]) => {\n            return {\n              count: count,\n              frequency: count / numberSequences,\n              letter: letterObjects[letter],\n              residue: moleculeClass.fromSingleLetterCode(letter),\n            };\n          })\n          .filter((freq) => {\n            // remove empty letters\n            return freq.frequency !== 0;\n          })\n          .sort((a, b) => (a.frequency > b.frequency ? 1 : -1));\n      }\n    );\n  }\n\n  /*\n   *\n   *\n   * REACT METHODS\n   *\n   *\n   */\n  shouldComponentUpdate(nextProps: ISequenceLogoProps) {\n    const { alignment, alignmentType, logoType, glyphWidth } = this.props;\n    if (\n      !this.logoData ||\n      logoType !== nextProps.logoType ||\n      glyphWidth !== nextProps.glyphWidth ||\n      alignment !== nextProps.alignment ||\n      alignmentType !== nextProps.alignmentType\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  componentDidUpdate() {\n    ReactTooltip.rebuild();\n  }\n\n  render() {\n    const { alignment, glyphWidth, height } = this.props;\n    if (!alignment || !glyphWidth) {\n      return null;\n    }\n\n    //perform a bunch of data munging\n    this.logoData = this.mungeLogoData();\n    const totalWidth = this.logoData.length * glyphWidth;\n\n    return (\n      <div className=\"sequence-logo\">\n        <svg\n          preserveAspectRatio=\"none\"\n          viewBox={`0 0 ${this.logoData.length} 100`}\n          style={{\n            width: totalWidth,\n            height: height ? height : SequenceLogoComponent.defaultProps.height,\n          }}\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          {this.logoData.map((singlePositionData, positionIdx) => {\n            return (\n              <g\n                transform={`translate(${positionIdx},0)`}\n                className={aceResidueParentClass} //required for default coloring\n                key={\"p_\" + positionIdx}\n              >\n                {this.renderSinglePositionStack(\n                  singlePositionData,\n                  this.logoData!.length\n                )}\n                <rect\n                  className=\"interaction-placeholder\"\n                  width=\"1\"\n                  height=\"100\"\n                  data-for=\"getLogoTooltip\"\n                  data-tip={positionIdx}\n                  data-class={\"sequence-logo-tooltip-container\"}\n                ></rect>\n              </g>\n            );\n          })}\n        </svg>\n        {this.renderTooltip()}\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport \"./SequenceBarplot.scss\";\nimport _ from \"lodash\";\nimport { Alignment } from \"../common/Alignment\";\nimport { mapGroupBy, ArrayOneOrMore, generateUUIDv4 } from \"../common/Utils\";\nimport ReactTooltip from \"react-tooltip\";\n\nexport interface ISequenceBarplotDataSeries {\n  id: string; //must be unique for each series\n  name: string;\n  cssClass: string;\n  color?: string;\n  plotOptions?: {\n    fixYMax?(alignment: Alignment): number; //defaults to data max\n    //fixYMin?: number; //defaults to data min\n  };\n  getBars(alignment: Alignment): ISingleBarDetails[];\n}\n\nexport interface ISequenceBarplotProps {\n  //don't expose these props in the AlignmentViewer full component\n  alignment: Alignment;\n  positionWidth: number;\n\n  //props that should be exposed in AlignmentViewer full component:\n  dataSeriesSet: ArrayOneOrMore<ISequenceBarplotDataSeries>;\n  tooltipPlacement?: \"top\" | \"right\" | \"bottom\" | \"left\"; //default to undefined => automatic\n  height?: string;\n\n  //expose these, but requires smarter forwarding within the AlignmentViewer full component\n  onPositionSelectionChanged?(\n    positionsSelected: {\n      position: number;\n      element: SVGRectElement;\n      bars: ISingleBarDetailsFull[];\n    }[]\n  ): void;\n  onPositionMouseEnter?(\n    position: number,\n    element: SVGRectElement,\n    bars: ISingleBarDetailsFull[]\n  ): void;\n  onPositionMouseLeave?(\n    position: number,\n    element: SVGRectElement,\n    bars: ISingleBarDetailsFull[]\n  ): void;\n}\n\ninterface ISingleBarDetails {\n  height: number | undefined;\n  tooltipValueText?: string;\n}\ninterface ISingleBarDetailsFull extends ISingleBarDetails {\n  normalizedHeight: number | undefined;\n  position: number;\n  dataSeriesSet: ISequenceBarplotDataSeries;\n}\ninterface ISequenceBarplotState {\n  positionHovered?: {\n    position: number;\n    element: SVGRectElement;\n    bars: ISingleBarDetailsFull[];\n  };\n  positionsSelected: {\n    position: number;\n    element: SVGRectElement;\n    bars: ISingleBarDetailsFull[];\n  }[];\n  svgHovered: boolean;\n  hoverKey: string;\n}\n\nexport class SequenceBarplotComponent extends React.Component<\n  ISequenceBarplotProps,\n  ISequenceBarplotState\n> {\n  private static POSITION_VIEWBOX_HEIGHT = 100;\n  private static POSITION_VIEWBOX_WIDTH = 1;\n\n  private cache: Partial<ISequenceBarplotProps> & {\n    bars?: ISingleBarDetailsFull[];\n    barsGroupedByPosition?: Map<number, ISingleBarDetailsFull[]>;\n    barsGroupedByDataseries?: Map<\n      ISequenceBarplotDataSeries,\n      ISingleBarDetailsFull[]\n    >;\n  } = {};\n\n  static defaultProps = {\n    height: \"100px\",\n  };\n\n  constructor(props: ISequenceBarplotProps) {\n    super(props);\n    this.state = {\n      svgHovered: false,\n      positionsSelected: [],\n      hoverKey: generateUUIDv4(),\n    };\n    this.handleSvgHover = this.handleSvgHover.bind(this);\n    this.handlePositionHover = this.handlePositionHover.bind(this);\n    this.handlePositionClicked = this.handlePositionClicked.bind(this);\n  }\n\n  /*\n   *\n   *\n   * PRE-CONFIGURED BARPLOTS\n   *\n   *\n   */\n  /**\n   * Plot the shannon entropy at each position -sum(p * log p)\n   *   - p is the fraction of each upper case letter at the position\n   *   - ymax is set to the maximum entropy, which is an equal number\n   *     of all upper case letters in the alignment.\n   */\n  public static SHANNON_ENTROPY_BARPLOT: ISequenceBarplotDataSeries = {\n    id: \"entropy\",\n    name: \"Entropy\",\n    cssClass: \"barplot-shannon-entropy\",\n    color: \"#000000\",\n    plotOptions: {\n      fixYMax: (al) => {\n        const allLettersInAlignment = al.getAllUpperAlphaLettersInAlignmentSorted();\n        const p = 1 / allLettersInAlignment.length;\n        return (\n          -1 *\n          allLettersInAlignment.reduce((acc) => {\n            return acc + p * Math.log2(p);\n          }, 0)\n        );\n      },\n    },\n    getBars: (al) => {\n      const toReturn: ISingleBarDetails[] = [];\n      const plc = al.getPositionalLetterCounts(\n        true,\n        al.getAllUpperAlphaLettersInAlignmentSorted()\n      );\n\n      const maxSeqLength = al.getMaxSequenceLength();\n      for (let i = 0; i < maxSeqLength; i++) {\n        const singlePlc = plc.get(i);\n        if (!singlePlc || Object.keys(singlePlc).length === 0) {\n          toReturn.push({ height: undefined });\n        } else {\n          toReturn.push({\n            height:\n              -1 *\n              Object.values(singlePlc).reduce((acc, p) => {\n                return acc + p * Math.log2(p);\n              }, 0),\n          });\n        }\n      }\n      return toReturn;\n    },\n  };\n\n  /**\n   * Plot evcouplings style conservation defined as 1 - the shannon entropy\n   */\n  public static CONSERVATION_BARPLOT: ISequenceBarplotDataSeries = {\n    id: \"conservation\",\n    name: \"Conservation\",\n    cssClass: \"barplot-conservation\",\n    color: \"#414141\",\n    plotOptions: {\n      fixYMax: (al) => {\n        return SequenceBarplotComponent.SHANNON_ENTROPY_BARPLOT.plotOptions!\n          .fixYMax!(al);\n      },\n    },\n    getBars: (al) => {\n      const ymax = SequenceBarplotComponent.SHANNON_ENTROPY_BARPLOT.plotOptions!\n        .fixYMax!(al);\n      const entropyBars = SequenceBarplotComponent.SHANNON_ENTROPY_BARPLOT.getBars(\n        al\n      );\n      return entropyBars.map((entropyBar) => {\n        return {\n          ...entropyBar,\n          height:\n            entropyBar.height === undefined\n              ? undefined\n              : ymax - entropyBar.height,\n        };\n      });\n    },\n  };\n\n  /**\n   * Plot the Kullback-Leibler (KL) divergence for individual columns in the alignment\n   *        S = sum(pk * log(pk / qk)\n   *   also see scipy docs:\n   *     https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.entropy.html\n   *\n   * No maximum is explicitly set (so it because the max value)\n   */\n  public static KULLBAC_LEIBLER_DIVERGENCE_BARPLOT: ISequenceBarplotDataSeries = {\n    id: \"kullback-leibler-divergence\",\n    name: \"KL Divergence\",\n    cssClass: \"barplot-kullback-leibler-divergence\",\n    color: \"darkred\",\n    getBars: (al) => {\n      const allLetters = al.getAllUpperAlphaLettersInAlignmentSorted();\n      const pk = al.getPositionalLetterCounts(true, allLetters);\n      const qk = al.getGlobalAlphaLetterCounts(true, allLetters);\n\n      const toReturn: ISingleBarDetails[] = [];\n      const maxSeqLength = al.getMaxSequenceLength();\n      for (let i = 0; i < maxSeqLength; i++) {\n        const positionsPk = pk.get(i);\n        if (!positionsPk || Object.keys(positionsPk).length === 0) {\n          toReturn.push({ height: undefined });\n        } else {\n          toReturn.push({\n            height: allLetters.reduce((acc, letter) => {\n              if (letter in positionsPk) {\n                acc +=\n                  positionsPk[letter] *\n                  Math.log(positionsPk[letter] / qk[letter]);\n              }\n              return acc;\n            }, 0),\n          });\n        }\n      }\n      return toReturn;\n    },\n  };\n\n  /**\n   * Plot the number of gaps at each position. The y max is set to\n   * the total length of the alignment and not the largest number of\n   * gaps.\n   */\n  public static GAPS_BARPLOT: ISequenceBarplotDataSeries = {\n    id: \"gaps\",\n    name: \"Gaps\",\n    cssClass: \"barplot-gaps\",\n    color: \"#b7b7b7\",\n    plotOptions: {\n      fixYMax: (alignment) => alignment.getSequences().length,\n    },\n    getBars: (al) => {\n      const toReturn: ISingleBarDetails[] = [];\n      const maxSeqLength = al.getMaxSequenceLength();\n      for (let i = 0; i < maxSeqLength; i++) {\n        const gapCount = al.getGapCountAtColumn(i);\n        toReturn.push({\n          height: gapCount,\n          tooltipValueText: `${(\n            (gapCount / al.getSequences().length) *\n            100\n          ).toFixed(1)}% (${gapCount})`,\n        });\n      }\n      return toReturn;\n    },\n  };\n\n  /**\n   *\n   *\n   * HELPER FUNCTIONS\n   *\n   *\n   */\n  private handleSvgHover(isHovered: boolean) {\n    this.setState({\n      svgHovered: isHovered,\n    });\n  }\n\n  private handlePositionHover(\n    event: React.MouseEvent<SVGElement, MouseEvent>,\n    position: number,\n    isHovered: boolean\n  ) {\n    const { onPositionMouseEnter, onPositionMouseLeave } = this.props;\n    if (isHovered && onPositionMouseEnter) {\n      //notify parent listeners\n      onPositionMouseEnter(\n        position,\n        event.relatedTarget as SVGRectElement,\n        this.getBars().barsGroupedByPosition.get(position)!\n      );\n    } else if (!isHovered && onPositionMouseLeave) {\n      onPositionMouseLeave(\n        position,\n        event.relatedTarget as SVGRectElement,\n        this.getBars().barsGroupedByPosition.get(position)!\n      );\n    }\n    this.setState({\n      positionHovered: isHovered\n        ? {\n            position: position,\n            element: event.relatedTarget as SVGRectElement,\n            bars: this.getBars().barsGroupedByPosition.get(position)!,\n          }\n        : undefined,\n    });\n  }\n\n  private handlePositionClicked(\n    event: React.MouseEvent<SVGElement, MouseEvent>,\n    position: number\n  ) {\n    const { positionsSelected } = this.state;\n    const { onPositionSelectionChanged } = this.props;\n    const newPositionsSelected = positionsSelected.some(\n      (p) => p.position === position\n    )\n      ? positionsSelected.filter((p) => p.position !== position)\n      : [\n          ...positionsSelected,\n          {\n            position: position,\n            element: event.relatedTarget as SVGRectElement,\n            bars: this.getBars().barsGroupedByPosition.get(position)!,\n          },\n        ];\n    if (onPositionSelectionChanged) {\n      onPositionSelectionChanged(newPositionsSelected);\n    }\n    this.setState({\n      positionsSelected: newPositionsSelected,\n    });\n  }\n\n  /**\n   * Normalize bars to fall between 0 and POSITION_MAX_HEIGHT in svg space. Obey the\n   * fixYMax if specified\n   * @param bars the same bars as input, with the \"normalizeHeight\"\n   *             attribute added\n   */\n  private normalizeBarHeights(\n    bars: ISingleBarDetailsFull[]\n  ): ISingleBarDetailsFull[] {\n    const { alignment } = this.props;\n    const allValidHeights = bars.reduce((acc, bar) => {\n      if (bar.height !== undefined) {\n        acc.push(bar.height);\n      }\n      return acc;\n    }, [] as number[]);\n    const overallMinHeight = Math.min(...allValidHeights);\n    const overallMaxHeight = Math.max(...allValidHeights);\n    return bars.map((bar) => {\n      const minHeight = overallMinHeight;\n      const maxHeight =\n        bar.dataSeriesSet.plotOptions && bar.dataSeriesSet.plotOptions.fixYMax\n          ? bar.dataSeriesSet.plotOptions.fixYMax(alignment)\n          : overallMaxHeight;\n      return {\n        ...bar,\n        normalizedHeight:\n          bar.height === undefined\n            ? undefined\n            : ((bar.height - minHeight) / (maxHeight - minHeight)) *\n              SequenceBarplotComponent.POSITION_VIEWBOX_HEIGHT,\n      };\n    });\n  }\n\n  /**\n   * Get bars and bar groups.\n   * Calls prop.getPositionalInfo to calculate heights for each\n   * position. Uses cache to avoid too many updates.\n   */\n  private getBars() {\n    const { alignment, dataSeriesSet } = this.props;\n\n    const dataSeriesSetChanged =\n      !this.cache.dataSeriesSet ||\n      this.cache.dataSeriesSet.find((ds, idx) => {\n        return ds !== dataSeriesSet[idx];\n      });\n\n    if (\n      !this.cache.bars ||\n      alignment !== this.cache.alignment ||\n      dataSeriesSetChanged\n    ) {\n      this.cache.alignment = alignment;\n      this.cache.dataSeriesSet = dataSeriesSet;\n\n      let allBars: ISingleBarDetailsFull[] = [];\n      dataSeriesSet.forEach((ds) => {\n        allBars = allBars.concat(\n          ds.getBars(alignment).map((bar, idx) => {\n            return {\n              ...bar,\n              position: idx,\n              dataSeriesSet: ds,\n              normalizedHeight: -1, // define below\n            };\n          })\n        );\n      });\n\n      //normalize bars group by group\n      this.cache.bars = Object.entries(\n        _.groupBy(allBars, (bar) => bar.dataSeriesSet.id)\n      )\n        .map(([categoryId, categoryBars]) => {\n          return this.normalizeBarHeights(categoryBars);\n        })\n        .flat();\n\n      this.cache.barsGroupedByPosition = mapGroupBy(\n        this.cache.bars,\n        (bar) => bar.position\n      );\n\n      this.cache.barsGroupedByDataseries = mapGroupBy(\n        this.cache.bars,\n        (item) => item.dataSeriesSet\n      );\n    }\n    return {\n      bars: this.cache.bars!,\n      barsGroupedByPosition: this.cache.barsGroupedByPosition!,\n      barsGroupedByDataseries: this.cache.barsGroupedByDataseries!,\n    };\n  }\n\n  /**\n   *\n   *\n   * JSX RENDER FUNCTIONS\n   *\n   *\n   */\n\n  /**\n   * Render the tooltip for a particular position.\n   */\n  private renderTooltip() {\n    const barsObj = this.getBars();\n    const { tooltipPlacement } = this.props;\n    const { hoverKey } = this.state;\n\n    return (\n      <ReactTooltip\n        id={`getBarTooltip-${hoverKey}`}\n        effect=\"solid\"\n        type=\"light\"\n        border={true}\n        place={tooltipPlacement}\n        getContent={(pos: string) => {\n          const posInt = parseInt(pos);\n          const posPlusOne = posInt + 1; // positions should be 1 based, not zero based\n          const barsAtPostion = barsObj.barsGroupedByPosition.get(posInt)!;\n          const numValidBars = !barsAtPostion\n            ? 0\n            : barsAtPostion.reduce((acc, bar) => {\n                return acc + (bar.height !== undefined ? 1 : 0);\n              }, 0 as number);\n\n          return numValidBars < 1 ? undefined : (\n            <div className=\"bar-position-textblock\">\n              <h1>Position: {posPlusOne}</h1>\n              {barsAtPostion.map((bar) => {\n                return (\n                  <div\n                    className={`dataseries-line ${bar.dataSeriesSet.cssClass}`}\n                    key={bar.dataSeriesSet.id}\n                  >\n                    <span\n                      className=\"legend-square\"\n                      style={{\n                        backgroundColor: bar.dataSeriesSet.color\n                          ? bar.dataSeriesSet.color\n                          : undefined,\n                      }}\n                    ></span>\n                    <span className=\"legend-text\">\n                      {bar.dataSeriesSet.name}:{\" \"}\n                      {bar.tooltipValueText\n                        ? bar.tooltipValueText\n                        : bar.height !== undefined\n                        ? +bar.height.toFixed(1)\n                        : \"undefined\"}\n                    </span>\n                  </div>\n                );\n              })}\n            </div>\n          );\n        }}\n      />\n    );\n  }\n\n  /**\n   * Render the bar plot svg, with each bar appearing as a single rectangle.\n   * Final form:\n   *    <svg ...>\n   *      <g position 1>\n   *         <rect transparant rectangle for interaction for position 1>\n   *         <rect for dataseries 1 position 1>\n   *         <rect for dataseries 2 position 1>\n   *      </g>\n   *      <g position 2>\n   *         <rect transparant rectangle for interaction for position 2>\n   *         <rect for dataseries 1 position 2>\n   *         <rect for dataseries 2 position 2>\n   *      </g>\n   *   </svg>\n   */\n  private renderBarPlot() {\n    const { alignment, positionWidth, height } = this.props;\n    const { hoverKey } = this.state;\n\n    const maxSeqLength = alignment.getMaxSequenceLength();\n    const totalWidth = positionWidth * maxSeqLength;\n\n    const barsObj = this.getBars();\n\n    return (\n      <svg\n        preserveAspectRatio=\"none\"\n        viewBox={`0 0 ${\n          maxSeqLength * SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH\n        } ${SequenceBarplotComponent.POSITION_VIEWBOX_HEIGHT}`}\n        style={{\n          width: totalWidth,\n          height: height\n            ? height\n            : SequenceBarplotComponent.defaultProps.height,\n        }}\n        xmlns=\"http://www.w3.org/2000/svg\"\n        onMouseEnter={() => this.handleSvgHover(true)}\n        onMouseLeave={() => this.handleSvgHover(false)}\n      >\n        {Array.from(barsObj.barsGroupedByPosition.entries()).map(\n          ([pos, bars]) => {\n            const allBarsHeightsAtPosition = bars.reduce((acc, bar) => {\n              if (bar.normalizedHeight !== undefined) {\n                acc.push(bar.normalizedHeight);\n              }\n              return acc;\n            }, [] as number[]);\n            const maxBarHeight =\n              allBarsHeightsAtPosition.length < 1\n                ? 0\n                : Math.max(...allBarsHeightsAtPosition);\n\n            const numDataSeries = barsObj.barsGroupedByDataseries.size;\n            const barWidth =\n              (numDataSeries === 1 ? 0.9 : 1 / numDataSeries) *\n              SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH;\n            const firstBarOffset =\n              (numDataSeries === 1 ? pos + 0.05 : pos) *\n              SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH;\n\n            return allBarsHeightsAtPosition.length < 1 ? null : (\n              <g\n                transform={`translate(${firstBarOffset},0)`}\n                className={\n                  this.state.positionsSelected.some((p) => p.position === pos)\n                    ? \"position-container selected\"\n                    : \"position-container pos\" + pos\n                }\n                onClick={(event) => {\n                  this.handlePositionClicked(event, pos);\n                }}\n                onMouseEnter={(event) => {\n                  this.handlePositionHover(event, pos, true);\n                }}\n                onMouseLeave={(event) => {\n                  this.handlePositionHover(event, pos, false);\n                }}\n                data-for={`getBarTooltip-${hoverKey}`}\n                data-tip={pos}\n                data-class={\"barplot-tooltip-container\"}\n                key={`pos_${pos}`}\n              >\n                {bars.reduce((acc, bar, dataseriesIdx) => {\n                  if (bar.normalizedHeight !== undefined) {\n                    acc.push(\n                      <rect\n                        className={bar.dataSeriesSet.cssClass}\n                        style={{\n                          fill: bar.dataSeriesSet.color\n                            ? bar.dataSeriesSet.color\n                            : undefined,\n                          color: bar.dataSeriesSet.color\n                            ? bar.dataSeriesSet.color\n                            : undefined,\n                        }}\n                        transform={`translate(${\n                          ((dataseriesIdx * 1) / bars.length) *\n                          SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH\n                        },${\n                          SequenceBarplotComponent.POSITION_VIEWBOX_HEIGHT -\n                          bar.normalizedHeight\n                        })`}\n                        width={barWidth}\n                        height={bar.normalizedHeight}\n                        key={`${bar.position}_${bar.dataSeriesSet.id}`}\n                      />\n                    );\n                  }\n                  return acc;\n\n                  //something off here with typescript and this accumulator.\n                  //can't specify type as rect\n                }, new Array<JSX.Element>())}\n\n                <rect\n                  className=\"interaction-placeholder\"\n                  transform={`translate(0,${\n                    SequenceBarplotComponent.POSITION_VIEWBOX_HEIGHT -\n                    maxBarHeight\n                  })`}\n                  width={SequenceBarplotComponent.POSITION_VIEWBOX_WIDTH}\n                  height={maxBarHeight}\n                ></rect>\n              </g>\n            );\n          }\n        )}\n      </svg>\n    );\n  }\n\n  /*\n   *\n   *\n   * REACT METHODS\n   *\n   *\n   */\n  shouldComponentUpdate(nextProps: ISequenceBarplotProps) {\n    const { alignment, dataSeriesSet, positionWidth } = this.props;\n    if (\n      !this.cache ||\n      alignment !== nextProps.alignment ||\n      dataSeriesSet !== nextProps.dataSeriesSet ||\n      positionWidth !== nextProps.positionWidth\n    ) {\n      return true;\n    }\n    return false;\n  }\n\n  componentDidUpdate() {\n    ReactTooltip.rebuild();\n  }\n\n  render() {\n    const className = this.state.svgHovered ? \"barplot hovered\" : \"barplot\";\n\n    return !this.props.alignment ? null : (\n      <div className={className}>\n        {this.renderTooltip()}\n        {this.renderBarPlot()}\n      </div>\n    );\n  }\n}\n","import * as PIXI from \"pixi.js\";\nimport { PixiComponent } from \"@inlet/react-pixi\";\nimport { Viewport } from \"pixi-viewport\";\n\nexport interface ICanvasAlignmentViewportProps {\n  numColumns: number;\n  numRows: number;\n  app: PIXI.Application;\n  onMouseClick?: (mousePosition: IPosition) => void;\n  stageDimensions: {\n    width: number;\n    height: number;\n  };\n  ensureVisible?: {\n    y: number;\n    height: number;\n  };\n}\n\nconst OVERFLOW_ZOOM_ALLOWED = 0.05; //allow 5% zoom out (both sides = 10% total) past max width / height\n\nexport const CanvasAlignmentViewport = PixiComponent<\n  ICanvasAlignmentViewportProps,\n  any\n>(\"CanvasAlignmentViewport\", {\n  create(props: ICanvasAlignmentViewportProps) {\n    const { app, numColumns, numRows, stageDimensions } = props;\n    app.renderer.backgroundColor = 0xffffff;\n\n    const useDrag = true; // Allows the user to drag the viewport around.\n    const usePinch = true; // Allows the user to pinch to zoom; e.g. on a trackpad.\n    const useWheel = true; // Allows the user to use a mouse wheel to zoom.\n\n    let vp = new Viewport({\n      screenWidth: stageDimensions.width,\n      //screenHeight: stageDimensions.height,\n      worldWidth: numColumns,\n      worldHeight: numRows,\n      interaction: app.renderer.plugins.interaction,\n    })\n      .decelerate()\n      .clamp({\n        direction: \"all\",\n      })\n      .bounce({ friction: 0.1, time: 150, underflow: \"center\" });\n\n    // !IMPORTANT\n    // Two-finger drag on trackpad is also enabled by this.\n    // Issue currently open: https://github.com/davidfig/pixi-viewport/issues/143\n    if (useDrag) {\n      vp = vp.drag({\n        direction: \"all\", //this is the line that kills pinch\n      });\n    }\n\n    if (usePinch) {\n      vp = vp.pinch();\n    }\n\n    if (useWheel) {\n      vp = vp.wheel();\n    }\n\n    return vp;\n  },\n\n  //apply props is triggered on new props\n  applyProps(\n    vp: Viewport,\n    oldProps: ICanvasAlignmentViewportProps,\n    newProps: ICanvasAlignmentViewportProps\n  ) {\n    const { onMouseClick, numRows, numColumns, stageDimensions } = newProps;\n\n    if (oldProps.onMouseClick !== onMouseClick) {\n      vp.off(\"clicked\"); //I tested and adding this line keeps us from getting multiple click listners\n      if (onMouseClick) {\n        vp.on(\"clicked\", (e) => {\n          onMouseClick({ x: e.world.x, y: e.world.y });\n        });\n      }\n    }\n\n    //deal with resizing events and new alignments\n    const resizedStage =\n      !oldProps.stageDimensions ||\n      oldProps.stageDimensions.height !== stageDimensions.height ||\n      oldProps.stageDimensions.width !== stageDimensions.width;\n    const newAlignment =\n      !oldProps.numColumns ||\n      !oldProps.numRows ||\n      oldProps.numColumns !== numColumns ||\n      oldProps.numRows !== numRows;\n\n    if (resizedStage || newAlignment) {\n      vp.resize(\n        stageDimensions.width,\n        stageDimensions.height,\n        numColumns,\n        numRows\n      );\n\n      //set the clamp based on the current stage height/width\n      let clampWidthMax, clampHeightMax;\n      let clampMinWidth = newProps.ensureVisible\n        ? newProps.ensureVisible.height\n        : undefined;\n\n      if (\n        numColumns / stageDimensions.width >\n        numRows / stageDimensions.height\n      ) {\n        //width is more important\n        clampWidthMax = numColumns + OVERFLOW_ZOOM_ALLOWED * numColumns;\n        vp = vp.clampZoom({\n          maxHeight: undefined,\n          maxWidth: clampWidthMax,\n          minHeight: clampMinWidth,\n        });\n      } else {\n        //height is more important\n        clampHeightMax = numRows + OVERFLOW_ZOOM_ALLOWED * numRows;\n        vp = vp.clampZoom({\n          maxWidth: undefined,\n          maxHeight: clampHeightMax,\n          minHeight: clampMinWidth,\n        });\n      }\n\n      //zoom to appropriate level\n      if (newAlignment) {\n        //new alignments set zoom clamping and also force the alignment into\n        //as much of a view as possible.\n        vp = vp.fitWorld(true);\n        vp = vp.setZoom(stageDimensions.width / numColumns, false);\n      } else if (\n        oldProps.stageDimensions &&\n        oldProps.stageDimensions.width !== stageDimensions.width\n      ) {\n        //the viewport is being resized horizontally (likely by user dragging)\n        //  1. compress if the resize is making pushing the alignment off the screen\n        //  2. scale alignment if the resize is expanding\n\n        if (oldProps.stageDimensions.width > stageDimensions.width) {\n          //viewport is shrinking horizontally\n          if (vp.scale.x * numColumns > stageDimensions.width) {\n            //it is pushing the current alignment off the screen, force\n            //the alignment to stay the same size as the viewport\n            vp = vp.setZoom(stageDimensions.width / numColumns, false);\n          }\n        } else {\n          //viewport is expanding horizontally\n\n          //detect new zoom level. this is pretty crude. is there a better way?\n          let newZoomLevel =\n            vp.scale.x *\n            (stageDimensions.width / oldProps.stageDimensions.width);\n\n          if (\n            (clampWidthMax &&\n              (newZoomLevel * numColumns < clampWidthMax ||\n                numColumns > stageDimensions.width)) ||\n            (clampHeightMax &&\n              (newZoomLevel * numRows < clampHeightMax ||\n                numRows > stageDimensions.height))\n          ) {\n            vp = vp.setZoom(newZoomLevel, false);\n          }\n        }\n      }\n    }\n\n    //once all the zoom etc\n    if (newProps.ensureVisible) {\n      //@ts-ignore\n      vp.ensureVisible(\n        undefined,\n        newProps.ensureVisible.y,\n        undefined,\n        newProps.ensureVisible.height\n      );\n    }\n\n    return vp;\n  },\n});\n","import * as PIXI from \"pixi.js\";\nimport { PixiComponent } from \"@inlet/react-pixi\";\nimport { Graphics } from \"pixi.js\";\n\ninterface IAlignmentHighlighterProps {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  fillColor: number;\n  fillAlpha: number;\n  dragFunctions?: {\n    onDragStart(\n      event: PIXI.interaction.InteractionEvent,\n      parent: PIXI.DisplayObject\n    ): void;\n    onDragEnd(\n      event: PIXI.interaction.InteractionEvent,\n      parent: PIXI.DisplayObject\n    ): void;\n    onDragMove(\n      event: PIXI.interaction.InteractionEvent,\n      parent: PIXI.DisplayObject\n    ): void;\n  };\n}\n\nexport const CanvasAlignmentHighlighter = PixiComponent(\n  \"CanvasAlignmentHighlighter\",\n  {\n    create: (props: IAlignmentHighlighterProps) => {\n      const toReturn = new Graphics();\n      toReturn.interactive = true;\n      return toReturn;\n    },\n    applyProps: (instance, oldProps, newProps) => {\n      const { x, y, width, height, fillColor, fillAlpha } = newProps;\n      instance.clear();\n      instance.beginFill(fillColor, fillAlpha);\n      instance.drawRect(x, y, width, height);\n      instance.endFill();\n\n      //inspired by\n      //http://scottmcdonnell.github.io/pixi-examples/index.html?s=demos&f=dragging.js\n      if (oldProps.dragFunctions !== newProps.dragFunctions) {\n        instance.removeAllListeners();\n        if (newProps.dragFunctions) {\n          instance.addListener(\"pointerdown\", (e) => {\n            e.stopPropagation(); //keep entire viewport from moving\n          });\n\n          const dragStart = (e: PIXI.interaction.InteractionEvent) => {\n            newProps.dragFunctions?.onDragStart(e, instance.parent);\n          };\n          const dragEnd = (e: PIXI.interaction.InteractionEvent) => {\n            newProps.dragFunctions?.onDragEnd(e, instance.parent);\n          };\n          const dragMove = (e: PIXI.interaction.InteractionEvent) => {\n            newProps.dragFunctions?.onDragMove(e, instance.parent);\n          };\n\n          //events for drag start\n          instance.addListener(\"mousedown\", dragStart);\n          instance.addListener(\"touchstart\", dragStart);\n\n          // events for drag end\n          instance.addListener(\"mouseup\", dragEnd);\n          instance.addListener(\"mouseupoutside\", dragEnd);\n          instance.addListener(\"touchend\", dragEnd);\n          instance.addListener(\"touchendoutside\", dragEnd);\n\n          // events for drag move\n          instance.addListener(\"mousemove\", dragMove);\n          instance.addListener(\"touchmove\", dragMove);\n        }\n      }\n    },\n  }\n);\n","import React from \"react\";\nimport { ISequence } from \"../common/Alignment\";\nimport { Nucleotide, AminoAcid } from \"../common/Residues\";\nimport { Sprite } from \"@inlet/react-pixi\";\nimport { ICanvasAlignmentProps } from \"./CanvasAlignmentComponent\";\n\nimport { PositionsToStyle, AlignmentTypes } from \"../common/MolecularStyles\";\n\nexport interface ITiledImages {\n  targetTileWidth: number;\n  targetTileHeight: number;\n  lastTileWidth: number;\n  lastTileHeight: number;\n  numXTiles: number;\n  numYTiles: number;\n  tiles: {\n    tileX: number;\n    tileY: number;\n    pixelX: number;\n    pixelY: number;\n    width: number;\n    height: number;\n    image: HTMLCanvasElement;\n  }[];\n}\n\nexport class CanvasAlignmentTiled extends React.Component<\n  ICanvasAlignmentProps\n> {\n  shouldComponentUpdate(nextProps: ICanvasAlignmentProps) {\n    return (\n      nextProps.alignment !== this.props.alignment ||\n      nextProps.colorScheme !== this.props.colorScheme ||\n      nextProps.positionsToStyle !== this.props.positionsToStyle ||\n      nextProps.sortBy !== this.props.sortBy\n    );\n  }\n\n  render() {\n    if (!this.props.alignment) {\n      return null;\n    }\n\n    const {\n      alignment,\n      alignmentType,\n      colorScheme,\n      positionsToStyle,\n      sortBy,\n    } = this.props;\n\n    // Generate multiple tiled images from the alignment\n    const sequences = alignment.getSequences(sortBy);\n    const fullWidth = alignment.getMaxSequenceLength();\n    const fullHeight = sequences.length;\n\n    const sizes = {\n      fullWidth,\n      fullHeight,\n      targetTileWidth: Math.min(400, fullWidth),\n      targetTileHeight: Math.min(400, fullHeight),\n    };\n\n    const tiledImages: ITiledImages = this.initializeTiledImages(sizes);\n\n    for (\n      let tileYNumber = 0;\n      tileYNumber < tiledImages.numYTiles;\n      tileYNumber++\n    ) {\n      for (\n        let tileXNumber = 0;\n        tileXNumber < tiledImages.numXTiles;\n        tileXNumber++\n      ) {\n        const tiledImage = this.generateCanvasForTile(\n          tileXNumber,\n          tileYNumber,\n          sizes.targetTileWidth,\n          sizes.targetTileHeight,\n          tiledImages,\n          sequences\n        );\n        tiledImages.tiles.push(tiledImage);\n      }\n    }\n\n    //console.log(\"CANVAS rerender [\" + sortBy.key + \"]\", sequences);\n    return (\n      <>\n        {tiledImages.tiles.map((tile) => (\n          <Sprite\n            source={tile.image}\n            x={tile.pixelX}\n            y={tile.pixelY}\n            key={`${tile.tileX}_\n                  ${tile.tileY}_\n                  ${colorScheme.commonName}_\n                  ${positionsToStyle.key}_\n                  ${alignmentType.key}_\n                  ${sortBy.key}_\n                  ${alignment.getName()}`}\n          ></Sprite>\n        ))}\n      </>\n    );\n  }\n\n  protected colorCanvasWithSequence(\n    tileImageData: ImageData,\n    tileCanvasContext: CanvasRenderingContext2D,\n    tileCanvas: HTMLCanvasElement,\n    sequences: ISequence[],\n    offsets: { seqY: number; letterX: number }\n  ) {\n    let imageDataIdx = 0;\n\n    for (let seqIdx = 0; seqIdx < tileCanvas.height; seqIdx++) {\n      const seq = sequences[seqIdx + offsets.seqY];\n      for (let letterIdx = 0; letterIdx < tileCanvas.width; letterIdx++) {\n        const letter = seq.sequence[letterIdx + offsets.letterX];\n        const colorScheme = this.getCurrentMoleculeColors(\n          letter,\n          letterIdx,\n          offsets\n        );\n\n        tileImageData.data[imageDataIdx] = colorScheme.rgb.red;\n        tileImageData.data[imageDataIdx + 1] = colorScheme.rgb.green;\n        tileImageData.data[imageDataIdx + 2] = colorScheme.rgb.blue;\n        tileImageData.data[imageDataIdx + 3] = 255; //alpha between 0 (transparent) and 255 (opaque)\n\n        imageDataIdx += 4;\n      }\n    }\n    tileCanvasContext.putImageData(tileImageData, 0, 0);\n  }\n\n  protected generateCanvasForTile(\n    tileXNumber: number,\n    tileYNumber: number,\n    targetTileWidth: number,\n    targetTileHeight: number,\n    tiledImages: ITiledImages,\n    sequences: ISequence[]\n  ) {\n    const tileCanvas = document.createElement(\"canvas\") as HTMLCanvasElement;\n    tileCanvas.height =\n      tileYNumber === tiledImages.numYTiles - 1\n        ? tiledImages.lastTileHeight\n        : targetTileHeight;\n    tileCanvas.width =\n      tileXNumber === tiledImages.numXTiles - 1\n        ? tiledImages.lastTileWidth\n        : targetTileWidth;\n\n    const offsets = {\n      seqY: tileYNumber * targetTileHeight,\n      letterX: tileXNumber * targetTileWidth,\n    };\n\n    const tileCanvasContext = tileCanvas.getContext(\"2d\");\n    tileCanvasContext?.fillRect(0, 0, tileCanvas.width, tileCanvas.height); //unclear why necessary\n    const tileImageData = tileCanvasContext?.getImageData(\n      0,\n      0,\n      tileCanvas.width,\n      tileCanvas.height\n    );\n\n    if (tileImageData && tileCanvasContext) {\n      this.colorCanvasWithSequence(\n        tileImageData,\n        tileCanvasContext,\n        tileCanvas,\n        sequences,\n        offsets\n      );\n    }\n\n    return {\n      tileX: tileXNumber,\n      tileY: tileYNumber,\n      pixelX: offsets.letterX,\n      pixelY: offsets.seqY,\n      width: tileCanvas.width,\n      height: tileCanvas.height,\n      image: tileCanvas,\n    };\n  }\n\n  protected getCurrentMoleculeColors(\n    letter: string,\n    letterIdx: number,\n    offsets: { seqY: number; letterX: number }\n  ) {\n    const { alignment, alignmentType, colorScheme } = this.props;\n    const consensusSequence = alignment.getConsensus().sequence;\n    const querySequence = alignment.getQuerySequence().sequence;\n    const moleculeClass =\n      alignmentType === AlignmentTypes.AMINOACID ? AminoAcid : Nucleotide;\n    let molecule = moleculeClass.UNKNOWN;\n\n    if (this.props.positionsToStyle === PositionsToStyle.ALL) {\n      molecule = moleculeClass.fromSingleLetterCode(letter);\n    } else {\n      const isConsensus =\n        consensusSequence[letterIdx + offsets.letterX] === letter;\n      const isQuery = querySequence[letterIdx + offsets.letterX] === letter;\n      if (\n        (this.props.positionsToStyle === PositionsToStyle.CONSENSUS &&\n          isConsensus) ||\n        (this.props.positionsToStyle === PositionsToStyle.CONSENSUS_DIFF &&\n          !isConsensus) ||\n        (this.props.positionsToStyle === PositionsToStyle.QUERY && isQuery) ||\n        (this.props.positionsToStyle === PositionsToStyle.QUERY_DIFF &&\n          !isQuery)\n      ) {\n        molecule = moleculeClass.fromSingleLetterCode(letter);\n      }\n    }\n    return molecule.colors[colorScheme.commonName];\n  }\n\n  protected initializeTiledImages({\n    targetTileWidth = 0,\n    targetTileHeight = 0,\n    fullWidth = 0,\n    fullHeight = 0,\n  }): ITiledImages {\n    return {\n      targetTileWidth: targetTileWidth,\n      targetTileHeight: targetTileHeight,\n      lastTileWidth:\n        fullWidth % targetTileWidth !== 0\n          ? fullWidth % targetTileWidth\n          : targetTileWidth,\n      lastTileHeight:\n        fullHeight % targetTileHeight !== 0\n          ? fullHeight % targetTileHeight\n          : targetTileHeight,\n      numXTiles:\n        fullWidth % targetTileWidth !== 0\n          ? Math.floor(fullWidth / targetTileWidth) + 1\n          : Math.floor(fullWidth / targetTileWidth),\n      numYTiles:\n        fullHeight % targetTileHeight !== 0\n          ? Math.floor(fullHeight / targetTileHeight) + 1\n          : Math.floor(fullHeight / targetTileHeight),\n      tiles: [],\n    };\n  }\n}\n","import React from \"react\";\nimport { Alignment } from \"../common/Alignment\";\nimport { SequenceSorter } from \"../common/AlignmentSorter\";\nimport * as PIXI from \"pixi.js\";\nimport { Stage, AppContext } from \"@inlet/react-pixi\";\nimport {\n  CanvasAlignmentViewport,\n  ICanvasAlignmentViewportProps,\n} from \"./CanvasAlignmentViewportComponent\";\nimport { CanvasAlignmentHighlighter } from \"./CanvasAlignmentHighlighterComponent\";\nimport { CanvasAlignmentTiled } from \"./CanvasAlignmentTiledComponent\";\n\nimport {\n  IColorScheme,\n  PositionsToStyle,\n  AlignmentTypes,\n} from \"../common/MolecularStyles\";\n\nexport interface ICanvasAlignmentProps {\n  alignment: Alignment;\n  alignmentType: AlignmentTypes;\n  sortBy: SequenceSorter;\n  positionsToStyle: PositionsToStyle;\n  colorScheme: IColorScheme;\n  highlightRows?: {\n    rowStart: number;\n    rowEnd: number;\n  };\n  stageDimensions?: {\n    width: number;\n    height: number;\n  };\n  viewportProps?: Partial<ICanvasAlignmentViewportProps>;\n\n  onClick?(mousePosition: IPosition): void;\n  onIndicatorDrag?(indicatorBounds: IRectangle, mousePosition: IPosition): void;\n}\n\ninterface ICanvasAlignmentState {\n  dragging: boolean;\n\n  dragPositions?: {\n    startOffset: {\n      left: number;\n      top: number;\n    };\n    current: PIXI.Point;\n  };\n}\n\nexport class CanvasAlignmentComponent extends React.Component<\n  ICanvasAlignmentProps,\n  ICanvasAlignmentState\n> {\n  app?: PIXI.Application;\n  protected divElement: React.RefObject<HTMLInputElement>;\n\n  static defaultProps = {\n    stageDimensions: {\n      width: 485,\n      height: 650,\n    },\n  };\n\n  constructor(props: ICanvasAlignmentProps) {\n    super(props);\n    this.state = {\n      dragging: false,\n    };\n    this.divElement = React.createRef();\n  }\n\n  /**\n   * Inform parent of the end of a drag event\n   * @param newMousePosition\n   */\n  protected informParentOfIndicatorDragged(newMousePosition: PIXI.Point) {\n    const { alignment, onIndicatorDrag } = this.props;\n    const { dragPositions } = this.state;\n\n    if (onIndicatorDrag && dragPositions) {\n      onIndicatorDrag(\n        {\n          x: 0,\n          y: Math.round(newMousePosition.y - dragPositions!.startOffset.top),\n          width: alignment.getMaxSequenceLength(),\n          height: 0,\n        },\n        newMousePosition\n      );\n    }\n  }\n\n  render() {\n    if (!this.props.alignment) {\n      return null;\n    }\n\n    const {\n      alignment,\n      alignmentType,\n      colorScheme,\n      highlightRows,\n      onClick,\n      positionsToStyle,\n      sortBy,\n      stageDimensions,\n      viewportProps,\n    } = this.props;\n    const { dragging, dragPositions } = this.state;\n\n    const numSequences = alignment.getSequences().length;\n    const maxSeqLength = alignment.getMaxSequenceLength();\n\n    PIXI.utils.skipHello();\n    PIXI.settings.SCALE_MODE = PIXI.SCALE_MODES.NEAREST; //\n    //TODO: still anti-aliases on retina devices. probably requires\n    //      writing 4x the pixels and telling pixi that it is a retina\n    //      image\n    //PIXI.settings.RESOLUTION = 2;\n    //PIXI.settings.ROUND_PIXELS = true; //\n\n    let rowHighlightStart: number | undefined;\n    let rowHighlighterHeight: number | undefined;\n\n    if (highlightRows) {\n      rowHighlighterHeight = highlightRows.rowEnd - highlightRows.rowStart + 1; //why +1? start/end inclusive\n      rowHighlightStart =\n        dragging && dragPositions\n          ? Math.round(dragPositions.current.y - dragPositions.startOffset.top)\n          : highlightRows.rowStart;\n      rowHighlightStart = rowHighlightStart > 0 ? rowHighlightStart : 0;\n    }\n\n    //const stageHeight =\n    //  this.divElement.current && this.divElement.current.clientHeight // can be zero. this is kind of hacky\n    //    ? this.divElement.current.clientHeight\n    //    : stageDimensions?.height;\n    const stageHeight = stageDimensions?.height;\n    const stageWidth = stageDimensions?.width;\n\n    return (\n      <div\n        className=\"alignment-canvas\"\n        onWheel={this.onWheel}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        //style={{ width: stageWidth }}\n        ref={this.divElement}\n      >\n        {!this.divElement ? null : (\n          <Stage\n            width={stageWidth}\n            height={stageHeight}\n            options={{ transparent: true }}\n          >\n            <AppContext.Consumer>\n              {(app) => {\n                this.app = app;\n                return <></>;\n              }}\n            </AppContext.Consumer>\n            <AppContext.Consumer>\n              {(app) => (\n                <CanvasAlignmentViewport\n                  app={app}\n                  ensureVisible={\n                    rowHighlightStart === undefined ||\n                    rowHighlighterHeight === undefined\n                      ? undefined\n                      : {\n                          y: rowHighlightStart,\n                          height: rowHighlighterHeight,\n                        }\n                  }\n                  numColumns={maxSeqLength}\n                  numRows={numSequences}\n                  onMouseClick={onClick}\n                  stageDimensions={stageDimensions!}\n                  {...viewportProps}\n                >\n                  <CanvasAlignmentTiled\n                    alignment={alignment}\n                    alignmentType={alignmentType}\n                    sortBy={sortBy}\n                    colorScheme={colorScheme}\n                    positionsToStyle={positionsToStyle}\n                  />\n                  {rowHighlightStart !== undefined &&\n                  rowHighlighterHeight !== undefined &&\n                  rowHighlighterHeight < alignment.getSequences().length ? (\n                    <CanvasAlignmentHighlighter\n                      fillColor={0xff0000}\n                      fillAlpha={0.25}\n                      x={0}\n                      y={rowHighlightStart}\n                      width={maxSeqLength}\n                      height={rowHighlighterHeight}\n                      dragFunctions={{\n                        onDragStart: (e, parent) => {\n                          const startPosition = e.data.getLocalPosition(parent);\n                          this.setState({\n                            dragging: true,\n                            dragPositions: {\n                              startOffset: {\n                                left: startPosition.x - 0,\n                                top: startPosition.y - rowHighlightStart!,\n                              },\n                              current: startPosition,\n                            },\n                          });\n                        },\n                        onDragEnd: (e, parent) => {\n                          this.setState({ dragging: false });\n                          this.informParentOfIndicatorDragged(\n                            e.data.getLocalPosition(parent)\n                          );\n                        },\n                        onDragMove: (e, parent) => {\n                          if (dragging) {\n                            const newPosition = e.data.getLocalPosition(parent);\n\n                            this.setState({\n                              dragPositions: {\n                                startOffset: dragPositions!.startOffset,\n                                current: newPosition,\n                              },\n                            });\n                            this.informParentOfIndicatorDragged(newPosition);\n                          }\n                        },\n                      }}\n                    />\n                  ) : (\n                    <></>\n                  )}\n                </CanvasAlignmentViewport>\n              )}\n            </AppContext.Consumer>\n          </Stage>\n        )}\n      </div>\n    );\n  }\n\n  protected onMouseEnter = (e: React.MouseEvent<HTMLDivElement>) => {\n    //keep the scroll bars from appearing when the user is interacting with\n    //the canvas. This fixes an issue where the canvas keeps moving around\n    //due to appearince of the scroll bar in safari.\n    document.body.style.overflow = \"hidden\";\n  };\n\n  protected onMouseLeave = (e: React.MouseEvent<HTMLDivElement>) => {\n    document.body.style.overflow = \"auto\";\n  };\n\n  protected onWheel = (e: React.WheelEvent<HTMLDivElement>) => {\n    //console.log(\"onWheel!\", e);\n    //e.preventDefault(); //TODO Drew is this necessary?\n  };\n}\n","import * as React from \"react\";\nimport \"./MiniMap.scss\";\n\nimport { CanvasAlignmentComponent } from \"./CanvasAlignmentComponent\";\nimport { Alignment } from \"../common/Alignment\";\nimport { SequenceSorter } from \"../common/AlignmentSorter\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n} from \"../common/MolecularStyles\";\nimport { ResizeSensor } from \"css-element-queries\";\n\nexport interface IMiniMapProps {\n  //don't expose these props in the AlignmentViewer full component\n  alignment: Alignment;\n  sortBy: SequenceSorter;\n  alignmentStyle: AminoAcidAlignmentStyle | NucleotideAlignmentStyle;\n  highlightRows?: {\n    rowStart: number;\n    rowEnd: number;\n  };\n\n  //props that should be exposed in AlignmentViewer full component:\n  alignHorizontal?: \"left\" | \"right\";\n  startingWidth?: number;\n  resizable?: \"none\" | \"horizontal\";\n  verticalHeight?: \"div\" | \"window\";\n\n  //expose these, but requires smarter forwarding within the AlignmentViewer full component\n  onClick?(mousePosition: IPosition): void;\n  onIndicatorDrag?(rectBounds: IRectangle, mousePosition: IPosition): void;\n}\n\nexport interface IMiniMapState {\n  height: number; //calculated dynamically\n  resizedWidth?: number;\n}\n\nexport class MiniMapComponent extends React.Component<\n  IMiniMapProps,\n  IMiniMapState\n> {\n  private ref?: HTMLDivElement;\n  private resizeSensor?: ResizeSensor;\n\n  public static defaultProps = {\n    alignHorizontal: \"right\",\n    startingWidth: 120,\n    resizable: \"none\",\n    verticalHeight: \"div\",\n  };\n\n  constructor(props: IMiniMapProps) {\n    super(props);\n\n    this.state = {\n      //zoomPercent: 1,\n      height: window.innerHeight,\n    };\n    this.setupResizeSensor = this.setupResizeSensor.bind(this);\n  }\n\n  protected getSizing() {\n    const { startingWidth } = this.props;\n    const { height, resizedWidth } = this.state;\n\n    const frameBorderWidth = 1; // in pixels\n    const frameMargin = 2; // in pixels\n\n    function adjustForBorderAndMargin(length: number) {\n      return length - 2 * frameMargin - 1 * frameBorderWidth;\n    }\n\n    return {\n      borderWidth: frameBorderWidth,\n      margin: frameMargin,\n      frameHeight: height, //adjustForBorderAndMargin(height),\n      frameWidth: resizedWidth\n        ? resizedWidth\n        : startingWidth\n        ? adjustForBorderAndMargin(startingWidth)\n        : adjustForBorderAndMargin(MiniMapComponent.defaultProps.startingWidth),\n    };\n  }\n\n  protected setupResizeSensor(ref: HTMLDivElement | null) {\n    if (ref && !this.resizeSensor) {\n      this.ref = ref;\n      this.resizeSensor = new ResizeSensor(ref, () => {\n        if (\n          this.state.resizedWidth !== ref.clientWidth ||\n          this.state.height !== ref.clientHeight\n        ) {\n          setTimeout(() => {\n            //flashes (worse) without setTimeout. Safari still flashing.\n            this.setState({\n              resizedWidth: ref.clientWidth,\n              height: ref.clientHeight,\n            });\n          });\n        }\n      });\n    }\n  }\n\n  /*\n   *\n   *\n   * RENDER METHODS\n   *\n   *\n   */\n\n  protected renderCanvasComponent = () => {\n    const { alignment, highlightRows, sortBy, alignmentStyle } = this.props;\n    const size = this.getSizing();\n    return (\n      <CanvasAlignmentComponent\n        alignment={alignment}\n        alignmentType={alignmentStyle.alignmentType}\n        positionsToStyle={alignmentStyle.positionsToStyle}\n        colorScheme={alignmentStyle.colorScheme}\n        sortBy={sortBy}\n        stageDimensions={{\n          width: size.frameWidth - 14, //add space for the dragger on safari\n          height: size.frameHeight,\n        }}\n        highlightRows={highlightRows}\n        onClick={this.props.onClick}\n        onIndicatorDrag={this.props.onIndicatorDrag}\n      />\n    );\n  };\n\n  /*\n   *\n   *\n   * REACT METHODS\n   *\n   *\n   */\n  render() {\n    const { alignHorizontal, resizable, verticalHeight } = this.props;\n    const size = this.getSizing();\n\n    const position = verticalHeight === \"div\" ? \"absolute\" : \"fixed\";\n\n    return (\n      <div\n        ref={this.setupResizeSensor}\n        className=\"minimap-holder\"\n        style={{\n          ...(alignHorizontal === \"left\" ? { left: 0 } : { right: 0 }),\n          position: position,\n          width: size.frameWidth,\n          borderWidth: `${size.borderWidth}px`,\n          margin: `${size.margin}px`,\n          resize: resizable ? resizable : \"none\",\n          direction: alignHorizontal === \"left\" ? \"ltr\" : \"rtl\",\n        }}\n      >\n        {this.renderCanvasComponent()}\n      </div>\n    );\n  }\n}\n","/**\n * Base class for Ace Editor Components\n */\nimport React from \"react\";\nimport ace from \"ace-builds\";\nimport { Ace } from \"ace-builds\";\n\nexport interface IAceEditorProps {\n  readonly id?: string;\n\n  text?: string;\n  fontSize?: number;\n  editorMode?: string;\n  classNames?: string;\n\n  editorLoaded?(editor: Ace.Editor, parentElem: HTMLDivElement): void;\n  characterSizeChanged?(newCharacterWidth: number): void;\n\n  mouseDown?(e: {\n    mouseRow: number;\n    mouseColumn: number;\n    mousePageX: number;\n    mousePageY: number;\n    //mouseContainerX: number;\n    //mouseContainerY: number;\n  }): void;\n\n  mouseMove?(e: {\n    mouseRow: number;\n    mouseColumn: number;\n    mousePageX: number;\n    mousePageY: number;\n    //mouseContainerX: number;\n    //mouseContainerY: number;\n  }): void;\n\n  mouseEnter?(): void;\n  mouseLeave?(): void;\n}\n\ninterface IChangeCharacterSizeEvent {\n  data: { height: number; width: number };\n  preventDefault(): void;\n  stopPropagation(): void;\n}\n\nexport class AceEditorComponent<\n  P extends IAceEditorProps,\n  S = {}\n> extends React.Component<P, S> {\n  private editor?: Ace.Editor;\n  private lastText?: string;\n  private lastMode?: string;\n  private element?: HTMLElement;\n  private lastElementWidth?: number;\n  private lastElementHeight?: number;\n  static defaultProps = {\n    fontSize: 14,\n  };\n\n  /**************************\n   *\n   *\n   * METHODS REQUIRED FROM SUBCLASSES\n   *\n   *\n   **************************/\n  getText(): string {\n    if (this.props.text) {\n      return this.props.text!;\n    }\n    throw Error(\n      \"Internal error: 'text' attribute must be provided or subclasses must implement getText()\"\n    );\n  }\n  getEditorMode(): string | undefined {\n    return this.props.editorMode;\n  }\n\n  /**************************\n   *\n   *\n   * PROTECTED METHODS\n   *\n   *\n   **************************/\n  /**\n   * Load and setup the ace editor\n   * @param el the element that will hold the ace editor.\n   */\n  protected setupEditor(el: HTMLElement) {\n    this.editor = ace.edit(el);\n    this.editor.setShowPrintMargin(false);\n    this.editor.setReadOnly(true);\n    this.editor.setHighlightActiveLine(false);\n    this.editor.setHighlightGutterLine(false);\n    this.editor.setFontSize(this.props.fontSize + \"px\");\n    this.editor.renderer.setShowGutter(false);\n    this.editor.renderer.setPadding(0);\n    this.editor.renderer.$cursorLayer.element.style.display = \"none\";\n  }\n\n  /**\n   * listen to mouse events and report them to instantiator\n   */\n  protected addEventListeners() {\n    if (!this.editor) {\n      throw Error(\"Editor must be defined before adding listeners.\");\n    }\n    const { characterSizeChanged, mouseDown, mouseMove } = this.props;\n\n    function getMousePosition(editor: Ace.Editor, event: Ace.AceEvent) {\n      var pos = event.getDocumentPosition();\n      var screenCoordinates = editor.renderer.textToScreenCoordinates(\n        pos.row,\n        pos.column\n      );\n      return {\n        mouseRow: pos.row,\n        mouseColumn: pos.column,\n        mousePageX: screenCoordinates.pageX,\n        mousePageY: screenCoordinates.pageY,\n        //mouseContainerX:\n        //  characterWidth * pos.column - this.editor.session.getScrollLeft(),\n        //mouseContainerY: characterWidth * pos.row ???\n      };\n    }\n\n    this.editor!.on(\"mousemove\", (e) => {\n      if (mouseMove) {\n        mouseMove(getMousePosition(this.editor!, e));\n      }\n    });\n\n    this.editor!.on(\"mousedown\", (e) => {\n      if (mouseDown) {\n        mouseDown(getMousePosition(this.editor!, e));\n      }\n    });\n\n    this.editor.renderer.on(\n      \"changeCharacterSize\",\n      (e: IChangeCharacterSizeEvent) => {\n        if (characterSizeChanged) {\n          characterSizeChanged(e.data.width);\n        }\n      }\n    );\n  }\n\n  /**\n   * update the text in the editor and set the editor to use that\n   * mode (if provided).\n   * @param newText\n   * @param modeName the mode name for highlighting this ace editor. For alignments, this can\n   *                 be defined as follows:\n   *    const modeName = \"ace/mode/\" + this.props.alignment.getName();\n   *    defineNewAlignmentMode(modeName, this.props.alignment);\n   *    setText()\n   * @throws an error if the editor is not yet defined.\n   */\n  protected setText() {\n    if (!this.editor) {\n      throw Error(\"Editor must be defined to call setText()\");\n    }\n    //only update if needed\n    if (this.props.fontSize + \"px\" !== this.editor.getFontSize()) {\n      this.editor.setFontSize(this.props.fontSize + \"px\");\n    }\n    if (this.lastMode !== this.getEditorMode()) {\n      const newMode = this.getEditorMode();\n      this.editor.session.setMode(newMode!);\n      this.lastMode = newMode;\n    }\n    if (!this.lastText || this.lastText !== this.getText()) {\n      this.editor.selectAll();\n      this.editor.removeLines();\n      const newText = this.getText();\n      this.editor.insert(newText);\n      this.lastText = newText;\n    }\n  }\n\n  /**\n   * The initial editor load function. Will only run a single time.\n   * @param e the HTMLelment that will hold the ace editor\n   */\n  protected initialLoad(e: HTMLDivElement | null) {\n    if (e && !this.editor) {\n      //only run if editor not loaded\n      this.element = e;\n      this.lastElementWidth = e.clientWidth;\n      this.lastElementHeight = e.clientHeight;\n      this.setupEditor(e);\n      this.addEventListeners();\n      this.setText();\n      if (this.props.editorLoaded) {\n        this.props.editorLoaded(this.editor!, e); //inform parent of loading.\n      }\n    }\n  }\n\n  /**************************\n   *\n   *\n   * REACT METHODS\n   *\n   *\n   **************************/\n  componentDidUpdate() {\n    if (!this.editor || !this.element) {\n      throw Error(\n        \"internal error - componentDidUpdate called before editor initialized\"\n      );\n    }\n    this.setText(); //smart and will update only if needed.\n    if (\n      this.element.clientWidth !== this.lastElementWidth ||\n      this.element.clientHeight !== this.lastElementHeight\n    ) {\n      this.lastElementWidth = this.element.clientWidth;\n      this.lastElementHeight = this.element.clientHeight;\n      this.editor.resize();\n    }\n    return false;\n  }\n\n  render() {\n    return (\n      <div\n        className={this.props.classNames}\n        onMouseEnter={() => {\n          if (this.props.mouseEnter) {\n            this.props.mouseEnter();\n          }\n        }}\n        onMouseLeave={() => {\n          if (this.props.mouseLeave) {\n            this.props.mouseLeave();\n          }\n        }}\n      >\n        <div id={this.props.id} ref={(e) => this.initialLoad(e)}></div>\n      </div>\n    );\n  }\n}\n","import { Alignment } from \"../common/Alignment\";\nimport { SequenceSorter } from \"../common/AlignmentSorter\";\nimport { AceEditorComponent, IAceEditorProps } from \"./AceEditorComponent\";\n\nexport interface IAceMultipleSequenceAlignmentProps extends IAceEditorProps {\n  alignment: Alignment;\n  sortBy?: SequenceSorter;\n}\n\nexport class AceMultipleSequenceAlignmentComponent extends AceEditorComponent<\n  IAceMultipleSequenceAlignmentProps,\n  {}\n> {\n  static defaultProps = {\n    sortBy: SequenceSorter.INPUT,\n    fontSize: 14,\n  };\n\n  getText(): string {\n    return this.props.alignment\n      .getSequences(this.props.sortBy)\n      .map((x) => x.sequence)\n      .join(\"\\n\");\n  }\n  getEditorMode() {\n    return this.props.alignment.getAceEditorMode();\n  }\n}\n","import { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\n\nexport class AceConsensusSequenceComponent extends AceMultipleSequenceAlignmentComponent {\n  getText() {\n    return this.props.alignment.getConsensus().sequence;\n  }\n}\n","import React from \"react\";\nimport \"./AlignmentViewer.scss\";\nimport { Ace } from \"ace-builds\";\nimport { Alignment } from \"../common/Alignment\";\nimport { SequenceSorter } from \"../common/AlignmentSorter\";\nimport { ScrollSync, ScrollType } from \"../common/ScrollSync\";\nimport {\n  SequenceLogoComponent,\n  LOGO_TYPES,\n  ISequenceLogoProps,\n} from \"./SequenceLogoComponent\";\nimport {\n  SequenceBarplotComponent,\n  ISequenceBarplotProps,\n} from \"./SequenceBarplotComponent\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n  PositionsToStyle,\n} from \"../common/MolecularStyles\";\nimport { MiniMapComponent } from \"./MiniMapComponent\";\nimport { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\nimport { AceConsensusSequenceComponent } from \"./AceConsensusSequenceComponent\";\nimport { AceQuerySequenceComponent } from \"./AceQuerySequenceComponent\";\nimport { AceTextualRulerComponent } from \"./AceTextualRulerComponent\";\nimport { AceEditorComponent } from \"./AceEditorComponent\";\nimport { IMiniMapProps } from \"./MiniMapComponent\";\n\nexport type IAlignmentViewerProps = {\n  alignment: Alignment;\n  style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle;\n} & Partial<DefaultPropsTypes>;\n\ntype DefaultPropsTypes = Readonly<typeof defaultProps>;\ntype IBarplotExposedProps = Pick<\n  ISequenceBarplotProps,\n  \"dataSeriesSet\" | \"tooltipPlacement\" | \"height\"\n>;\n\nconst defaultProps = {\n  zoomLevel: 13 as number,\n  sortBy: SequenceSorter.INPUT as SequenceSorter,\n\n  showAnnotations: true as boolean,\n  showConsensus: true as boolean,\n  showLogo: true as boolean,\n  showMinimap: false as boolean,\n  showQuery: true as boolean,\n  showRuler: true as boolean,\n\n  logoOptions: {\n    logoType: LOGO_TYPES.LETTERS,\n    height: \"100px\",\n    tooltipPlacement: undefined,\n  } as Partial<\n    Pick<ISequenceLogoProps, \"tooltipPlacement\" | \"logoType\" | \"height\">\n  >,\n\n  minimapOptions: {\n    alignHorizontal: \"right\",\n    startingWidth: 100,\n    resizable: \"horizontal\",\n    verticalHeight: \"div\",\n  } as Partial<\n    Pick<\n      IMiniMapProps,\n      \"alignHorizontal\" | \"startingWidth\" | \"resizable\" | \"verticalHeight\"\n    >\n  >,\n\n  //array of individual barplots. Each barplot can contain multiple\n  //dataseries. Note that more than 2 dataseries in a single plot\n  //is difficult to understand and more than 3 is pretty much impossible\n  barplots: [\n    {\n      dataSeriesSet: [\n        SequenceBarplotComponent.SHANNON_ENTROPY_BARPLOT,\n        SequenceBarplotComponent.GAPS_BARPLOT,\n      ],\n      tooltipPlacement: undefined,\n      height: \"100px\",\n    },\n    //[SequenceBarplotComponent.KULLBAC_LEIBLER_DIVERGENCE_BARPLOT],\n  ] as undefined | IBarplotExposedProps[],\n};\n\nenum ACE_EDITOR_IDS {\n  QUERY = \"QUERY\",\n  CONSENSUS = \"CONSENSUS\",\n  POSITIONAL_RULER = \"POSITIONAL_RULER\",\n  MSA_SEQUENCES = \"MSA_SEQUENCES\",\n  MSA_IDS = \"MSA_IDS\",\n}\n\ninterface IAlignmentViewerState {\n  aceCharacterWidth: number;\n  aceEditors: { [editorId: string]: Ace.Editor };\n  msaEditorVewport?: {\n    numberVisibleRows: number;\n    firstFullyVisibleRow: number;\n    lastFullyVisibleRow: number;\n  };\n\n  windowWidth: number;\n  //windowHeight: number;\n}\n\nexport class AlignmentViewer extends React.Component<\n  IAlignmentViewerProps,\n  IAlignmentViewerState\n> {\n  private verticalScrollSync: ScrollSync;\n  private horizontalScrollSync: ScrollSync;\n\n  static defaultProps = defaultProps;\n\n  constructor(props: IAlignmentViewerProps) {\n    super(props);\n\n    this.state = {\n      aceEditors: {},\n      aceCharacterWidth: 0,\n      windowWidth: window.innerWidth,\n      //windowHeight: window.innerHeight,\n    };\n\n    this.verticalScrollSync = new ScrollSync(ScrollType.vertical);\n    this.horizontalScrollSync = new ScrollSync(ScrollType.horizontal);\n\n    this.minimapClicked = this.minimapClicked.bind(this);\n    this.minimapRectHighlightMoved = this.minimapRectHighlightMoved.bind(this);\n    this.handleCharacterSizeChanged = this.handleCharacterSizeChanged.bind(\n      this\n    );\n    this.aceEditorLoaded = this.aceEditorLoaded.bind(this);\n    this.windowDimensionsUpdated = this.windowDimensionsUpdated.bind(this);\n  }\n\n  private handleCharacterSizeChanged(newCharSize: number) {\n    if (this.state.aceCharacterWidth !== newCharSize) {\n      this.setState({\n        aceCharacterWidth: newCharSize,\n      });\n    }\n  }\n\n  /**\n   * Handle new ace editor. Add it to scroll sync.\n   * @param id\n   * @param editor\n   * @param parentElem\n   * @param scrollSyncDirection\n   */\n  private aceEditorLoaded(\n    id: ACE_EDITOR_IDS,\n    editor: Ace.Editor,\n    parentElem: HTMLDivElement,\n    scrollSyncDirection: ScrollType\n  ) {\n    if (\n      scrollSyncDirection === ScrollType.horizontal ||\n      scrollSyncDirection === ScrollType.both\n    ) {\n      this.horizontalScrollSync.registerAceScroller(editor, parentElem);\n    }\n    if (\n      scrollSyncDirection === ScrollType.vertical ||\n      scrollSyncDirection === ScrollType.both\n    ) {\n      this.verticalScrollSync.registerAceScroller(editor, parentElem);\n    }\n\n    this.setState((startState) => {\n      const newAceEditors = { ...startState.aceEditors };\n      newAceEditors[id] = editor;\n\n      return {\n        aceCharacterWidth: editor.renderer.characterWidth, //todo: check if the same always.\n        aceEditors: newAceEditors,\n      };\n    });\n\n    //track visible rows to show in canvas MSA\n    if (id === ACE_EDITOR_IDS.MSA_SEQUENCES) {\n      editor.renderer.on(\"afterRender\", () => {\n        // BREAKS LOGO, rerenders everything below and kills performance. React lifecycle stuff.\n        //setTimeout(() => {\n\n        this.setState({\n          msaEditorVewport: {\n            numberVisibleRows:\n              editor.renderer.getLastFullyVisibleRow() -\n              editor.renderer.getFirstFullyVisibleRow() +\n              1,\n            firstFullyVisibleRow: editor.renderer.getFirstFullyVisibleRow(),\n            lastFullyVisibleRow: editor.renderer.getLastFullyVisibleRow(),\n          },\n        });\n        //});\n      });\n    }\n  }\n\n  /**\n   * React to window dimension changes\n   */\n  protected windowDimensionsUpdated() {\n    this.setState({\n      windowWidth: window.innerWidth,\n      //windowHeight: window.innerHeight,\n    });\n  }\n\n  /**\n   * scroll the aceEditors to a specific position when user clicks on the minimap\n   * the editor should center around the click, which will be calculated here.\n   *\n   * TODO: this might be better delt with in the scroll sync class and only have\n   *       one of the editors deal with the rectangles. It works fine right now\n   *       when there is only one vertical scroll sync and the minimap widget\n   *       spans the entire row, but it will be trickier if e.g., we have\n   *       the rectangle take up only the visible horizontal space also.\n   *\n   * @param mousePosition\n   */\n  protected minimapClicked(mousePosition: IPosition) {\n    const { aceEditors, msaEditorVewport } = this.state;\n\n    //the ace editor should center around the click. calculate height\n    const numRowsVisibleInAceEditor = msaEditorVewport\n      ? msaEditorVewport.numberVisibleRows\n      : 0;\n    let newY = Math.round(mousePosition.y - numRowsVisibleInAceEditor / 2);\n    newY = newY < 0 ? 0 : newY;\n\n    if (aceEditors[ACE_EDITOR_IDS.MSA_SEQUENCES] !== undefined) {\n      aceEditors[ACE_EDITOR_IDS.MSA_SEQUENCES]!.scrollToRow(newY);\n    }\n    if (aceEditors[ACE_EDITOR_IDS.MSA_IDS] !== undefined) {\n      aceEditors[ACE_EDITOR_IDS.MSA_IDS]!.scrollToRow(newY);\n    }\n  }\n\n  /**\n   * scroll to specific position when user moves the highlight indicator on minimap\n   * by dragging the rectangle itself.\n   *\n   * TODO: this might be better delt with in the scroll sync class and only have\n   *       one of the editors deal with the rectangles. It works fine right now\n   *       when there is only one vertical scroll sync and the minimap widget\n   *       spans the entire row, but it will be trickier if e.g., we have\n   *       the rectangle take up only the visible horizontal space also.\n   */\n  protected minimapRectHighlightMoved(\n    rectBounds: IRectangle,\n    mousePosition: IPosition\n  ) {\n    const { aceEditors } = this.state;\n\n    if (aceEditors[ACE_EDITOR_IDS.MSA_SEQUENCES] !== undefined) {\n      aceEditors[ACE_EDITOR_IDS.MSA_SEQUENCES]!.scrollToRow(rectBounds.y);\n    }\n    if (aceEditors[ACE_EDITOR_IDS.MSA_IDS] !== undefined) {\n      aceEditors[ACE_EDITOR_IDS.MSA_IDS]!.scrollToRow(rectBounds.y);\n    }\n  }\n\n  /*\n   *\n   *\n   * RENDER DIFFERENT COMPONENTS\n   *\n   *\n   */\n\n  /**\n   * Generate a single widget that contains an annotation and content\n   * @param className\n   * @param annotation\n   * @param content\n   * @param addAsElementToScrollSync\n   */\n  protected renderWidget(\n    className: string,\n    annotation: string | JSX.Element,\n    content: JSX.Element | null,\n    addAsElementToScrollSync?: boolean,\n    key?: string\n  ) {\n    return (\n      <div className={`av-widget ${className}`} key={key}>\n        <div className=\"av-annotation\">{annotation}</div>\n        <div\n          className=\"av-content\"\n          ref={(e) => {\n            if (e && addAsElementToScrollSync) {\n              //TODO: move into separate component .. Ref can be null here and\n              //      also good to keep track of removal / addition for scroll sync\n              //console.log(\"the ref is:\", e);\n              this.horizontalScrollSync.registerElementScroller(e);\n            }\n          }}\n        >\n          {content}\n        </div>\n      </div>\n    );\n  }\n\n  protected renderSequenceLogo = () => {\n    const { alignment, logoOptions, style } = this.props;\n    const logoOpts = logoOptions ? logoOptions : defaultProps.logoOptions;\n\n    return (\n      <div\n        className={\n          `${style.alignmentType.className} ` +\n          `${style.colorScheme.className} ` +\n          `${PositionsToStyle.ALL.className}`\n        }\n      >\n        {\n          <SequenceLogoComponent\n            alignment={alignment}\n            glyphWidth={this.state.aceCharacterWidth}\n            alignmentType={style.alignmentType}\n            logoType={logoOpts.logoType}\n            tooltipPlacement={logoOpts.tooltipPlacement}\n            height={logoOpts.height}\n          />\n        }\n      </div>\n    );\n  };\n\n  protected renderBarplot = (barplotProps: IBarplotExposedProps) => {\n    return (\n      <SequenceBarplotComponent\n        alignment={this.props.alignment}\n        tooltipPlacement={barplotProps.tooltipPlacement}\n        dataSeriesSet={barplotProps.dataSeriesSet}\n        positionWidth={this.state.aceCharacterWidth}\n        height={barplotProps.height}\n      ></SequenceBarplotComponent>\n    );\n  };\n\n  protected renderConsensusQueryBox = () => (\n    <div className=\"consensusseq-box\">\n      <AceConsensusSequenceComponent\n        alignment={this.props.alignment}\n        fontSize={\n          this.props.zoomLevel ? this.props.zoomLevel : defaultProps.zoomLevel\n        }\n        classNames={[\n          \"ace-consensusseq\",\n          this.props.style.residueDetail.className,\n          this.props.style.alignmentType.className,\n          this.props.style.positionsToStyle.className,\n          this.props.style.colorScheme.className,\n        ].join(\" \")}\n        editorLoaded={(editor, parentElem) => {\n          this.aceEditorLoaded(\n            ACE_EDITOR_IDS.CONSENSUS,\n            editor,\n            parentElem,\n            ScrollType.horizontal\n          );\n        }}\n      ></AceConsensusSequenceComponent>\n    </div>\n  );\n\n  protected renderQuerySeqBox = () => (\n    <div className=\"queryseq-box\">\n      <AceQuerySequenceComponent\n        alignment={this.props.alignment}\n        fontSize={\n          this.props.zoomLevel ? this.props.zoomLevel : defaultProps.zoomLevel\n        }\n        sortBy={this.props.sortBy ? this.props.sortBy : defaultProps.sortBy}\n        classNames={[\n          \"ace-queryseq\",\n          this.props.style.residueDetail.className,\n          this.props.style.alignmentType.className,\n          this.props.style.positionsToStyle.className,\n          this.props.style.colorScheme.className,\n        ].join(\" \")}\n        editorLoaded={(editor, parentElem) => {\n          this.aceEditorLoaded(\n            ACE_EDITOR_IDS.QUERY,\n            editor,\n            parentElem,\n            ScrollType.horizontal\n          );\n        }}\n      ></AceQuerySequenceComponent>\n    </div>\n  );\n\n  protected renderPositionBox = () => (\n    <div className=\"position-box\">\n      {\n        <AceTextualRulerComponent\n          classNames=\"ace-positions\"\n          alignment={this.props.alignment}\n          fontSize={\n            this.props.zoomLevel ? this.props.zoomLevel : defaultProps.zoomLevel\n          }\n          editorLoaded={(editor, parentElem) => {\n            this.aceEditorLoaded(\n              ACE_EDITOR_IDS.POSITIONAL_RULER,\n              editor,\n              parentElem,\n              ScrollType.horizontal\n            );\n          }}\n        />\n      }\n    </div>\n  );\n\n  protected renderAlignmentBox = () => (\n    <div className=\"alignment-box\">\n      <AceMultipleSequenceAlignmentComponent\n        alignment={this.props.alignment}\n        fontSize={\n          this.props.zoomLevel ? this.props.zoomLevel : defaultProps.zoomLevel\n        }\n        sortBy={this.props.sortBy ? this.props.sortBy : defaultProps.sortBy}\n        classNames={[\n          \"ace-alignment\",\n          this.props.style.residueDetail.className,\n          this.props.style.alignmentType.className,\n          this.props.style.positionsToStyle.className,\n          this.props.style.colorScheme.className,\n        ].join(\" \")}\n        characterSizeChanged={this.handleCharacterSizeChanged}\n        editorLoaded={(editor, parentElem) => {\n          this.aceEditorLoaded(\n            ACE_EDITOR_IDS.MSA_SEQUENCES,\n            editor,\n            parentElem,\n            ScrollType.both\n          );\n        }}\n      ></AceMultipleSequenceAlignmentComponent>\n    </div>\n  );\n\n  protected renderAlignmentAnnotationBox = () => (\n    <div className=\"alignment-metadata-box\">\n      <AceEditorComponent\n        classNames=\"ace-alignment-metadata\"\n        text={this.props.alignment\n          .getSequences(\n            this.props.sortBy ? this.props.sortBy : defaultProps.sortBy\n          )\n          .map((x) => x.id)\n          .join(\"\\n\")}\n        fontSize={\n          this.props.zoomLevel ? this.props.zoomLevel : defaultProps.zoomLevel\n        }\n        editorLoaded={(editor, parentElem) => {\n          this.aceEditorLoaded(\n            ACE_EDITOR_IDS.MSA_IDS,\n            editor,\n            parentElem,\n            ScrollType.vertical\n          );\n        }}\n      ></AceEditorComponent>\n    </div>\n  );\n\n  protected renderMiniMap() {\n    const { alignment, showMinimap, sortBy, style } = this.props;\n    const { msaEditorVewport } = this.state;\n\n    let mmOptions = this.props.minimapOptions\n      ? this.props.minimapOptions\n      : defaultProps.minimapOptions;\n    //const mmClassName = showMinimap ? \"minimap\" : \"minimap hidden\";\n    return (\n      alignment &&\n      style && (\n        <div\n          className=\"minimap\"\n          style={{ display: showMinimap ? \"flex\" : \"none\" }}\n        >\n          <MiniMapComponent\n            //not exposed to instantiator\n            alignment={alignment}\n            alignmentStyle={style}\n            sortBy={sortBy ? sortBy : defaultProps.sortBy}\n            highlightRows={\n              !msaEditorVewport\n                ? undefined\n                : {\n                    rowStart: msaEditorVewport.firstFullyVisibleRow,\n                    rowEnd: msaEditorVewport.lastFullyVisibleRow,\n                  }\n            }\n            //exposed by prop to instantiator\n            alignHorizontal={mmOptions.alignHorizontal}\n            resizable={mmOptions.resizable}\n            startingWidth={mmOptions.startingWidth}\n            verticalHeight={mmOptions.verticalHeight}\n            //not exposed yet to instantiator, but should in the future\n            onClick={this.minimapClicked}\n            onIndicatorDrag={this.minimapRectHighlightMoved}\n          />\n        </div>\n      )\n    );\n  }\n\n  /*\n   *\n   *\n   * REACT FUNCTIONS\n   *\n   *\n   */\n\n  componentDidMount() {\n    window.addEventListener(\"resize\", this.windowDimensionsUpdated);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this.windowDimensionsUpdated);\n  }\n\n  render() {\n    const {\n      alignment,\n      barplots,\n      showAnnotations,\n      showConsensus,\n      showQuery,\n      showRuler,\n    } = this.props;\n    if (!alignment) {\n      return null;\n    }\n\n    const classes = [\"alignment-viewer\"];\n    if (!showAnnotations) {\n      classes.push(\"annotation-closed\");\n    }\n\n    return (\n      <div className={classes.join(\" \")}>\n        {this.renderMiniMap()}\n\n        {/*<div id=\"column_mouseover\"></div>*/}\n\n        {!barplots || barplots.length < 1\n          ? null\n          : barplots.map((barplot, idx) =>\n              this.renderWidget(\n                \"av-barplot-holder\",\n                barplot.dataSeriesSet.map((series) => series.name).join(\" / \"),\n                this.renderBarplot(barplot),\n                true,\n                `${idx}-${barplot.dataSeriesSet\n                  .map((dataseries) => dataseries.id)\n                  .join(\"|\")}`\n              )\n            )}\n\n        {!this.props.showLogo || !this.props.logoOptions\n          ? null\n          : this.renderWidget(\n              \"av-sequence-logo-holder\",\n              \"Logo:\",\n              this.renderSequenceLogo(),\n              true\n            )}\n\n        {!showConsensus\n          ? null\n          : this.renderWidget(\n              \"av-consensus-seq-holder\",\n              \"Consensus:\",\n              this.renderConsensusQueryBox()\n            )}\n\n        {!showQuery\n          ? null\n          : this.renderWidget(\n              \"av-query-seq-holder\",\n              \"Query:\",\n              this.renderQuerySeqBox()\n            )}\n\n        {!showRuler\n          ? null\n          : this.renderWidget(\n              \"av-position-indicator-holder\",\n              \"Position:\",\n              this.renderPositionBox()\n            )}\n\n        {this.renderWidget(\n          \"av-ace-msa-holder\",\n          this.renderAlignmentAnnotationBox(),\n          this.renderAlignmentBox()\n        )}\n      </div>\n    );\n  }\n}\n","import { AceMultipleSequenceAlignmentComponent } from \"./AceMultipleSequenceAlignmentComponent\";\n\nexport class AceQuerySequenceComponent extends AceMultipleSequenceAlignmentComponent {\n  getText() {\n    return this.props.alignment.getQuerySequence().sequence;\n  }\n}\n","import { Alignment } from \"../common/Alignment\";\nimport { AceEditorComponent, IAceEditorProps } from \"./AceEditorComponent\";\n\nexport interface IAceTextualRulerComponentProps extends IAceEditorProps {\n  alignment: Alignment;\n}\n\nexport class AceTextualRulerComponent extends AceEditorComponent<\n  IAceTextualRulerComponentProps,\n  {}\n> {\n  /**\n   * Generate a string axis (positional information) with one character per position\n   * through the maxLength. Taken from alignmentviewer 1.0:\n   *     https://github.com/sanderlab/alignmentviewer\n   * May want to implement this better in the future (SVG + sliding tooltip for cursor?)\n   * @param maxLength\n   */\n  static generateTextualRuler(maxLength: number): string {\n    let s = \"\"; // should be a better way to do this to be honest\n    for (let i = 1; i <= maxLength + 1; i++) {\n      const Q = i % 10 === 0;\n      const Q5 = !Q && i % 5 === 0;\n      s += Q ? \"|\" : Q5 ? \":\" : \".\";\n      if (!Q) {\n        continue;\n      }\n      const sn = \"\" + i;\n      const np = s.length - sn.length - 1; // where num starts\n      if (np < 0) {\n        continue;\n      }\n      s = s.substr(0, np) + sn + \"|\";\n    }\n    return s; // this.hruler = s.replace(/ /g, '.');\n  }\n\n  getText(): string {\n    return AceTextualRulerComponent.generateTextualRuler(\n      this.props.alignment.getMaxSequenceLength()\n    );\n  }\n  getEditorMode() {\n    return undefined;\n  }\n}\n","import { generateUUIDv4 } from \"./Utils\";\nimport { defineNewAlignmentMode } from \"./AceAlignmentMode\";\nimport { Nucleotide } from \"./Residues\";\nimport { SequenceSorter } from \"./AlignmentSorter\";\nimport {\n  AlignmentTypes,\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n} from \"./MolecularStyles\";\n\nexport interface ISequence {\n  id: string;\n  sequence: string;\n}\n\n/**\n * Alignment\n * This class represents a multiple sequence alignment. During initialization,\n * positional statistics are generated about the alignment and a consensus\n * sequence is determined.\n *\n * The class should generally be instantiated from subclasses (e.g., FastaAlignemtn)\n * using static methods, e.g.,\n *     FastaAlignment.fromFileContents\n *     StockholmAlignment.fromFileContents\n */\nexport class Alignment {\n  private uuid: string;\n  private aceEditorMode: string | undefined;\n  private name: string;\n  private predictedNT: boolean;\n  private sequences: Map<SequenceSorter, ISequence[]>;\n  private querySequence: ISequence;\n  private positionalLetterCounts: Map<number, { [letter: string]: number }>;\n  private globalAlphaLetterCounts: { [letter: string]: number };\n  private allUpperAlphaLettersInAlignmentSorted: string[];\n  private consensus: ISequence; /*{\n    sequence: ISequence;\n    statistics: {\n      letter: string;\n      position: number;\n      occurrences: number;\n    }[];\n  };*/\n\n  /**\n   * Normalize all values in an object that contains all counts such that\n   * the sum of those counts equals 1.\n   * @param letterCounts an object that contains the same keys, but whose\n   *                     values now sum to 1.\n   * @param validLetters if provided, returned object will only contain letters\n   *                     that are in this array.\n   */\n  private static normalizeLetterCounts(\n    letterCounts: { [letter: string]: number },\n    validLetters?: string[]\n  ) {\n    const totalCounts = Object.keys(letterCounts).reduce((acc, letter) => {\n      if (!validLetters || validLetters.includes(letter)) {\n        acc += letterCounts[letter];\n      }\n      return acc;\n    }, 0);\n\n    return Object.keys(letterCounts).reduce((acc, letter) => {\n      if (!validLetters || validLetters.includes(letter)) {\n        acc[letter] = letterCounts[letter] / totalCounts;\n      }\n      return acc;\n    }, {} as { [letter: string]: number });\n  }\n\n  /**\n   * Create a new Alignment object. The default query sequence will\n   * be set to the first sequence in sequences. This can be changed\n   * by calling setQuerySequence() after creation\n   * @param sequences\n   */\n  public constructor(name: string, sequencesAsInput: ISequence[]) {\n    this.uuid = generateUUIDv4();\n    this.name = name;\n    this.sequences = new Map<SequenceSorter, ISequence[]>();\n    this.sequences.set(SequenceSorter.INPUT, sequencesAsInput);\n    this.querySequence = sequencesAsInput[0];\n    this.predictedNT = true;\n\n    //\n    //generate statistics\n    //\n    let start = new Date();\n\n    // aggregate stats for each position and globally including\n    // the number of time each amino acid occurs\n    // ** this loop takes the bulk of the initialization time\n\n    let allUniqueCharCodes: { [charCode: string]: boolean } = {};\n    let sequenceLengths: { [length: string]: boolean } = {};\n\n    start = new Date();\n\n    //Parse everything. Work in character code space as this is much faster.\n    //Convert character codes back to letters at the end.\n    sequencesAsInput.forEach((seq) => {\n      const seqStr = seq.sequence;\n      sequenceLengths[seqStr.length] = true;\n\n      //for speed use char codes: https://stackoverflow.com/questions/4434076\n      for (\n        let positionIdx = 0, len = seqStr.length;\n        positionIdx < len;\n        positionIdx++\n      ) {\n        const charCode = seqStr.charCodeAt(positionIdx);\n\n        //note: checking whether key already exists is slower (I tested)\n        //by about 33% (i.e., 300ms vs 200ms on 10X beta lactamase)\n        allUniqueCharCodes[charCode] = true;\n      }\n    });\n\n    //check whether all sequence lenghts were equal\n    if (Object.keys(sequenceLengths).length > 1) {\n      throw Error(\n        \"Alignment sequences must all be the same length, but multiple sequence lengths were observed: \" +\n          Object.keys(sequenceLengths).join(\", \")\n      );\n    }\n\n    //all sequences are the same length\n    const seqLength = parseInt(Object.keys(sequenceLengths)[0]);\n\n    //initialize a character code version of positional letter counts\n    //that each contain all possible charCodes in the alignment, initialized\n    //to a count of zero.\n    const positionalCharCodeCounts = new Map<\n      number,\n      { [charCode: string]: number }\n    >();\n    for (let i = 0; i < seqLength; i++) {\n      positionalCharCodeCounts.set(\n        i,\n        Object.keys(allUniqueCharCodes).reduce((acc, charCode) => {\n          acc[charCode] = 0;\n          return acc;\n        }, {} as { [charCode: string]: number })\n      );\n    }\n\n    //initialize a character code version of global letter counts\n    const globalCharCodeCounts: { [charCode: string]: number } = {};\n    Object.keys(allUniqueCharCodes).forEach((charCode) => {\n      globalCharCodeCounts[charCode] = 0;\n    });\n\n    //empirically fill in character code counts from the sequences\n    sequencesAsInput.forEach((seq) => {\n      const seqStr = seq.sequence;\n      for (\n        let positionIdx = 0, len = seqStr.length;\n        positionIdx < len;\n        positionIdx++\n      ) {\n        const charCode = seqStr.charCodeAt(positionIdx);\n        globalCharCodeCounts[charCode] += 1;\n        positionalCharCodeCounts.get(positionIdx)![charCode] += 1;\n      }\n    });\n\n    //convert the character codes in globalCharCodeCounts to letters\n    this.positionalLetterCounts = Array.from(positionalCharCodeCounts).reduce(\n      (acc, [positionIdx, positionalCharCodeCounts]) => {\n        acc.set(\n          positionIdx,\n          Object.keys(positionalCharCodeCounts).reduce((acc2, charCodeStr) => {\n            if (positionalCharCodeCounts[charCodeStr]) {\n              //get rid of the zero entries\n              const letter = String.fromCharCode(parseInt(charCodeStr));\n              acc2[letter] = positionalCharCodeCounts[charCodeStr];\n            }\n            return acc2;\n          }, {} as { [letter: string]: number })\n        );\n        return acc;\n      },\n      new Map<\n        number,\n        {\n          [letter: string]: number;\n        }\n      >()\n    );\n\n    //convert the character codes in globalCharCodeCounts to letters\n    this.globalAlphaLetterCounts = Object.keys(globalCharCodeCounts).reduce(\n      (arr, charCodeStr) => {\n        if (globalCharCodeCounts[charCodeStr]) {\n          //get rid of the zero entries - unnecessary?!?\n          const letter = String.fromCharCode(parseInt(charCodeStr));\n          arr[letter] = globalCharCodeCounts[charCodeStr];\n        }\n        return arr;\n      },\n      {} as { [letter: string]: number }\n    );\n\n    //predict whether a sequence is nt or aa - if no characters are\n    //outside the Nucleotide codes, then call nt, otherwise aa.\n    this.predictedNT = Object.keys(allUniqueCharCodes).find((charCodeStr) => {\n      const charCode = parseInt(charCodeStr);\n      const isLowerAlpha = charCode > 96 && charCode < 123;\n      const isUpperAlpha = charCode > 64 && charCode < 91;\n      if (isUpperAlpha || isLowerAlpha) {\n        return (\n          Nucleotide.fromSingleLetterCode(String.fromCharCode(charCode)) ===\n          Nucleotide.UNKNOWN\n        );\n      }\n      return false;\n    })\n      ? false\n      : true;\n\n    //extract all the upper letter characters\n    this.allUpperAlphaLettersInAlignmentSorted = Object.keys(\n      allUniqueCharCodes\n    ).reduce((acc, charCodeStr) => {\n      const charCode = parseInt(charCodeStr);\n      if (charCode > 64 && charCode < 91) {\n        acc.push(String.fromCharCode(charCode));\n      }\n      return acc;\n    }, [] as string[]);\n\n    //extract consensus\n    this.consensus = {\n      id: \"consensus\",\n      sequence: Array.from(this.positionalLetterCounts)\n        .map(([positionIdx, letterCounts]) => {\n          //all zero entries removed from this.positionalLetterCounts above\n          return Object.entries(letterCounts)\n            .sort((letterA, letterB) => {\n              //prefer upper case letters then lower case letters\n              const aIsLowerAlpha = letterA[0].match(/[a-z]/) ? true : false;\n              const aIsUpperAlpha = letterA[0].match(/[A-Z]/) ? true : false;\n              const bIsLowerAlpha = letterB[0].match(/[a-z]/) ? true : false;\n              const bIsUpperAlpha = letterB[0].match(/[A-Z]/) ? true : false;\n\n              if (\n                aIsLowerAlpha === bIsLowerAlpha &&\n                aIsUpperAlpha === bIsUpperAlpha\n              ) {\n                //both are the same (upper or lower or neither)\n                return letterB[1] - letterA[1];\n              }\n\n              //different case and one has a value\n              return aIsUpperAlpha\n                ? -1\n                : bIsUpperAlpha\n                ? 1\n                : aIsLowerAlpha\n                ? -1\n                : bIsLowerAlpha\n                ? 1\n                : 0;\n            })\n            .map((letter) => letter[0])[0];\n        })\n        .join(\"\"),\n    };\n\n    console.log(\n      \"done parsing alignment. took \" +\n        (new Date().getTime() - start.getTime()) +\n        \"ms\"\n    );\n  }\n\n  /**\n   * Is this alignment predicted to be nucleotides?\n   * @returns true if it is predicted to be nucleotide sequences.\n   */\n  getPredictedType(): AlignmentTypes {\n    return this.predictedNT\n      ? AlignmentTypes.NUCLEOTIDE\n      : AlignmentTypes.AMINOACID;\n  }\n\n  /**\n   * Returns a default nucleotide or amino acid style for this alignment,\n   * predicted from the sequence itself.\n   */\n  getDefaultStyle(): AminoAcidAlignmentStyle | NucleotideAlignmentStyle {\n    return this.predictedNT\n      ? new NucleotideAlignmentStyle()\n      : new AminoAcidAlignmentStyle();\n  }\n\n  /**\n   * Get a unique uuid for this alignment.\n   * @returns a uuid string for this alignment\n   */\n  getUUID() {\n    return this.uuid;\n  }\n\n  /**\n   * Get the name of this alignment\n   * @returns a name for the alignment - usually the filename\n   */\n  getName() {\n    return this.name;\n  }\n\n  /**\n   * Get an ace editor mode for this alignemnt. If one doesn't exist\n   * then it will be defined.\n   * @returns the ace editor mode for this alignment\n   */\n  getAceEditorMode() {\n    if (!this.aceEditorMode) {\n      this.aceEditorMode = \"ace/mode/\" + this.uuid;\n      defineNewAlignmentMode(this.aceEditorMode, this);\n    }\n    return this.aceEditorMode;\n  }\n\n  /**\n   * Get the consensus sequence\n   * @returns a position ordered array of objects that contain each letter, its number of\n   *          occurrences, and the actual position number\n   */\n  getConsensus() {\n    return this.consensus;\n  }\n\n  /**\n   * Get the number of gaps at each position\n   * @returns an array of gap counts, ordered by position\n   */\n  getGapsPerColumn(): number[] {\n    return Array.from(this.positionalLetterCounts).map(\n      ([position, letterCounts]) => {\n        return !isNaN(letterCounts[\"-\"]) ? letterCounts[\"-\"] : 0;\n      }\n    );\n  }\n\n  /**\n   * Get the number of gaps at a specific position\n   * @returns the gap counts at the specified position\n   */\n  getGapCountAtColumn(position: number): number {\n    const letterCounts = this.positionalLetterCounts.get(position);\n    if (!letterCounts || !letterCounts[\"-\"]) {\n      return 0;\n    }\n    return letterCounts[\"-\"];\n  }\n\n  /**\n   * Get the total number of times each letter appears in the alignment.\n   * @param normalize if true, will normalize the returned array such that\n   *                  it sums to 1.\n   * @param validLetters if provided, only those letters will be included\n   *                     in the resulting counts\n   */\n  getGlobalAlphaLetterCounts(normalize?: boolean, validLetters?: string[]) {\n    if (normalize) {\n      return Alignment.normalizeLetterCounts(\n        this.globalAlphaLetterCounts,\n        validLetters\n      );\n    }\n    return !validLetters\n      ? this.globalAlphaLetterCounts\n      : Object.keys(this.globalAlphaLetterCounts).reduce((acc, letter) => {\n          //don't normalize, but remove invalid letters\n          if (validLetters.includes(letter)) {\n            acc[letter] = this.globalAlphaLetterCounts[letter];\n          }\n          return acc;\n        }, {} as { [letter: string]: number });\n  }\n\n  /**\n   * Get the length of the longest sequence\n   * @returns the length of the largest sequence in this alignment\n   */\n  getMaxSequenceLength(): number {\n    return this.getSequences().reduce((acc, seq) => {\n      if (seq.sequence.length > acc) {\n        acc = seq.sequence.length;\n      }\n      return acc;\n    }, -1);\n  }\n\n  /**\n   * Get the frequencies of all letters in this alignment for each position.\n   * @param normalize if true, will normalize the returned letter counts for each\n   *                  position such that each sums to 1.\n   * @param validLetters if provided, only those letters will be included\n   *                     in the resulting counts\n   * @returns a Map whose keys are position (ordered) and values are a dictionary\n   *          with [key = letter (e.g., amino acid code)] and [value = # occurrences].\n   * TODO: Test parameter use cases.\n   */\n  getPositionalLetterCounts(normalize?: boolean, validLetters?: string[]) {\n    if (normalize || validLetters) {\n      return Array.from(this.positionalLetterCounts).reduce(\n        (acc, [position, letterCounts]) => {\n          acc.set(\n            position,\n            normalize\n              ? Alignment.normalizeLetterCounts(letterCounts, validLetters) // normalize + remove invalid letters\n              : Object.keys(letterCounts).reduce((acc2, letter) => {\n                  //don't normalize, but remove invalid letters\n                  if (validLetters!.includes(letter)) {\n                    acc2[letter] = letterCounts[letter];\n                  }\n                  return acc2;\n                }, {} as { [letter: string]: number })\n          );\n          return acc;\n        },\n        new Map<Number, { [letter: string]: number }>()\n      );\n    }\n    return this.positionalLetterCounts;\n  }\n\n  /**\n   * Get all the sequences in this alignment - ordered as they were input\n   * @param sortBy specifies the order of the returned sequences. If it isn't\n   *               provided, returns the sequences as they were input to create\n   *               the Alignment object, e.g., usually fasta order.\n   * @param forceReSort if provided, sequences are forced to be re-sorted (rather\n   *                    than possibly cached)\n   * @returns all sequences in this alignment\n   */\n  getSequences(sortBy?: SequenceSorter, forceReSort?: boolean): ISequence[] {\n    sortBy = sortBy ? sortBy : SequenceSorter.INPUT;\n    forceReSort = forceReSort ? forceReSort : false;\n    if (\n      sortBy !== SequenceSorter.INPUT &&\n      (!this.sequences.has(sortBy) || forceReSort)\n    ) {\n      //cache not yet populated for this sort option\n      this.sequences.set(\n        sortBy,\n        sortBy.sortFn(this.sequences.get(SequenceSorter.INPUT)!, this)\n      );\n    }\n    return this.sequences.get(sortBy)!;\n  }\n\n  /**\n   * Get a sorted list of all of the upper case letters in the alignment.\n   * @returns a list of all letters in the alignment sorted alphabetically.\n   */\n  getAllUpperAlphaLettersInAlignmentSorted(): string[] {\n    return this.allUpperAlphaLettersInAlignmentSorted;\n  }\n\n  /**\n   * Get all the first sequence in the alignment, aka, target / query / first\n   * @returns all sequences in this alignment\n   */\n  getQuerySequence(): ISequence {\n    return this.querySequence;\n  }\n\n  /**\n   * Set the query sequence\n   * @param newQuery The new query sequence. Must already exist in the alignment.\n   * @throws an error if the query sequence does not yet exist in the alignment\n   *\n   * IMPORTANT: Requires re-sorting\n   */\n  /*setQuerySequence(newQuery: ISequence) {\n    const queryInAlignment = this.getSequences().find((seq) => {\n      if (seq === newQuery) {\n        return true;\n      }\n      return false;\n    });\n    if (queryInAlignment !== undefined) {\n      this.querySequence = newQuery;\n\n      //the resort could be really slow ... need to rethink.\n      SequenceSorter.list.forEach((sortOption) => {\n        //updated cached sorted sequences\n        if (sortOption.isQuerySequenceDependent) {\n          this.getSequences(sortOption, true);\n        }\n      });\n      this.sequences.forEach(\n        (sequences: ISequence[], sortBy: SequenceSorter) => {\n          this.getSequences(sortBy, true); // force re-sorting, which updates cache\n        }\n      );\n    } else {\n      throw Error(\"query sequence does not exist in alignment\");\n    }\n  }*/\n}\n","/**\n * AceAlignmentMode.js\n * This file defines an alignment highlight mode form ace editor documents.\n */\n\nimport { default as ace } from \"ace-builds\";\nimport { Alignment } from \"./Alignment\";\nimport { getLetterClassNames } from \"./MolecularStyles\";\n\ninterface IAceType {\n  [key: string]: any;\n}\n\nexport function defineNewAlignmentMode(mode: string, alignment: Alignment) {\n  const modeSplit = mode.split(\"/\");\n  if (\n    modeSplit.length !== 3 ||\n    modeSplit[0] !== \"ace\" ||\n    modeSplit[1] !== \"mode\"\n  ) {\n    throw Error(\"ace mode name must be of the form '/ace/mode/MODENAME'\");\n  }\n  const modeName = mode.split(\"/\")[2];\n\n  (ace as IAceType).define(\n    \"ace/mode/\" + modeName + \"_highlight_rules\",\n    function (require: Function, exports: any, module: any) {\n      var oop = require(\"../lib/oop\");\n      var TextHighlightRules = require(\"./text_highlight_rules\")\n        .TextHighlightRules;\n\n      /**\n       * Rules parse individual characters in the editor and assign classes\n       * to each character. Note that characters will be grouped together\n       * if they match the same rule and are side by side.\n       */\n      var AlignmentHighlightRules = function (this: any) {\n        //We define an alignment-specific set of rules that will\n        //add classes including whether a character matches the\n        //consensus sequence, matches the query etc.\n        let rules: {\n          [key: string]: {\n            token: (letter: string) => void;\n            regex: RegExp;\n            next: string;\n          }[];\n        } = {};\n\n        //note: this is by far the thing that kills performance the most\n        //      I'm not sure whether it is due to how it parses (state machine)\n        //      slowing things down, or whether it is an issue with attaching\n        //      ~4 classes to every single residue -- either way, removing parsing\n        //      all together makes it much more snappy and also decreases the\n        //      memory footprint drastically.\n        const re = /./;\n        const statePrefix = \"p\";\n        for (let i = 0; i < alignment.getMaxSequenceLength(); i++) {\n          const stateName = i === 0 ? \"start\" : statePrefix + i;\n          const nextStateName =\n            i === alignment.getMaxSequenceLength() - 1\n              ? \"start\"\n              : statePrefix + (i + 1);\n\n          rules[stateName] = [\n            {\n              token: function (letter: string) {\n                const toreturn = getLetterClassNames(\n                  letter,\n                  letter === alignment.getConsensus().sequence[i],\n                  letter === alignment.getQuerySequence().sequence[i],\n                  true\n                );\n                return toreturn;\n              },\n              regex: re,\n              next: nextStateName,\n            },\n          ];\n        }\n        this.$rules = rules;\n      };\n\n      oop.inherits(AlignmentHighlightRules, TextHighlightRules);\n\n      exports.AlignmentHighlightRules = AlignmentHighlightRules;\n    }\n  );\n\n  (ace as IAceType).define(\"ace/mode/\" + modeName, function (\n    require: Function,\n    exports: any,\n    module: any\n  ) {\n    var oop = require(\"../lib/oop\");\n    var TextMode = require(\"../mode/text\").Mode;\n    var Tokenizer = require(\"../tokenizer\").Tokenizer;\n    var AlignmentHighlightRules = require(\"ace/mode/\" +\n      modeName +\n      \"_highlight_rules\").AlignmentHighlightRules;\n\n    const Mode = function (this: any) {\n      this.$tokenizer = new Tokenizer(new AlignmentHighlightRules().getRules());\n    };\n\n    oop.inherits(Mode, TextMode);\n\n    (function () {\n      // Extra logic goes here. (see below)\n    }.call(Mode.prototype));\n\n    exports.Mode = Mode;\n  });\n}\n","import { Alignment, ISequence } from \"./Alignment\";\nimport { getParseError } from \"./Utils\";\n\n/**\n * FastaAlignment\n * This class represents a Fasta formatted multiple sequence alignment.\n */\nexport class FastaAlignment extends Alignment {\n  /**\n   * Parse a string that contains a fasta alignment.\n   * @param fileName\n   * @param fileContents\n   */\n  static fromFileContents(\n    fileName: string,\n    fileContents: string\n  ): FastaAlignment {\n    const trimmedFile = fileContents.trim();\n    if (trimmedFile.length < 1 || trimmedFile[0] !== \">\") {\n      throw getParseError(\"Fasta\", \"File needs to begin with '>'\");\n    }\n\n    const fastaSplitCaret = trimmedFile.split(\">\");\n    var sequences: ISequence[] = [];\n    for (var i = 0; i < fastaSplitCaret.length; i++) {\n      const seqArr = fastaSplitCaret[i].split(/\\r?\\n/);\n      if (seqArr.length > 1) {\n        var seqObj = {\n          id: seqArr[0],\n          sequence: seqArr.slice(1).join(\"\"),\n        };\n        sequences.push(seqObj);\n      }\n    }\n    try {\n      return new FastaAlignment(fileName, sequences);\n    } catch (e) {\n      throw getParseError(\"Fasta\", e.message);\n    }\n  }\n}\n","import { Alignment, ISequence } from \"./Alignment\";\nimport { getParseError } from \"./Utils\";\n\nexport interface IStockholmAlignmentMetadata {\n  //GF: Data relating to the multiple sequence alignment as a whole, such as authors or\n  //    number of sequences in the alignment. Duplicate feature names allowed (values added\n  //    to string array)\n  //\n  //  e.g., #=GF DE CBS domain\n  //        Where ``DE`` is the feature name and ``CBS Domain`` is the feature data\n  //\n  GF: { [featureName: string]: string }; //#=GF DE CBS domain - featureName=\"DE\", data=[\"CBS domain\"]\n\n  //GS: Data relating to a specific sequence in the multiple sequence alignment. Duplicate\n  //    sequence-feature pairs are allowed\n  //\n  //  e.g., #=GS O83071/259-312 AC O83071\n  //        Where \"O83071/259-312\" is the sequence name, \"AC\" is the feature name, and\n  //        \"083071\" is the feature data.\n  GS: { [sequenceId: string]: { [featureName: string]: string[] } };\n\n  // GR: Data relating to the columns of a specific sequence in a multiple sequence alignment.\n  //     Duplicate sequence-features pairs are not allowed.\n  //     Can also be thought of as positional metadata (i.e., like that sequences secondary\n  //     structure positional annotation)\n  //\n  //  e.g., #=GR O31698/18-71 SS    CCCHHHHHHHHHHHHHHH..EEEEEEEE....EEEEEEEEHHH\n  //        Where \"031698/18-71\" is the sequence name,  \"SS\" is the feature name, and\n  //        \"CCCHHHHHHHHHHHHHHH..EEEEEEEE....EEEEEEEEHHH\" is the feature data.\n  GR: { [sequenceId: string]: { [featureName: string]: string } };\n\n  // GC: Data relating to the multiple sequence alignment as a whole.\n  //     Duplicate sequence-features pairs are not allowed.\n  //\n  //  e.g., #=GC SS_cons            CCCCCHHHHHHHHHHHHH..EEEEEEEE....EEEEEEEEEEH\n  //        Where \"SS_cons\" is the feature name and\n  //        \"CCCCCHHHHHHHHHHHHH..EEEEEEEE....EEEEEEEEEEH\" is the feature data\n  GC: { [key: string]: string }; //column info for entire alignment\n}\n\n/**\n * StockholmAlignment\n * This class represents a Stockholm formatted multiple sequence alignment.\n *\n * Parser inspired by:\n *   https://github.com/biocore/scikit-bio/blob/master/skbio/io/format/stockholm.py\n *\n * The class should be instantiated using the static methods:\n *     fromFileContents: accepts a stockholm file-like string\n */\nexport class StockholmAlignment extends Alignment {\n  private metadata: IStockholmAlignmentMetadata;\n\n  public constructor(\n    name: string,\n    sequencesAsInput: ISequence[],\n    metadata: IStockholmAlignmentMetadata\n  ) {\n    super(name, sequencesAsInput);\n    this.metadata = metadata;\n  }\n\n  /**\n   * Parse a string that contains a stockholm alignment.\n   * @param fileName\n   * @param fileContents\n   * @throws an Error if the fileContents don't contain the expected\n   *         header and footer.\n   */\n  static fromFileContents(\n    fileName: string,\n    fileContents: string\n  ): StockholmAlignment {\n    const trimmedAndSplit = fileContents.trim().split(/\\r?\\n/);\n\n    // Raise an error if the header and footer don't indicate\n    // that the file string is of stockholm format:\n    //   header must start with \"# STOCKHOLM 1.0\"\n    //   footer must be \"//\"\n    if (trimmedAndSplit.length < 3) {\n      throw getParseError(\"Stockholm\", \"The file length is less than 3 rows\");\n    }\n    if (trimmedAndSplit[0].startsWith(\"# STOCKHOLM 1.0\") === false) {\n      throw getParseError(\n        \"Stockholm\",\n        \"The first line must be '# STOCKHOLM 1.0'\"\n      );\n    }\n    if (trimmedAndSplit[trimmedAndSplit.length - 1] !== \"//\") {\n      throw getParseError(\"Stockholm\", \"The last line must be '//'\");\n    }\n\n    const metadata: IStockholmAlignmentMetadata = {\n      GF: {},\n      GS: {},\n      GR: {},\n      GC: {},\n    };\n    const sequences: ISequence[] = [];\n    trimmedAndSplit\n      .slice(1, trimmedAndSplit.length - 1)\n      .forEach((line, idx) => {\n        line = line.trim();\n        if (!line.startsWith(\"#\")) {\n          //sequence line\n          const split = line.match(/^(\\S+)\\s(.*)/)!.slice(1);\n          sequences.push({ id: split[0].trim(), sequence: split[1].trim() });\n        } else {\n          //metadata line\n          if (\n            line.length < 8 ||\n            [\"GF\", \"GS\", \"GR\", \"GC\"].includes(line.substr(2, 2)) === false\n          ) {\n            console.warn(\n              \"Unexpected metadata line in Stockholm alignment: \" + line\n            );\n          } else {\n            const metadataGroup = line.substr(2, 2);\n\n            //match/slice splits on first whitespace. Taken from:\n            //       https://stackoverflow.com/questions/10272773\n            //Used multiple times and should reassess if it is the fastest. note\n            //that safari had problems with str.split(/(?<=^\\S+)\\s/)\n            const keyVal = line\n              .substr(5)\n              .trim()\n              .match(/^(\\S+)\\s(.*)/)!\n              .slice(1);\n            keyVal[1] = keyVal[1].trim();\n\n            if (metadataGroup === \"GF\") {\n              if (keyVal[0] in metadata.GF === false) {\n                metadata.GF[keyVal[0]] = keyVal[1];\n              } else {\n                metadata.GF[keyVal[0]] += \" \" + keyVal[1];\n              }\n            } else if (metadataGroup === \"GS\") {\n              const seqId = keyVal[0];\n              const featureVal = keyVal[1]\n                .trim()\n                .match(/^(\\S+)\\s(.*)/)!\n                .slice(1);\n              if (seqId in metadata.GS === false) {\n                metadata.GS[seqId] = {};\n              }\n              if (featureVal[0] in metadata.GS[seqId] === false) {\n                metadata.GS[seqId][featureVal[0]] = [];\n              }\n              metadata.GS[seqId][featureVal[0]].push(featureVal[1]);\n            } else if (metadataGroup === \"GR\") {\n              const seqId = keyVal[0];\n              const featureVal = keyVal[1]\n                .trim()\n                .match(/^(\\S+)\\s(.*)/)!\n                .slice(1);\n              if (seqId in metadata.GR === false) {\n                metadata.GR[seqId] = {};\n              }\n              metadata.GR[seqId][featureVal[0]] = featureVal[1];\n            } else if (metadataGroup === \"GC\") {\n              metadata.GC[keyVal[0]] = keyVal[1];\n            }\n          }\n        }\n      });\n\n    try {\n      return new StockholmAlignment(fileName, sequences, metadata);\n    } catch (e) {\n      throw getParseError(\"Stockholm\", e.message);\n    }\n  }\n\n  getMetadata() {\n    return this.metadata;\n  }\n}\n","/**\n * A helper class for loading alignments.\n */\nimport { Alignment } from \"../common/Alignment\";\nimport { FastaAlignment } from \"../common/FastaAlignment\";\nimport { StockholmAlignment } from \"../common/StockholmAlignment\";\n\nexport class AlignmentLoadError extends Error {\n  errors: { name: string; message: string }[];\n  possibleResolution?: string;\n  constructor(\n    message: string,\n    errors: { name: string; message: string }[],\n    possibleResolution?: string\n  ) {\n    super(message);\n    this.errors = errors;\n    this.possibleResolution = possibleResolution;\n  }\n}\n\nexport class AlignmentLoader {\n  /**\n   * List of all possible alignments. The order is respected when attempting\n   * to parse an alignment from text / url / file.\n   */\n  public static AlignmentFileTypes = [StockholmAlignment, FastaAlignment];\n\n  /**\n   * Load an alignment from a URL.\n   * @param url\n   * @param callback will be called on successful loading of alignment\n   * @param errorCallback will be called if the url fails to load or the\n   *                      contents are unable to be parsed.\n   * @param alignmentName explicitly set the alignment name - otherwise will\n   *                      be guessed from the url.\n   */\n  public static async loadAlignmentFromURL(\n    url: string,\n    callback: (a: Alignment) => void,\n    errorCallback: (e: AlignmentLoadError) => void,\n    alignmentName?: string\n  ) {\n    let f;\n    try {\n      f = new File(\n        [await (await fetch(`${url}`)).blob()],\n        alignmentName ? alignmentName : url.substring(url.lastIndexOf(\"/\") + 1)\n      );\n    } catch (e) {\n      console.error(\"Unable to load alignment by URL '\" + url + \"'\", e);\n      const err = new AlignmentLoadError(\n        \"Unable to fetch alignment in URL\",\n        [{ name: \"Browser-reported error message\", message: e.message }],\n        \"Possible causes: (1) The alignment is not sent using SSL or (2) the server that hosts \" +\n          \"the alignment has not enabled CORS. To be assessible to Alignment Viewer 2, the \" +\n          \"alignment must be served by HTTPS and the server must enable CORS.\"\n      );\n      errorCallback(err);\n      return;\n    }\n\n    try {\n      AlignmentLoader.loadAlignmentFromFile(f, callback, errorCallback);\n    } catch (e) {\n      errorCallback(e);\n    }\n  }\n\n  /**\n   * Load an alignment from a File.\n   * @param file\n   * @param callback will be called on successful loading of alignment\n   * @param errorCallback will be called if the url fails to load or the\n   *                      contents are unable to be parsed.\n   */\n  public static async loadAlignmentFromFile(\n    file: File,\n    callback: (a: Alignment) => void,\n    errorCallback: (e: AlignmentLoadError) => void\n  ) {\n    var reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        callback(\n          AlignmentLoader.loadAlignmentFromText(\n            file.name,\n            reader.result as string\n          )\n        );\n      } catch (e) {\n        errorCallback(e);\n      }\n    };\n    reader.readAsText(file);\n  }\n\n  /**\n   * Parse an alignment from text\n   * @param alignmentName\n   * @param text\n   * @throws an AlignmentLoadError if the text cannot be parsed.\n   */\n  public static loadAlignmentFromText(alignmentName: string, text: string) {\n    const err = new AlignmentLoadError(\"Alignment Format Error\", []);\n    for (let i = 0; i < AlignmentLoader.AlignmentFileTypes.length; i++) {\n      try {\n        const toreturn = AlignmentLoader.AlignmentFileTypes[i].fromFileContents(\n          alignmentName,\n          text\n        );\n        return toreturn;\n      } catch (e) {\n        err.errors.push(e);\n      }\n    }\n    throw err;\n  }\n}\n","import * as React from \"react\";\nimport \"./FileInput.scss\";\nimport { Alignment } from \"../common/Alignment\";\nimport { AlignmentLoader, AlignmentLoadError } from \"../common/AlignmentLoader\";\n\nexport interface IExampleFileProps {\n  labelText: string;\n  fileURL: string;\n  fileName: string;\n}\n\nexport interface IAlignmentLoaderProps {\n  fileSelectorLabelText: string;\n\n  onAlignmentLoaded: (alignment: Alignment) => void; //loading ended\n  onAlignmenLoadError: (e: AlignmentLoadError) => void; //loading error\n\n  exampleFiles?: IExampleFileProps[];\n  onFileLoadStart?: () => void; //notify on begin loading\n}\n\n// Inspired by https://reactjs.org/docs/uncontrolled-components.html\nexport class AlignmentFileLoaderComponent extends React.Component<\n  IAlignmentLoaderProps\n> {\n  public static defaultProps = {\n    fileSelectorLabelText: \"Upload:\",\n  };\n\n  protected fileInput: React.RefObject<HTMLInputElement>;\n  constructor(props: IAlignmentLoaderProps) {\n    super(props);\n    this.handleFileUploadInputChange = this.handleFileUploadInputChange.bind(\n      this\n    );\n    this.handleClick = this.handleClick.bind(this);\n    this.alignmentLoaded = this.alignmentLoaded.bind(this);\n    this.handleFileUploadInputChange = this.handleFileUploadInputChange.bind(\n      this\n    );\n    this.fileInput = React.createRef();\n  }\n\n  /*\n   *\n   *\n   * PRIVATE METHODS\n   *\n   *\n   */\n\n  /**\n   * Pass the visible button click through to the file input\n   * @param event\n   */\n  private handleClick(event: React.MouseEvent<HTMLButtonElement, MouseEvent>) {\n    event.preventDefault();\n    this.fileInput.current?.click();\n  }\n\n  /**\n   *\n   * @param alignment\n   */\n  private alignmentLoaded(alignment: Alignment) {\n    this.props.onAlignmentLoaded(alignment);\n    if (this.fileInput.current) {\n      this.fileInput.current.value = \"\"; //reset the input box\n    }\n  }\n\n  /**\n   *\n   * @param event\n   */\n  private handleFileUploadInputChange(\n    event: React.FormEvent<HTMLInputElement>\n  ) {\n    const { onFileLoadStart, onAlignmenLoadError } = this.props;\n    event.preventDefault();\n\n    if (this.fileInput.current && this.fileInput.current.files) {\n      if (onFileLoadStart) {\n        onFileLoadStart();\n      }\n      setTimeout(() => {\n        //safari needs this in a timeout, otherwise it runs synchronously?!?\n        const file = this.fileInput.current!.files![0];\n        AlignmentLoader.loadAlignmentFromFile(\n          file,\n          this.alignmentLoaded,\n          onAlignmenLoadError\n        );\n      });\n    }\n  }\n\n  /**\n   * Render the file upload button and hidden input box\n   */\n  private renderFileUpload() {\n    const { fileSelectorLabelText } = this.props;\n    return (\n      <label>\n        <strong>{fileSelectorLabelText}</strong>\n        <input\n          type=\"file\"\n          className=\"hidden-file-input\"\n          ref={this.fileInput}\n          onChange={this.handleFileUploadInputChange}\n        />\n        <button type=\"button\" onClick={this.handleClick}>\n          Choose File\n        </button>\n      </label>\n    );\n  }\n\n  /**\n   * render example fileset\n   */\n  private renderExampleFiles() {\n    const { exampleFiles, onFileLoadStart, onAlignmenLoadError } = this.props;\n    return !exampleFiles ? null : (\n      <label>\n        <strong>Example Alignments:</strong>\n        {exampleFiles.map((ef) => {\n          return (\n            <button\n              type=\"button\"\n              className=\"button-link\"\n              key={ef.fileURL}\n              onClick={async (e) => {\n                if (onFileLoadStart) {\n                  onFileLoadStart();\n                }\n                AlignmentLoader.loadAlignmentFromURL(\n                  ef.fileURL,\n                  this.alignmentLoaded,\n                  onAlignmenLoadError,\n                  ef.fileName\n                );\n              }}\n            >\n              {ef.labelText}\n            </button>\n          );\n        })}\n      </label>\n    );\n  }\n\n  /*\n   *\n   *\n   * REACT METHODS\n   *\n   *\n   */\n  render() {\n    return (\n      <div className=\"alignment-file-loader\">\n        <div className=\"file-upload-input\">{this.renderFileUpload()}</div>\n        <div className=\"example-files\">{this.renderExampleFiles()}</div>\n      </div>\n    );\n  }\n}\n","import React from \"react\";\nimport \"./App.scss\";\nimport { Alignment } from \"./common/Alignment\";\nimport { SequenceSorter } from \"./common/AlignmentSorter\";\nimport { getURLParameters } from \"./common/Utils\";\nimport { AlignmentViewer } from \"./components/AlignmentViewerComponent\";\nimport {\n  AminoAcidAlignmentStyle,\n  NucleotideAlignmentStyle,\n  AlignmentStyle,\n  AlignmentTypes,\n  PositionsToStyle,\n  IColorScheme,\n  ResidueStyle,\n} from \"./common/MolecularStyles\";\nimport { LOGO_TYPES } from \"./components/SequenceLogoComponent\";\nimport { AlignmentFileLoaderComponent } from \"./components/AlignmentFileLoaderComponent\";\nimport { SequenceBarplotComponent } from \"./components/SequenceBarplotComponent\";\nimport { AlignmentLoader, AlignmentLoadError } from \"./common/AlignmentLoader\";\n\ninterface AppProps {}\ninterface AppState {\n  alignment?: Alignment;\n  style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle;\n  sortBy: SequenceSorter;\n  logoPlotStyle: LOGO_TYPES;\n  zoomLevel: number;\n  showMiniMap: boolean;\n  showConservationBarplot: boolean;\n  showEntropyGapBarplot: boolean;\n  showKLDivergenceBarplot: boolean;\n  showAnnotations: boolean;\n  showSettings: boolean;\n  loading?: boolean;\n  loadError?: AlignmentLoadError;\n}\n\nconst URL_PARAM_NAMES = {\n  ALIGNMENT_URL: \"alignment-url\",\n};\n\nexport default class App extends React.Component<AppProps, AppState> {\n  constructor(props: AppProps) {\n    super(props);\n    this.state = {\n      style: new AminoAcidAlignmentStyle(),\n      logoPlotStyle: LOGO_TYPES.LETTERS, //TODO - decide NT or AA based on alignment\n      zoomLevel: 14,\n      sortBy: SequenceSorter.INPUT,\n      showMiniMap: true,\n      showConservationBarplot: true,\n      showEntropyGapBarplot: true,\n      showKLDivergenceBarplot: false,\n      showAnnotations: true,\n      showSettings: true,\n    };\n    this.onAlignmentReceived = this.onAlignmentReceived.bind(this);\n    this.onAlignmentLoadError = this.onAlignmentLoadError.bind(this);\n  }\n\n  componentDidMount() {\n    //is there an alignment in the URL?\n    const params = getURLParameters();\n    if (params.has(URL_PARAM_NAMES.ALIGNMENT_URL)) {\n      this.setState({\n        loading: true,\n      });\n\n      AlignmentLoader.loadAlignmentFromURL(\n        params.get(URL_PARAM_NAMES.ALIGNMENT_URL),\n        this.onAlignmentReceived,\n        this.onAlignmentLoadError\n      );\n    }\n  }\n\n  render() {\n    const {\n      alignment,\n      logoPlotStyle,\n      showAnnotations,\n      showConservationBarplot,\n      showEntropyGapBarplot,\n      showKLDivergenceBarplot,\n      showMiniMap,\n      sortBy,\n      style,\n      zoomLevel,\n    } = this.state;\n\n    const barplots = [];\n    if (showConservationBarplot) {\n      barplots.push({\n        dataSeriesSet: [SequenceBarplotComponent.CONSERVATION_BARPLOT],\n        height: \"75px\",\n      });\n    }\n    if (showEntropyGapBarplot) {\n      barplots.push({\n        dataSeriesSet: [\n          SequenceBarplotComponent.SHANNON_ENTROPY_BARPLOT,\n          SequenceBarplotComponent.GAPS_BARPLOT,\n        ],\n        height: \"75px\",\n      });\n    }\n    if (showKLDivergenceBarplot) {\n      barplots.push({\n        dataSeriesSet: [\n          SequenceBarplotComponent.KULLBAC_LEIBLER_DIVERGENCE_BARPLOT,\n        ],\n        height: \"75px\",\n      });\n    }\n\n    const alignmentElement = !alignment ? (\n      <></>\n    ) : (\n      <div className=\"app-content\">\n        <AlignmentViewer\n          alignment={alignment}\n          style={style}\n          zoomLevel={zoomLevel}\n          sortBy={sortBy}\n          showMinimap={showMiniMap}\n          showAnnotations={showAnnotations}\n          logoOptions={{\n            logoType: logoPlotStyle,\n            height: \"80px\",\n          }}\n          minimapOptions={{\n            startingWidth: 120,\n            verticalHeight: \"div\",\n            alignHorizontal: \"right\",\n            resizable: \"horizontal\",\n          }}\n          barplots={barplots}\n        ></AlignmentViewer>\n      </div>\n    );\n\n    return (\n      <>\n        {this.renderSettingsBox(style)}\n        {alignmentElement}\n      </>\n    );\n  }\n\n  protected renderSettingsBox = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    const { alignment, loading, loadError, showSettings } = this.state;\n    const alignmentDescription = alignment ? (\n      <div>\n        <h3>{alignment.getName()}</h3>\n        <h4>{`${\n          alignment.getSequences().length\n        } sequences (rows) and ${alignment.getMaxSequenceLength()} positions (columns) `}</h4>\n      </div>\n    ) : (\n      <></>\n    );\n\n    return (\n      <div className=\"app-header\">\n        <div className=\"settings-box\">\n          <form>\n            <div className=\"settings-header\">\n              <h2>{`AlignmentViewer 2.0`}</h2>\n              <a\n                className=\"github-link\"\n                href=\"https://github.com/sanderlab/AlignmentViewer2.0\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n              >\n                <img\n                  alt=\"Alignment Viewer 2.0 GitHub Repo\"\n                  width=\"16\"\n                  height=\"16\"\n                  src={`${process.env.PUBLIC_URL}/GitHub-Mark-32px.png`}\n                />\n              </a>\n\n              <button\n                className={`button-link${showSettings ? \" hide\" : \"\"}`}\n                type=\"button\"\n                style={{ padding: 0, margin: 0, border: \"none\" }}\n                onClick={(e) => {\n                  this.setState({\n                    showSettings: true,\n                  });\n                }}\n              >\n                <img\n                  alt=\"Show Settings Box\"\n                  width=\"16\"\n                  height=\"16\"\n                  src={`${process.env.PUBLIC_URL}/settings_32px.png`}\n                />\n              </button>\n              <button\n                className={`button-link${showSettings ? \"\" : \" hide\"}`}\n                type=\"button\"\n                style={{ padding: 0, margin: 0, border: \"none\" }}\n                onClick={(e) => {\n                  this.setState({\n                    showSettings: false,\n                  });\n                }}\n              >\n                <img\n                  alt=\"Hide Settings Box\"\n                  width=\"16px\"\n                  height=\"16px\"\n                  src={`${process.env.PUBLIC_URL}/hide_contract_icon_32px.png`}\n                />\n              </button>\n            </div>\n\n            <div className=\"settings-alignment-description\">\n              {alignmentDescription}\n            </div>\n            <div\n              className=\"settings-parameters\"\n              style={{\n                display: showSettings ? \"block\" : \"none\",\n              }}\n            >\n              {this.renderAlignmentTypeLabel(style)}\n              {this.renderSortControl()}\n              {this.renderColorScheme(style)}\n              {this.renderResidueDetail(style)}\n              {this.renderPositionStyling(style)}\n              {this.renderSequenceLogo()}\n              {this.renderZoomButtons()}\n              {this.renderMiniMapToggle()}\n              {this.renderConservationBarplotToggle()}\n              {this.renderEntropyGapBarplotToggle()}\n              {this.renderKLDivergenceBarplot()}\n              {this.renderAnnotationToggle()}\n              <br></br>\n              {this.renderFileUpload()}\n              {!loading ? null : <div className=\"loader\" />}\n              {!loadError ? null : (\n                <div className={`load-error`}>\n                  <h3>\n                    <strong>{loadError.message}</strong>\n                  </h3>\n                  <ul>\n                    {loadError.errors.map((e) => {\n                      return (\n                        <li key={e.name}>\n                          <strong>{e.name}:</strong> {e.message}\n                        </li>\n                      );\n                    })}\n                  </ul>\n                  {!loadError.possibleResolution ? null : (\n                    <div>{loadError.possibleResolution}</div>\n                  )}\n                </div>\n              )}\n            </div>\n          </form>\n        </div>\n      </div>\n    );\n  };\n\n  protected renderSortControl = () => {\n    const { sortBy, style } = this.state;\n    const sorters =\n      style instanceof AminoAcidAlignmentStyle\n        ? SequenceSorter.aminoAcidSorters\n        : SequenceSorter.nucleotideSorters;\n\n    return (\n      <div>\n        <label>\n          <strong>Sort order:</strong>\n          <select\n            value={sortBy.key}\n            onChange={(e) =>\n              this.setState({\n                sortBy: SequenceSorter.fromKey(e.target.value)!,\n              })\n            }\n          >\n            {sorters.map((sso) => {\n              return (\n                <option value={sso.key} key={sso.key}>\n                  {sso.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderAlignmentTypeLabel = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Alignment Type:</strong>\n          <select\n            value={style.alignmentType.key}\n            onChange={(e) =>\n              this.setState({\n                style: AlignmentStyle.fromAlignmentType(\n                  AlignmentTypes.fromKey(e.target.value)!\n                ),\n              })\n            }\n          >\n            {AlignmentTypes.list.map((alignmentType) => {\n              return (\n                <option value={alignmentType.key} key={alignmentType.key}>\n                  {alignmentType.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderColorScheme = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Color Scheme:</strong>\n          <select\n            value={style.alignmentType.allColorSchemes.indexOf(\n              style.colorScheme\n            )}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style!,\n                  colorScheme:\n                    style.alignmentType.allColorSchemes[\n                      parseInt(e.target.value)\n                    ],\n                },\n              });\n            }}\n          >\n            {style.alignmentType.allColorSchemes.map(\n              (colorScheme: IColorScheme, index: number) => {\n                return (\n                  <option key={index} value={index}>\n                    {colorScheme.description}\n                  </option>\n                );\n              }\n            )}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderResidueDetail = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Residue Style:</strong>\n          <select\n            value={style.residueDetail.key}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style,\n                  residueDetail: ResidueStyle.fromKey(e.target.value)!,\n                },\n              });\n            }}\n          >\n            {ResidueStyle.list.map((rd) => {\n              return (\n                <option key={rd.key} value={rd.key}>\n                  {rd.description}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderPositionStyling = (\n    style: AminoAcidAlignmentStyle | NucleotideAlignmentStyle\n  ) => {\n    return (\n      <div>\n        <label>\n          <strong>Positions to Style:</strong>\n          <select\n            value={PositionsToStyle.list.indexOf(style.positionsToStyle)}\n            onChange={(e) => {\n              this.setState({\n                style: {\n                  ...style,\n                  positionsToStyle:\n                    PositionsToStyle.list[parseInt(e.target.value)],\n                },\n              });\n            }}\n          >\n            {PositionsToStyle.list.map(\n              (pts: PositionsToStyle, index: number) => {\n                return (\n                  <option key={index} value={index}>\n                    {pts.description}\n                  </option>\n                );\n              }\n            )}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderSequenceLogo = () => {\n    const { logoPlotStyle } = this.state;\n    return (\n      <div>\n        <label>\n          <strong>Sequence Logo Style:</strong>\n          <select\n            value={logoPlotStyle}\n            onChange={(e) => {\n              this.setState({\n                logoPlotStyle: e.target.value as LOGO_TYPES,\n              });\n            }}\n          >\n            {Object.values(LOGO_TYPES).map((logoType) => {\n              return (\n                <option key={logoType} value={logoType}>\n                  {logoType}\n                </option>\n              );\n            })}\n          </select>\n        </label>\n      </div>\n    );\n  };\n  protected renderZoomButtons = () => {\n    const { zoomLevel } = this.state;\n    return (\n      <div>\n        <label>\n          <strong>Zoom Level:</strong>\n          <div className=\"zoom-level\">\n            <button\n              type=\"button\"\n              disabled={zoomLevel < 7}\n              onClick={(e) => {\n                this.setState({\n                  zoomLevel: zoomLevel - 1,\n                });\n              }}\n            >\n              -\n            </button>\n            {zoomLevel}\n            <button\n              type=\"button\"\n              disabled={zoomLevel > 15}\n              onClick={(e) => {\n                this.setState({\n                  zoomLevel: zoomLevel + 1,\n                });\n              }}\n            >\n              +\n            </button>\n          </div>\n        </label>\n      </div>\n    );\n  };\n\n  protected renderFileUpload = () => {\n    return (\n      <div>\n        <AlignmentFileLoaderComponent\n          fileSelectorLabelText={\"Upload Alignment File:\"}\n          exampleFiles={[\n            {\n              labelText: \"-lactamase\",\n              fileURL:\n                process.env.PUBLIC_URL +\n                \"/7fa1c5691376beab198788a726917d48_b0.4.a2m\",\n              fileName: \"7fa1c5691376beab198788a726917d48_b0.4.a2m\",\n            },\n            {\n              labelText: \"SARS-CoV-2 Spike\",\n              fileURL: process.env.PUBLIC_URL + \"/Spike_Full_f05_m05_t08.a2m\",\n              fileName: \"Spike_Full_f05_m05_t08.a2m\",\n            },\n          ]}\n          onFileLoadStart={() => {\n            this.setState({\n              loading: true,\n            });\n          }}\n          onAlignmentLoaded={this.onAlignmentReceived}\n          onAlignmenLoadError={this.onAlignmentLoadError}\n        />\n      </div>\n    );\n  };\n\n  protected renderConservationBarplotToggle = () => {\n    return (\n      <div className=\"barplot-conservation-toggle\">\n        <label>\n          <strong>Show conservation barplot:</strong>\n\n          <input\n            name=\"conservationBarplotToggle\"\n            type=\"checkbox\"\n            checked={this.state.showConservationBarplot}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showConservationBarplot: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected renderEntropyGapBarplotToggle = () => {\n    return (\n      <div className=\"barplot-entroy-gap-toggle\">\n        <label>\n          <strong>Show entropy/gap barplot:</strong>\n\n          <input\n            name=\"entropyGapBarplotToggle\"\n            type=\"checkbox\"\n            checked={this.state.showEntropyGapBarplot}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showEntropyGapBarplot: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected renderKLDivergenceBarplot = () => {\n    return (\n      <div className=\"barplot-kldivergence-toggle\">\n        <label>\n          <strong>Show KL Divergence barplot:</strong>\n\n          <input\n            name=\"kldivergenceBarplotToggle\"\n            type=\"checkbox\"\n            checked={this.state.showKLDivergenceBarplot}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showKLDivergenceBarplot: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected renderMiniMapToggle = () => {\n    return (\n      <div className=\"minimap-toggle\">\n        <label>\n          <strong>Show MiniMap:</strong>\n\n          <input\n            name=\"showMiniMap\"\n            type=\"checkbox\"\n            checked={this.state.showMiniMap}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showMiniMap: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected renderAnnotationToggle = () => {\n    return (\n      <div className=\"annotation-toggle\">\n        <label>\n          <strong>Show Annotations:</strong>\n\n          <input\n            name=\"showAnnotations\"\n            type=\"checkbox\"\n            checked={this.state.showAnnotations}\n            onChange={(e) => {\n              const target = e.target;\n              this.setState({\n                showAnnotations: target.checked,\n              });\n            }}\n          />\n        </label>\n      </div>\n    );\n  };\n\n  protected onAlignmentLoadError(error: AlignmentLoadError) {\n    this.setState({\n      loadError: error,\n      loading: false,\n    });\n  }\n\n  protected onAlignmentReceived(alignment: Alignment) {\n    this.setState({\n      alignment: alignment,\n      showSettings: false,\n      style: alignment.getDefaultStyle(),\n      loading: false,\n      loadError: undefined,\n    });\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"acePrefix\":\"ace_\",\"preAceQueryClass\":\"q\",\"preAceConsensusClass\":\"c\",\"aceQueryClass\":\"q\",\"aceConsensusClass\":\"c\",\"aceResidueParentClass\":\"ace_line\",\"darkHueClass\":\"dark-residues\",\"lightHueClass\":\"light-residues\",\"lettersOnlyHueClass\":\"letters-only-residues\",\"aaAlignTypeClass\":\"alignment-aa\",\"ntAlignTypeClass\":\"alignment-nt\",\"styPosAllClass\":\"alignment-positions-tostyle-all\",\"styPosQueryClass\":\"alignment-positions-tostyle-query\",\"styPosQueryDiffClass\":\"alignment-positions-tostyle-query-diff\",\"styPosConsensusClass\":\"alignment-positions-tostyle-consensus\",\"styPosConsensusDiffClass\":\"alignment-positions-tostyle-consensus-diff\",\"aaStyClass_Default\":\"aa-alignment-style-default\",\"aaStyDesc_Default\":\"Default\",\"aaStyBGAlpha_Default\":\".25\",\"aaStyColorOrder_Default\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V\",\"aaStyColors_Default\":\"#3c0,#c00,#60c,#03f,#ff0,#60c,#03f,#3c0,#090,#3c0,#3c0,#c00,#3c0,#090,#3c0,#09f,#09f,#090,#090,#3c0\",\"aaStyClass_Buried\":\"aa-alignment-style-buried\",\"aaStyDesc_Buried\":\"Buried Index\",\"aaStyBGAlpha_Buried\":\".25\",\"aaStyColorOrder_Buried\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V,B,X,Z\",\"aaStyColors_Buried\":\"#00a35c,#00fc03,#00eb14,#00eb14,blue,#00f10e,#00f10e,#009d62,#00d52a,#0054ab,#007b84,lime,#009768,#008778,#00e01f,#00d52a,#00db24,#00a857,#00e619,#005fa0,#00eb14,#00b649,#00f10e\",\"aaStyClass_Cinema\":\"aa-alignment-style-cinema\",\"aaStyDesc_Cinema\":\"Cinema\",\"aaStyBGAlpha_Cinema\":\".25\",\"aaStyColorOrder_Cinema\":\"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z\",\"aaStyColors_Cinema\":\"#bbb,grey,#ff0,red,red,#f0f,brown,cyan,#bbb,#fff,cyan,#bbb,#bbb,green,#fff,brown,green,cyan,green,green,#fff,#bbb,#f0f,grey,#f0f,grey\",\"aaStyClass_Clustal\":\"aa-alignment-style-clustal\",\"aaStyDesc_Clustal\":\"Clustal\",\"aaStyBGAlpha_Clustal\":\".25\",\"aaStyColorOrder_Clustal\":\"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z\",\"aaStyColors_Clustal\":\"orange,#fff,green,red,red,blue,orange,red,green,#fff,red,green,green,#fff,#fff,orange,#fff,red,orange,orange,#fff,green,blue,#fff,blue,#fff\",\"aaStyClass_Clustal2\":\"aa-alignment-style-clustal2\",\"aaStyDesc_Clustal2\":\"Clustal2\",\"aaStyBGAlpha_Clustal2\":\".25\",\"aaStyColorOrder_Clustal2\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V,B,X,Z\",\"aaStyColors_Clustal2\":\"#80a0f0,#f01505,lime,#c048c0,#f08080,lime,#c048c0,#f09048,#15a4a4,#80a0f0,#80a0f0,#f01505,#80a0f0,#80a0f0,#ff0,lime,lime,#80a0f0,#15a4a4,#80a0f0,#fff,#fff,#fff\",\"aaStyClass_Helix\":\"aa-alignment-style-helix\",\"aaStyDesc_Helix\":\"Helix Propensity\",\"aaStyBGAlpha_Helix\":\".25\",\"aaStyColorOrder_Helix\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V,B,X,Z\",\"aaStyColors_Helix\":\"#e718e7,#6f906f,#1be41b,#787,#23dc23,#926d92,#f0f,lime,#758a75,#8a758a,#ae51ae,#a05fa0,#ef10ef,#986798,lime,#36c936,#47b847,#8a758a,#21de21,#857a85,#49b649,#758a75,#c936c9\",\"aaStyClass_Hydrophobicity\":\"aa-alignment-style-hydrophobicity\",\"aaStyDesc_Hydrophobicity\":\"Hydrophobicity\",\"aaStyBGAlpha_Hydrophobicity\":\".25\",\"aaStyColorOrder_Hydrophobicity\":\"F,I,W,L,V,M,Y,C,A,T,H,G,S,Q,R,K,N,E,P,D\",\"aaStyColors_Hydrophobicity\":\"red,red,#ff0606,#ff0606,#ff4c4c,#ff5252,#f77,#ffa5a5,#ffc0c0,#e1e1ff,#d0d0ff,#b6b6ff,#a5a5ff,#9595ff,#8787ff,#6969ff,#5959ff,#4f4fff,#1d1dff,blue\",\"aaStyClass_Lesk\":\"aa-alignment-style-lesk\",\"aaStyDesc_Lesk\":\"Lesk\",\"aaStyBGAlpha_Lesk\":\".25\",\"aaStyColorOrder_Lesk\":\"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z\",\"aaStyColors_Lesk\":\"orange,#fff,green,red,red,green,orange,#f0f,green,#fff,red,green,green,#f0f,#fff,green,#f0f,red,orange,orange,#fff,green,green,#fff,green,#fff\",\"aaStyClass_MAE\":\"aa-alignment-style-mae\",\"aaStyDesc_MAE\":\"MAE\",\"aaStyBGAlpha_MAE\":\".25\",\"aaStyColorOrder_MAE\":\"A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z\",\"aaStyColors_MAE\":\"#7d8,#fff,#9e6,#5b3,#5b3,#99f,#7d8,#55f,#6bf,#fff,#fc7,#6bf,#6bf,#5b3,#fff,#eaa,#5b3,#fc7,#f45,#f45,#fff,#6bf,#99f,#fff,#99f,#fff\",\"aaStyClass_Strand\":\"aa-alignment-style-strand\",\"aaStyDesc_Strand\":\"Strand Propensity\",\"aaStyBGAlpha_Strand\":\".25\",\"aaStyColorOrder_Strand\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V,B,X,Z\",\"aaStyColors_Strand\":\"#5858a7,#6b6b94,#64649b,#2121de,#9d9d62,#8c8c73,blue,#4949b6,#60609f,#ecec13,#b2b24d,#4747b8,#82827d,#c2c23d,#2323dc,#4949b6,#9d9d62,#c0c03f,#d3d32c,#ff0,#4343bc,#797986,#4747b8\",\"aaStyClass_Taylor\":\"aa-alignment-style-taylor\",\"aaStyDesc_Taylor\":\"Taylor\",\"aaStyBGAlpha_Taylor\":\".25\",\"aaStyColorOrder_Taylor\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V,B,X,Z\",\"aaStyColors_Taylor\":\"#cf0,blue,#c0f,red,#ff0,#f0c,#f06,#f90,#06f,#6f0,#3f0,#60f,lime,#0f6,#fc0,#f30,#f60,#0cf,#0fc,#9f0,#fff,#fff,#fff\",\"aaStyClass_Turn\":\"aa-alignment-style-turn\",\"aaStyDesc_Turn\":\"Turn Propensity\",\"aaStyBGAlpha_Turn\":\".25\",\"aaStyColorOrder_Turn\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V,B,X,Z\",\"aaStyColors_Turn\":\"#2cd3d3,#708f8f,red,#e81717,#a85757,#3fc0c0,#788,red,#708f8f,cyan,#1ce3e3,#7e8181,#1ee1e1,#1ee1e1,#f60909,#e11e1e,#738c8c,#738c8c,#9d6262,#07f8f8,#f30c0c,#7c8383,#5ba4a4\",\"aaStyClass_Zappo\":\"aa-alignment-style-zappo\",\"aaStyDesc_Zappo\":\"Zappo\",\"aaStyBGAlpha_Zappo\":\".25\",\"aaStyColorOrder_Zappo\":\"A,R,N,D,C,Q,E,G,H,I,L,K,M,F,P,S,T,W,Y,V,B,X,Z\",\"aaStyColors_Zappo\":\"#ffafaf,#6464ff,lime,red,#ff0,lime,red,#f0f,#6464ff,#ffafaf,#ffafaf,#6464ff,#ffafaf,#ffc800,#f0f,lime,lime,#ffc800,#ffc800,#ffafaf,#fff,#fff,#fff\",\"ntStyClass_Default\":\"nt-alignment-style-default\",\"ntStyDesc_Default\":\"Default\",\"ntStyBGAlpha_Default\":\".25\",\"ntStyColorOrder_Default\":\"A,C,G,T,U,R,Y\",\"ntStyColors_Default\":\"#5050ff,#e00000,#00c000,#e6e600,#c90,#2e8b57,#ff8c00\",\"ntStyClass_Nucleotide\":\"nt-alignment-style-nucleotide\",\"ntStyDesc_Nucleotide\":\"Nucleotide\",\"ntStyBGAlpha_Nucleotide\":\".25\",\"ntStyColorOrder_Nucleotide\":\"A,C,G,T,U\",\"ntStyColors_Nucleotide\":\"#64f73f,#ffb340,#eb413c,#3c88ee,#3c88ee\",\"ntStyClass_Purine\":\"nt-alignment-style-purine\",\"ntStyDesc_Purine\":\"Purine/Pyrimidine\",\"ntStyBGAlpha_Purine\":\".25\",\"ntStyColorOrder_Purine\":\"A,C,G,R,T,U,Y\",\"ntStyColors_Purine\":\"#ff83fa,#40e0d0,#ff83fa,#ff83fa,#40e0d0,#40e0d0,#40e0d0\"};"],"sourceRoot":""}